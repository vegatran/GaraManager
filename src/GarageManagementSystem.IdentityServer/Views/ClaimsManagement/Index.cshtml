@{
    ViewData["Title"] = "Claims Management";
}
<!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Claims List</h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-primary btn-sm" onclick="ClaimsManagement.showCreateClaim()">
                                    <i class="fas fa-plus"></i> Add New Claim
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <table id="claimsTable" class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Display Name</th>
                                        <th>Description</th>
                                        <th>Category</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded via AJAX -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

<!-- Create Claim Modal -->
<div class="modal fade" id="createClaimModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h4 class="modal-title text-white">Create New Claim</h4>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div id="createClaimModalBody" class="modal-body">
                <!-- Content loaded via AJAX -->
            </div>
        </div>
    </div>
</div>

<!-- Edit Claim Modal -->
<div class="modal fade" id="editClaimModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h4 class="modal-title text-white">Edit Claim</h4>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div id="editClaimModalBody" class="modal-body">
                <!-- Content loaded via AJAX -->
            </div>
        </div>
    </div>
</div>

<!-- View Claim Modal -->
<div class="modal fade" id="viewClaimModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="dialog">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <h4 class="modal-title text-white">Claim Details</h4>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div id="viewClaimModalBody" class="modal-body">
                <!-- Content loaded via AJAX -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/claims-management.js?v=@Guid.NewGuid()" asp-append-version="true"></script>
    <script>
        $(document).ready(function() {
            // Initialize DataTable using utility function
            DataTablesUtility.initializeTable('#claimsTable', {
                ajaxUrl: '/ClaimsManagement/GetClaims',
                columns: [
                    { data: 'name' },
                    { data: 'displayName' },
                    { data: 'description' },
                    { data: 'category' },
                    { 
                        data: 'isStandard',
                        render: function(data) {
                            return data ? '<span class="badge badge-primary">Standard</span>' : '<span class="badge badge-secondary">Custom</span>';
                        }
                    },
                            { 
                                data: 'isActive',
                                render: function(data, type, row) {
                                    if (data) {
                                        return '<span class="badge badge-success">Active</span>';
                                    } else {
                                        return '<span class="badge badge-secondary">Inactive</span>';
                                    }
                                }
                            },
                    { data: 'createdAt' }
                ],
                actionCallbacks: {
                    view: 'ClaimsManagement.showClaimDetails',
                    edit: 'ClaimsManagement.showEditClaim',
                    delete: 'ClaimsManagement.deleteClaim',
                    restore: 'ClaimsManagement.restoreClaim',
                    useIdForActions: true,  // Use id instead of name for View/Edit/Delete
                    conditionalActions: true  // Show different buttons based on row data
                },
                language: {
                    processing: "Loading Claims...",
                    emptyTable: "No Claims found",
                    info: "Showing _START_ to _END_ of _TOTAL_ Claims",
                    infoEmpty: "Showing 0 to 0 of 0 Claims",
                    infoFiltered: "(filtered from _MAX_ total Claims)"
                }
            });
        });
    </script>
}
