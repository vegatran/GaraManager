@{
    ViewData["Title"] = "Test API";
}

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">Test API</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Home</a></li>
                    <li class="breadcrumb-item active">Test API</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card card-success">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-code mr-2"></i>
                            API Testing Interface
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Test Protected API Endpoints</h5>
                                <div class="btn-group-vertical w-100 mb-3">
                                    <button type="button" class="btn btn-primary mb-2" onclick="testApiEndpoint('/CustomerManagement/GetCustomers')">
                                        <i class="fas fa-users"></i> Test Customer API
                                    </button>
                                    <button type="button" class="btn btn-info mb-2" onclick="testApiEndpoint('/Home/Profile')">
                                        <i class="fas fa-user"></i> Test Profile API
                                    </button>
                                    <button type="button" class="btn btn-success mb-2" onclick="testApiEndpoint('/api/TestClaims')">
                                        <i class="fas fa-key"></i> Test Claims API
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Token Information</h5>
                                <div id="tokenInfo" class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> Click "Test Claims API" to view token information
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <h5>API Response</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <pre id="apiResponse" class="bg-light p-3" style="min-height: 200px; overflow-x: auto;">
                                            <code>API response will appear here...</code>
                                        </pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        function testApiEndpoint(url) {
            // Show loading
            $('#apiResponse code').text('Loading...');
            $('#tokenInfo').html('<i class="fas fa-spinner fa-spin"></i> Testing API endpoint...');
            
            $.ajax({
                url: url,
                type: 'GET',
                success: function(response) {
                    $('#apiResponse code').text(JSON.stringify(response, null, 2));
                    $('#tokenInfo').html('<i class="fas fa-check-circle text-success"></i> API call successful!');
                },
                error: function(xhr, status, error) {
                    var errorMessage = 'Error: ' + status + ' - ' + error;
                    if (xhr.responseText) {
                        try {
                            var errorResponse = JSON.parse(xhr.responseText);
                            errorMessage = JSON.stringify(errorResponse, null, 2);
                        } catch (e) {
                            errorMessage = xhr.responseText;
                        }
                    }
                    $('#apiResponse code').text(errorMessage);
                    $('#tokenInfo').html('<i class="fas fa-exclamation-triangle text-danger"></i> API call failed!');
                }
            });
        }

        // Test claims API specifically
        $(document).ready(function() {
            // Auto-test claims API on page load
            testApiEndpoint('/api/TestClaims');
        });
    </script>
}
