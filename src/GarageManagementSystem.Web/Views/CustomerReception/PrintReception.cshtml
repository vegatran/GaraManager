@model GarageManagementSystem.Web.Models.PrintReceptionViewModel

@{
    ViewData["Title"] = "In Biên Bản Tiếp Nhận Xe";
    Layout = null; // Không sử dụng layout chính
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - @Model.Reception.ReceptionNumber</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            font-size: 12px;
            line-height: 1.4;
            color: #000;
            background: #fff;
        }
        
        .print-container {
            width: 210mm;
            min-height: 297mm;
            margin: 0;
            padding: 3mm 3mm;
            background: white;
            page-break-inside: avoid;
        }
        
        /* Header Section */
        .header {
            display: flex;
            align-items: flex-start;
        }
        
        .logo-section {
            flex: 0 0 100px;
            margin-right: 15px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            border: 2px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ff6b35;
            color: white;
            font-weight: bold;
            font-size: 9px;
            text-align: center;
            line-height: 1.2;
        }
        
        .company-info {
            flex: 1;
        }
        
        .company-name {
            font-size: 26px;
            font-weight: bold;
            color: #333;
            text-transform: uppercase;
        }
        
        .company-details {
            font-size: 12px;
            line-height: 1.6;
        }
        
        .company-details .detail-row {
            margin-bottom: 3px;
        }
        
        .company-details strong {
            font-weight: bold;
        }
        
        /* Document Title */
        .document-title {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
            text-transform: uppercase;
            border: 2px solid #333;
            padding: 8px;
            background: #f8f9fa;
        }
        
        /* Reception Details */
        .reception-details {
            display: flex;
            gap: 15px;
        }
        
        .detail-table {
            flex: 1;
            border: 1px solid #333;
            border-collapse: collapse;
            width: 100%;
        }
        
        .detail-table th,
        .detail-table td {
            border: 1px solid #333;
            padding: 4px 8px;
            text-align: left;
            vertical-align: middle;
        }
        
        .detail-table th {
            background: #f8f9fa;
            font-weight: bold;
            width: 25%;
        }
        
        /* Section */
        .section-title {
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin: 15px 0 8px 0;
            text-transform: uppercase;
            border-bottom: 2px solid #333;
            padding-bottom: 3px;
        }
        
        .info-box {
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        
        .info-box-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .info-box-content {
            text-align: justify;
            line-height: 1.6;
        }
        
        /* Signature Section */
        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .signature-box {
            text-align: center;
            width: 200px;
        }
        
        .signature-title {
            font-weight: bold;
            margin-bottom: 30px;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        .signature-line {
            border-bottom: 1px solid #333;
            height: 30px;
        }
        
        /* Print Styles */
        @@media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            body {
                font-size: 12px;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .print-container {
                margin: 0 !important;
                padding: 3mm 3mm !important;
                max-width: none !important;
                width: 210mm !important;
                min-height: 297mm !important;
                max-height: 297mm !important;
                page-break-inside: avoid !important;
                overflow: hidden !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            @@page {
                size: A4;
                margin: 0;
            }
        }
        
        .no-print {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 2px solid #333;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .no-print button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .no-print button:hover {
            background: #e55a2b;
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button onclick="window.print()">In Biên Bản</button>
        <button onclick="window.close()">Đóng</button>
    </div>

    <div class="print-container">
        <!-- Header Section -->
        <div class="header">
            <div class="logo-section">
                <img src="~/css/img/logo.png" alt="Logo" />
            </div>
            <div class="company-info">
                <div class="company-name">@(Model.CompanyInfo?.CompanyName ?? "GARAGE Ô TÔ THUẬN PHÁT")</div>
                <div class="company-details">
                    <div class="detail-row"><strong>Địa chỉ:</strong> @(Model.CompanyInfo?.CompanyAddress ?? "313 Võ Văn Vân, Vĩnh Lộc B, H. Bình Chánh, TP.HCM")</div>
                    <div class="detail-row"><strong>Điện thoại:</strong> @(Model.CompanyInfo?.CompanyPhone ?? "032.7007.985 (Mr. Bằng)")</div>
                </div>
            </div>
        </div>

        <!-- Document Title -->
        <div class="document-title">
            BIÊN BẢN TIẾP NHẬN XE
        </div>

        <!-- Reception Details -->
        <table class="detail-table">
            <tbody>
                <tr>
                    <th>Số phiếu:</th>
                    <td>@Model.Reception.ReceptionNumber</td>
                    <th>Ngày tiếp nhận:</th>
                    <td>@Model.Reception.ReceptionDate.ToString("dd/MM/yyyy HH:mm")</td>
                </tr>
                <tr>
                    <th>Khách hàng:</th>
                    <td>@(Model.Reception.Customer?.Name ?? Model.Reception.CustomerName ?? "")</td>
                    <th>Biển số xe:</th>
                    <td>@(Model.Reception.Vehicle?.LicensePlate ?? Model.Reception.VehiclePlate ?? "")</td>
                </tr>
                <tr>
                    <th>Điện thoại:</th>
                    <td>@(Model.Reception.Customer?.Phone ?? Model.Reception.CustomerPhone ?? "")</td>
                    <th>Hiệu xe:</th>
                    <td>@(Model.Reception.Vehicle?.Brand ?? Model.Reception.VehicleMake ?? "") @(Model.Reception.Vehicle?.Model ?? Model.Reception.VehicleModel ?? "")</td>
                </tr>
                <tr>
                    <th>Địa chỉ:</th>
                    <td colspan="3">@(Model.Reception.Customer?.Address ?? "")</td>
                </tr>
                <tr>
                    <th>Email:</th>
                    <td>@(Model.Reception.Customer?.Email ?? "")</td>
                    <th>Năm sản xuất:</th>
                    <td>@(Model.Reception.VehicleYear?.ToString() ?? "")</td>
                </tr>
                <tr>
                    <th>Kỹ thuật viên:</th>
                    <td>@(Model.Reception.AssignedTechnician?.Name ?? "Chưa phân công")</td>
                    <th>Trạng thái:</th>
                    <td>@TranslateStatus(Model.Reception.Status)</td>
                </tr>
                <tr>
                    <th>Ưu tiên:</th>
                    <td>@TranslatePriority(Model.Reception.Priority)</td>
                    <th>Loại dịch vụ:</th>
                    <td>@TranslateServiceType(Model.Reception.ServiceType)</td>
                </tr>
            </tbody>
        </table>

        <!-- Customer Request -->
        @if (!string.IsNullOrWhiteSpace(Model.Reception.CustomerRequest))
        {
            <div class="section-title">YÊU CẦU CỦA KHÁCH HÀNG</div>
            <div class="info-box">
                <div class="info-box-content">@Model.Reception.CustomerRequest</div>
            </div>
        }

        <!-- Customer Complaints -->
        @if (!string.IsNullOrWhiteSpace(Model.Reception.CustomerComplaints))
        {
            <div class="section-title">KHIẾU NẠI / VẤN ĐỀ CỦA KHÁCH HÀNG</div>
            <div class="info-box">
                <div class="info-box-content">@Model.Reception.CustomerComplaints</div>
            </div>
        }

        <!-- Reception Notes -->
        @if (!string.IsNullOrWhiteSpace(Model.Reception.ReceptionNotes))
        {
            <div class="section-title">GHI CHÚ TIẾP ĐÓN</div>
            <div class="info-box">
                <div class="info-box-content">@Model.Reception.ReceptionNotes</div>
            </div>
        }

        <!-- Insurance Information -->
        @if (Model.Reception.IsInsuranceClaim)
        {
            <div class="section-title">THÔNG TIN BẢO HIỂM</div>
            <table class="detail-table">
                <tbody>
                    <tr>
                        <th>Công ty bảo hiểm:</th>
                        <td>@(Model.Reception.InsuranceCompany ?? "")</td>
                        <th>Số hợp đồng:</th>
                        <td>@(Model.Reception.InsurancePolicyNumber ?? "")</td>
                    </tr>
                </tbody>
            </table>
        }

        <!-- Emergency Contact -->
        @if (!string.IsNullOrWhiteSpace(Model.Reception.EmergencyContact))
        {
            <div class="section-title">LIÊN HỆ KHẨN CẤP</div>
            <table class="detail-table">
                <tbody>
                    <tr>
                        <th>Họ và tên:</th>
                        <td>@Model.Reception.EmergencyContactName</td>
                        <th>Điện thoại:</th>
                        <td>@Model.Reception.EmergencyContact</td>
                    </tr>
                </tbody>
            </table>
        }

        <!-- Signature Section -->
        <div class="signature-section">
            <div class="signature-box">
                <div class="signature-title">XÁC NHẬN CỦA KHÁCH HÀNG</div>
                <div class="signature-line"></div>
                <div style="margin-top: 5px; font-size: 12px;">Ký tên</div>
            </div>
            <div class="signature-box">
                <div style="margin-top: 10px; font-size: 11px; color: #666;">
                    <strong>Ngày in:</strong> <span id="printDate">@DateTime.Now.ToString("dd/MM/yyyy HH:mm")</span>
                </div>
                <div class="signature-title">NGƯỜI TIẾP NHẬN</div>
                <div class="signature-line"></div>
                <div style="margin-top: 5px; font-size: 12px;">Ký tên</div>
            </div>
        </div>
    </div>

    <script>
        function updatePrintDate() {
            const now = new Date();
            const printDateElement = document.getElementById('printDate');
            if (printDateElement) {
                const formattedDate = now.toLocaleDateString('vi-VN') + ' ' + now.toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'});
                printDateElement.textContent = formattedDate;
            }
        }

        window.addEventListener('beforeprint', updatePrintDate);
        document.addEventListener('DOMContentLoaded', updatePrintDate);
    </script>
</body>
</html>

@functions {
    private string TranslateStatus(GarageManagementSystem.Core.Enums.ReceptionStatus status)
    {
        return status switch
        {
            GarageManagementSystem.Core.Enums.ReceptionStatus.Pending => "Chờ Kiểm Tra",
            GarageManagementSystem.Core.Enums.ReceptionStatus.Assigned => "Đã Phân Công",
            GarageManagementSystem.Core.Enums.ReceptionStatus.InProgress => "Đang Kiểm Tra",
            GarageManagementSystem.Core.Enums.ReceptionStatus.Completed => "Đã Hoàn Thành",
            GarageManagementSystem.Core.Enums.ReceptionStatus.Cancelled => "Đã Hủy",
            _ => status.ToString()
        };
    }

    private string TranslatePriority(string priority)
    {
        return priority switch
        {
            "Low" => "Thấp",
            "Normal" => "Bình Thường",
            "High" => "Cao",
            "Urgent" => "Khẩn Cấp",
            _ => priority
        };
    }

    private string TranslateServiceType(string serviceType)
    {
        return serviceType switch
        {
            "General" => "Tổng Quát",
            "Emergency" => "Khẩn Cấp",
            "Maintenance" => "Bảo Dưỡng",
            "Repair" => "Sửa Chữa",
            "Inspection" => "Kiểm Tra",
            _ => serviceType
        };
    }
}

