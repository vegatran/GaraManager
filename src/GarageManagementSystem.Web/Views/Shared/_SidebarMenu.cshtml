@using System
<!-- Sidebar Menu -->
<nav class="mt-2">
    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
        
        <!-- Dashboard -->
        <li class="nav-item">
            <a href="@Url.Action("Index", "Home")" class="nav-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Index" && ViewContext.RouteData.Values["Controller"]?.ToString() == "Home" ? "active" : "")">
                <i class="nav-icon fas fa-tachometer-alt text-info"></i>
                <p>Tổng Quan</p>
            </a>
        </li>

        <!-- QUY TRÌNH NGHIỆP VỤ - GIAI ĐOẠN 1 (Multilevel) -->
        <li class="nav-item @(ViewContext.RouteData.Values["Controller"]?.ToString() == "CustomerReception" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InspectionManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "QuotationManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "OrderManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "AppointmentManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "MaterialRequestManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "QCManagement" ? "menu-open" : "")">
            <a href="#" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "CustomerReception" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InspectionManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "QuotationManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "OrderManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "AppointmentManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "MaterialRequestManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "QCManagement" ? "active" : "")">
                <i class="nav-icon fas fa-project-diagram text-primary"></i>
                <p>
                    Quy Trình Nghiệp Vụ
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <!-- GIAI ĐOẠN 1: TIẾP NHẬN XE & BÁO GIÁ (Front Office) -->
                <li class="nav-header text-sm" style="padding: 8px 16px; color: #6c757d; font-weight: bold;">
                    <i class="fas fa-flag text-primary"></i> GIAI ĐOẠN 1: Tiếp Nhận & Báo Giá
                </li>
                
                <!-- Bước 1: Tiếp nhận & Kiểm tra sơ bộ (CVDV) -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "CustomerReception")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "CustomerReception" ? "active" : "")">
                        <i class="fas fa-handshake nav-icon text-primary"></i>
                        <p>
                            <span class="badge badge-primary" style="margin-right: 8px;">1</span>
                            Tiếp Đón Khách Hàng
                        </p>
                    </a>
                </li>
                
                <!-- Bước 2: Chẩn đoán & Lập kế hoạch (KTV) -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "InspectionManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "InspectionManagement" ? "active" : "")">
                        <i class="fas fa-search nav-icon text-warning"></i>
                        <p>
                            <span class="badge badge-warning" style="margin-right: 8px;">2</span>
                            Kiểm Tra Xe
                        </p>
                    </a>
                </li>
                
                <!-- Bước 3: Báo giá & Thỏa thuận (CVDV) -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "QuotationManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "QuotationManagement" ? "active" : "")">
                        <i class="fas fa-file-invoice-dollar nav-icon text-success"></i>
                        <p>
                            <span class="badge badge-success" style="margin-right: 8px;">3</span>
                            Báo Giá
                        </p>
                    </a>
                </li>
                
                <!-- GIAI ĐOẠN 2: THỰC HIỆN SỬA CHỮA (Back Office) -->
                <li class="nav-header text-sm" style="padding: 8px 16px; color: #6c757d; font-weight: bold; margin-top: 10px;">
                    <i class="fas fa-wrench text-danger"></i> GIAI ĐOẠN 2: Sửa Chữa & Thanh Toán
                </li>
                
                <!-- Bước 4: Tạo đơn sửa chữa -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "OrderManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "OrderManagement" && ViewContext.RouteData.Values["Action"]?.ToString() == "Index" ? "active" : "")">
                        <i class="fas fa-tools nav-icon text-danger"></i>
                        <p>
                            <span class="badge badge-danger" style="font-size: 11px; margin-right: 5px;">4</span>
                            Phiếu Sửa Chữa
                        </p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("CogsSummary", "OrderManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "OrderManagement" && ViewContext.RouteData.Values["Action"]?.ToString() == "CogsSummary" ? "active" : "")">
                        <i class="fas fa-chart-bar nav-icon text-primary"></i>
                        <p>Báo Cáo COGS</p>
                    </a>
                </li>

                <!-- Bước 5: MR - Yêu Cầu Vật Tư -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "MaterialRequestManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "MaterialRequestManagement" ? "active" : "")">
                        <i class="fas fa-boxes nav-icon text-purple"></i>
                        <p>
                            <span class="badge" style="background-color:#6f42c1; font-size: 11px; margin-right: 5px;">5</span>
                            Yêu Cầu Vật Tư (MR)
                        </p>
                    </a>
                </li>
                
                <!-- ✅ 2.4: Bước 6: QC - Kiểm Tra Chất Lượng -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "QCManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "QCManagement" ? "active" : "")">
                        <i class="fas fa-check-circle nav-icon text-teal"></i>
                        <p>
                            <span class="badge" style="background-color:#20c997; font-size: 11px; margin-right: 5px;">6</span>
                            Kiểm Tra QC
                        </p>
                    </a>
                </li>
                
                <!-- Lịch Hẹn (Có thể ở GĐ1 hoặc riêng) -->
                <li class="nav-item">
                    <a href="@Url.Action("Index", "AppointmentManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "AppointmentManagement" ? "active" : "")">
                        <i class="fas fa-calendar-alt nav-icon text-info"></i>
                        <p>Lịch Hẹn</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- QUẢN LÝ KHÁCH HÀNG (Multilevel) -->
        <li class="nav-item @(ViewContext.RouteData.Values["Controller"]?.ToString() == "CustomerManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "VehicleManagement" ? "menu-open" : "")">
            <a href="#" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "CustomerManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "VehicleManagement" ? "active" : "")">
                <i class="nav-icon fas fa-users text-info"></i>
                <p>
                    Khách Hàng & Xe
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="@Url.Action("Index", "CustomerManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "CustomerManagement" ? "active" : "")">
                        <i class="fas fa-user nav-icon text-info"></i>
                        <p>Khách Hàng</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "VehicleManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "VehicleManagement" ? "active" : "")">
                        <i class="fas fa-car nav-icon text-secondary"></i>
                        <p>Xe</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- QUẢN LÝ KHO (Multilevel) -->
        <li class="nav-item @(ViewContext.RouteData.Values["Controller"]?.ToString() == "WarehouseManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "PartsManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "SupplierManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "StockManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "PurchaseOrder" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryAlerts" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryChecks" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryAdjustments" || ViewContext.RouteData.Values["Controller"]?.ToString() == "Procurement" ? "menu-open" : "")">
            <a href="#" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "WarehouseManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "PartsManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "SupplierManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "StockManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "PurchaseOrder" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryAlerts" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryChecks" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryAdjustments" || ViewContext.RouteData.Values["Controller"]?.ToString() == "Procurement" ? "active" : "")">
                <i class="nav-icon fas fa-warehouse text-warning"></i>
                <p>
                    Quản Lý Kho
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="@Url.Action("Index", "WarehouseManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "WarehouseManagement" ? "active" : "")">
                        <i class="fas fa-building nav-icon text-primary"></i>
                        <p>Kho</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "PartsManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PartsManagement" ? "active" : "")">
                        <i class="fas fa-box nav-icon text-warning"></i>
                        <p>Phụ Tùng</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "SupplierManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "SupplierManagement" ? "active" : "")">
                        <i class="fas fa-truck nav-icon text-info"></i>
                        <p>Nhà Cung Cấp</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "StockManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "StockManagement" ? "active" : "")">
                        <i class="fas fa-exchange-alt nav-icon text-secondary"></i>
                        <p>Nhập Xuất Kho</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "PurchaseOrder")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PurchaseOrder" ? "active" : "")">
                        <i class="fas fa-shopping-cart nav-icon text-success"></i>
                        <p>Phiếu Nhập Hàng</p>
                    </a>
                </li>
                <!-- ✅ Phase 4.2.1: Phân Tích Nhu Cầu -->
                <li class="nav-item">
                    <a href="@Url.Action("DemandAnalysis", "Procurement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Procurement" && ViewContext.RouteData.Values["Action"]?.ToString() == "DemandAnalysis" ? "active" : "")">
                        <i class="fas fa-chart-line nav-icon text-purple"></i>
                        <p>Phân Tích Nhu Cầu</p>
                    </a>
                </li>
                <!-- ✅ Phase 4.2.2: So Sánh Nhà Cung Cấp -->
                <li class="nav-item">
                    <a href="@Url.Action("SupplierComparison", "Procurement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Procurement" && ViewContext.RouteData.Values["Action"]?.ToString() == "SupplierComparison" ? "active" : "")">
                        <i class="fas fa-balance-scale nav-icon text-info"></i>
                        <p>So Sánh Nhà Cung Cấp</p>
                    </a>
                </li>
                <!-- ✅ Phase 4.2.2: Đề Xuất Nhà Cung Cấp -->
                <li class="nav-item">
                    <a href="@Url.Action("SupplierRecommendation", "Procurement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Procurement" && ViewContext.RouteData.Values["Action"]?.ToString() == "SupplierRecommendation" ? "active" : "")">
                        <i class="fas fa-star nav-icon text-warning"></i>
                        <p>Đề Xuất Nhà Cung Cấp</p>
                    </a>
                </li>
                <!-- ✅ Phase 4.2.3: Theo Dõi PO -->
                <li class="nav-item">
                    <a href="@Url.Action("Tracking", "PurchaseOrder")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PurchaseOrder" && ViewContext.RouteData.Values["Action"]?.ToString() == "Tracking" ? "active" : "")">
                        <i class="fas fa-truck-loading nav-icon text-info"></i>
                        <p>Theo Dõi PO</p>
                    </a>
                </li>
                <!-- ✅ Phase 4.2.4: Báo Cáo Hiệu Suất -->
                <li class="nav-item">
                    <a href="@Url.Action("PerformanceReport", "Procurement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Procurement" && ViewContext.RouteData.Values["Action"]?.ToString() == "PerformanceReport" ? "active" : "")">
                        <i class="fas fa-chart-bar nav-icon text-success"></i>
                        <p>Báo Cáo Hiệu Suất</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "InventoryAlerts")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryAlerts" ? "active" : "")">
                        <i class="fas fa-exclamation-triangle nav-icon text-danger"></i>
                        <p>
                            Cảnh Báo Tồn Kho
                            <span class="badge badge-danger badge-pill ml-2" id="inventoryAlertsBadge" style="display: none;">0</span>
                        </p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "InventoryChecks")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryChecks" ? "active" : "")">
                        <i class="fas fa-clipboard-check nav-icon text-teal"></i>
                        <p>Kiểm Kê Định Kỳ</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "InventoryAdjustments")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "InventoryAdjustments" ? "active" : "")">
                        <i class="fas fa-adjust nav-icon text-orange"></i>
                        <p>Điều Chỉnh Tồn Kho</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- QUẢN LÝ TÀI CHÍNH (Multilevel) -->
        <li class="nav-item @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PaymentManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InsuranceInvoice" || ViewContext.RouteData.Values["Controller"]?.ToString() == "FinancialTransactionManagement" ? "menu-open" : "")">
            <a href="#" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PaymentManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "InsuranceInvoice" || ViewContext.RouteData.Values["Controller"]?.ToString() == "FinancialTransactionManagement" ? "active" : "")">
                <i class="nav-icon fas fa-money-bill-wave text-success"></i>
                <p>
                    Tài Chính
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="@Url.Action("Index", "FinancialTransactionManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "FinancialTransactionManagement" ? "active" : "")">
                        <i class="fas fa-receipt nav-icon text-primary"></i>
                        <p>Phiếu Thu/Chi</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "PaymentManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PaymentManagement" ? "active" : "")">
                        <i class="fas fa-credit-card nav-icon text-success"></i>
                        <p>Thanh Toán</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "InsuranceInvoice")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "InsuranceInvoice" ? "active" : "")">
                        <i class="fas fa-file-medical nav-icon text-info"></i>
                        <p>Hóa Đơn Bảo Hiểm</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- QUẢN LÝ NHÂN SỰ -->
        <li class="nav-item">
            <a href="@Url.Action("Index", "EmployeeManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "EmployeeManagement" ? "active" : "")">
                <i class="nav-icon fas fa-user-tie text-primary"></i>
                <p>Nhân Viên</p>
            </a>
        </li>

        <!-- DANH MỤC (Multilevel) -->
        <li class="nav-item @(ViewContext.RouteData.Values["Controller"]?.ToString() == "ServiceManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "PrintTemplateManagement" ? "menu-open" : "")">
            <a href="#" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "ServiceManagement" || ViewContext.RouteData.Values["Controller"]?.ToString() == "PrintTemplateManagement" ? "active" : "")">
                <i class="nav-icon fas fa-list text-secondary"></i>
                <p>
                    Danh Mục
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="@Url.Action("Index", "ServiceManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "ServiceManagement" ? "active" : "")">
                        <i class="fas fa-cogs nav-icon text-danger"></i>
                        <p>Dịch Vụ</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "PrintTemplateManagement")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "PrintTemplateManagement" ? "active" : "")">
                        <i class="fas fa-file-alt nav-icon text-dark"></i>
                        <p>Mẫu In</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- BÁO CÁO (Multilevel) -->
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="nav-icon fas fa-chart-bar text-success"></i>
                <p>
                    Báo Cáo
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-chart-line nav-icon text-success"></i>
                        <p>Doanh Thu</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-briefcase nav-icon text-info"></i>
                        <p>Dịch Vụ</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-cubes nav-icon text-warning"></i>
                        <p>Tồn Kho</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-users nav-icon text-primary"></i>
                        <p>Khách Hàng</p>
                    </a>
                </li>
            </ul>
        </li>

        <!-- HỆ THỐNG (Multilevel) -->
        <li class="nav-item @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Setup" || (ViewContext.RouteData.Values["Controller"]?.ToString() == "Home" && (ViewContext.RouteData.Values["Action"]?.ToString() == "Profile" || ViewContext.RouteData.Values["Action"]?.ToString() == "TestApi")) ? "menu-open" : "")">
            <a href="#" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Setup" || (ViewContext.RouteData.Values["Controller"]?.ToString() == "Home" && (ViewContext.RouteData.Values["Action"]?.ToString() == "Profile" || ViewContext.RouteData.Values["Action"]?.ToString() == "TestApi")) ? "active" : "")">
                <i class="nav-icon fas fa-cog text-secondary"></i>
                <p>
                    Hệ Thống
                    <i class="right fas fa-angle-left"></i>
                </p>
            </a>
            <ul class="nav nav-treeview">
                <li class="nav-item">
                    <a href="@Url.Action("Index", "Setup")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Setup" ? "active" : "")">
                        <i class="fas fa-database nav-icon text-info"></i>
                        <p>Setup Dữ Liệu</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Profile", "Home")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Home" && ViewContext.RouteData.Values["Action"]?.ToString() == "Profile" ? "active" : "")">
                        <i class="fas fa-user-circle nav-icon text-primary"></i>
                        <p>Hồ Sơ</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("TestApi", "Home")" class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Home" && ViewContext.RouteData.Values["Action"]?.ToString() == "TestApi" ? "active" : "")">
                        <i class="fas fa-plug nav-icon text-warning"></i>
                        <p>Kiểm Tra API</p>
                    </a>
                </li>
            </ul>
        </li>
    </ul>
</nav>
