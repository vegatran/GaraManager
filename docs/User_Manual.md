# HƯỚNG DẪN SỬ DỤNG - HỆ THỐNG QUẢN LÝ GARAGE Ô TÔ

## 📋 MỤC LỤC
1. [Giới thiệu](#giới-thiệu)
2. [Đăng nhập hệ thống](#đăng-nhập-hệ-thống)
3. [Quản lý khách hàng](#quản-lý-khách-hàng)
4. [Quản lý xe](#quản-lý-xe)
5. [Quản lý phụ tùng](#quản-lý-phụ-tùng)
6. [Quản lý kho chi tiết](#quản-lý-kho-chi-tiết)
7. [Quản lý dịch vụ](#quản-lý-dịch-vụ)
8. [Tạo đơn hàng sửa chữa](#tạo-đơn-hàng-sửa-chữa)
9. [Quản lý thanh toán](#quản-lý-thanh-toán)
10. [Phiếu Nhập Hàng](#phiếu-nhập-hàng)
11. [Phiếu Thu/Chi](#phiếu-thu-chi)
12. [Báo cáo và thống kê](#báo-cáo-và-thống-kê)
13. [QUẢN LÝ MUA HÀNG (Phase 4.2)](#quản-lý-mua-hàng-phase-42)
    - [4.2.1: Phân Tích Nhu Cầu](#421-phân-tích-nhu-cầu)
    - [4.2.2: Đánh Giá Nhà Cung Cấp](#422-đánh-giá-nhà-cung-cấp)
    - [4.2.3: Theo Dõi PO](#423-theo-dõi-po)
    - [4.2.4: Báo Cáo Hiệu Suất](#424-báo-cáo-hiệu-suất)
14. [QUY TRÌNH NGHIỆP VỤ](#quy-trình-nghiệp-vụ)
    - [Giai đoạn 1: Tiếp Nhận & Báo Giá](#giai-đoạn-1-tiếp-nhận--báo-giá)
    - [Giai đoạn 2: Sửa Chữa & Thanh Toán](#giai-đoạn-2-sửa-chữa--thanh-toán)
      - [2.1: Lập Kế Hoạch & Phân Công](#21-lập-kế-hoạch--phân-công)
        - [2.1.1: Chuyển JO sang "Chờ Phân công"](#211-chuyển-jo-sang-chờ-phân-công)
        - [2.1.2: Phân công KTV & Thời gian](#212-phân-công-ktv--thời-gian)
      - [2.2: Yêu Cầu Vật Tư (MR)](#22-yêu-cầu-vật-tư-material-request---mr)
      - [2.3: Quản Lý Tiến Độ & Phát Sinh](#23-quản-lý-tiến-độ--phát-sinh)
        - [2.3.1: Bắt đầu Công việc](#231-bắt-đầu-công-việc)
        - [2.3.2: Phát hiện Phát sinh](#232-phát-hiện-phát-sinh)
        - [2.3.3: Báo giá Phát sinh](#233-báo-giá-phát-sinh)
          - [2.3.3.1: Duyệt Báo Giá Phát Sinh & Tạo LSC Bổ Sung](#2331-duyệt-báo-giá-phát-sinh--tạo-lsc-bổ-sung)
        - [2.3.4: Cập nhật Tiến độ](#234-cập-nhật-tiến-độ)
      - [2.4: Kiểm tra Chất lượng (QC) và Bàn giao](#24-kiểm-tra-chất-lượng-qc-và-bàn-giao)
        - [2.4.1: Hoàn thành Kỹ thuật](#241-hoàn-thành-kỹ-thuật)
        - [2.4.2: Kiểm tra QC](#242-kiểm-tra-qc)
        - [2.4.3: Xử lý QC Không đạt](#243-xử-lý-qc-không-đạt)
        - [2.4.4: Bàn giao xe](#244-bàn-giao-xe)
15. [Hướng dẫn chức năng Duyệt/Từ chối Báo giá](#hướng-dẫn-chức-năng-duyệttừ-chối-báo-giá)
16. [Hướng dẫn tạo dữ liệu QC](#hướng-dẫn-tạo-dữ-liệu-qc)
17. [Hướng dẫn xử lý thuế VAT](#hướng-dẫn-xử-lý-thuế-vat)
18. [Hướng dẫn Data Demo](#hướng-dẫn-data-demo)
19. [Troubleshooting](#troubleshooting)

---

## 🎯 GIỚI THIỆU

### **Hệ thống quản lý garage ô tô** là phần mềm toàn diện giúp quản lý:
- 👥 Khách hàng và thông tin xe
- 🔧 Phụ tùng và tồn kho
- ⚙️ Dịch vụ sửa chữa và công lao động
- 💰 Đơn hàng và thanh toán
- 📊 Báo cáo và thống kê

### **Giao diện chính**
```
┌─────────────────────────────────────────────────────────────┐
│  🏠 GaraManager v2.0                    👤 Admin  ⚙️ 🔔  📤 │
├─────────────────────────────────────────────────────────────┤
│ 📋 Dashboard  👥 Khách hàng  🚗 Xe  🔧 Phụ tùng  💼 Đơn hàng │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    NỘI DUNG CHÍNH                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔐 ĐĂNG NHẬP HỆ THỐNG

### **Bước 1: Truy cập hệ thống**
1. Mở trình duyệt web
2. Nhập địa chỉ: `https://garamanager.com`
3. Chờ trang đăng nhập load

### **Bước 2: Nhập thông tin**
```
┌─────────────────────────────────┐
│        ĐĂNG NHẬP                │
├─────────────────────────────────┤
│ Username: [admin          ]     │
│ Password: [•••••••••••••••]     │
│                                 │
│        [ ĐĂNG NHẬP ]            │
│                                 │
│ [ ] Ghi nhớ đăng nhập           │
│                                 │
│ Quên mật khẩu?                  │
└─────────────────────────────────┘
```

### **Bước 3: Chọn vai trò**
Sau khi đăng nhập thành công, chọn vai trò:
- **👑 Admin**: Toàn quyền hệ thống
- **👨‍💼 Manager**: Quản lý đơn hàng và báo cáo
- **🔧 Technician**: Thực hiện dịch vụ sửa chữa
- **💰 Cashier**: Thanh toán và xuất hóa đơn
- **👁️ Viewer**: Chỉ xem thông tin

---

## 👥 QUẢN LÝ KHÁCH HÀNG

### **Thêm khách hàng mới**

#### **Bước 1: Truy cập menu**
1. Click **"👥 Khách hàng"** trên thanh menu
2. Click **"➕ Thêm mới"** ở góc phải

#### **Bước 2: Nhập thông tin**
```
┌─────────────────────────────────────────────────────────┐
│              THÊM KHÁCH HÀNG MỚI                        │
├─────────────────────────────────────────────────────────┤
│ Thông tin cá nhân:                                      │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Họ tên *        │ │ SĐT *           │                 │
│ │ [Nguyễn Văn A]  │ │ [0901234567]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Email           │ │ Ngày sinh       │                 │
│ │ [a@email.com]   │ │ [01/01/1990]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Địa chỉ                                            │ │
│ │ [123 Đường ABC, Quận 1, TP.HCM]                    │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Thông tin bổ sung:                                      │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ghi chú         │ │ Loại khách hàng │                 │
│ │ [Khách VIP]     │ │ [Cá nhân ▼]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 3: Lưu thông tin**
1. Kiểm tra lại thông tin
2. Click **"LƯU"** để lưu khách hàng
3. Hệ thống sẽ hiển thị thông báo thành công

### **Tìm kiếm khách hàng**
1. Vào danh sách khách hàng
2. Sử dụng thanh tìm kiếm:
```
🔍 [Tìm theo tên, SĐT, email...] [🔍 Tìm kiếm]
```
3. Kết quả sẽ được hiển thị ngay lập tức

### **Chỉnh sửa thông tin**
1. Click vào khách hàng cần sửa
2. Click **"✏️ Chỉnh sửa"**
3. Cập nhật thông tin
4. Click **"LƯU"**

---

## 🚗 QUẢN LÝ XE

### **Đăng ký xe mới**

#### **Bước 1: Chọn khách hàng**
1. Vào **"🚗 Xe"** → **"➕ Đăng ký xe mới"**
2. Chọn khách hàng sở hữu xe:
```
┌─────────────────────────────────┐
│    CHỌN KHÁCH HÀNG              │
├─────────────────────────────────┤
│ 🔍 [Tìm khách hàng...]          │
│                                 │
│ ✓ Nguyễn Văn A (0901234567)     │
│   Lê Thị B (0901234568)         │
│   Trần Văn C (0901234569)       │
│                                 │
│        [ TIẾP TỤC ]             │
└─────────────────────────────────┘
```

#### **Bước 2: Nhập thông tin xe**
```
┌─────────────────────────────────────────────────────────┐
│              ĐĂNG KÝ XE MỚI                             │
├─────────────────────────────────────────────────────────┤
│ Thông tin cơ bản:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Biển số *       │ │ Hãng xe *       │                 │
│ │ [30A-12345]     │ │ [Mercedes ▼]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Model *         │ │ Năm sản xuất    │                 │
│ │ [C-Class ▼]     │ │ [2020]          │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Màu sắc         │ │ Số khung (VIN)  │                 │
│ │ [Đen]           │ │ [WDD205XXX...]  │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Phân loại xe:                                           │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Loại sở hữu *   │ │ Loại sử dụng *  │                 │
│ │ [Cá nhân ▼]     │ │ [Tư nhân ▼]     │                 │
│ │                 │ │                 │                 │
│ │ Cá nhân         │ │ Tư nhân         │                 │
│ │ Công ty         │ │ Thương mại      │                 │
│ │ Thuê            │ │ Taxi            │                 │
│ │ Cho thuê        │ │ Giao hàng       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Thông tin bảo hiểm:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [✓] Có bảo hiểm                                    │ │
│ │ [ ] Không có bảo hiểm                              │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Công ty BH      │ │ Số hợp đồng     │                 │
│ │ [Bảo Việt ▼]    │ │ [BV123456789]   │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Loại bảo hiểm   │ │ Ngày bắt đầu    │                 │
│ │ [Toàn diện ▼]   │ │ [01/01/2024]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày kết thúc   │ │ Phí bảo hiểm    │                 │
│ │ [31/12/2024]    │ │ [5,000,000]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Thông tin công ty (nếu là xe công ty):                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tên công ty         │ [Công ty TNHH ABC]           │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mã số thuế      │ │ Người liên hệ   │                 │
│ │ [0123456789]    │ │ [Nguyễn Văn A]  │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ SĐT liên hệ     │ │ Phòng ban       │                 │
│ │ [0901234567]    │ │ [Vận hành]      │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

### **Quản lý thông tin xe**

#### **A. Xem danh sách xe theo phân loại**
```
┌─────────────────────────────────────────────────────────┐
│              DANH SÁCH XE THEO PHÂN LOẠI               │
├─────────────────────────────────────────────────────────┤
│ 🔍 [Tìm kiếm...]     📋 [Tất cả] 🏠 [Cá nhân] 🏢 [Công ty] │
│                                                         │
│ XE CÁ NHÂN (5 xe):                                    │
│ ✓ 30A-12345 - Mercedes C-Class 2020 - Nguyễn Minh Tuấn │
│ ✓ 30B-67890 - Toyota Camry 2019 - Lê Thị Hương        │
│ ✓ 30D-22222 - Honda Accord 2018 - Phạm Thị Lan        │
│ ✓ 30F-44444 - Hyundai Tucson 2019 - Võ Thị Mai        │
│ ✓ 30L-88888 - Honda Civic 2021 - Nguyễn Văn Thành     │
│                                                         │
│ XE CÔNG TY (3 xe):                                    │
│ ✓ 30C-11111 - BMW 3 Series 2020 - Công ty TNHH DEF    │
│ ✓ 30E-33333 - Ford Explorer 2021 - Công ty TNHH GHI   │
│ ✓ 30K-77777 - BMW X3 2019 - Công ty TNHH ABC          │
│                                                         │
│ XE TAXI (1 xe):                                       │
│ ✓ 30G-55555 - Mercedes E-Class 2018 - Đặng Văn Hùng   │
│                                                         │
│ XE CÓ BẢO HIỂM (6 xe):                               │
│ ✓ 30A-12345 - Bảo Việt (Toàn diện) - Hết hạn: 31/12  │
│ ✓ 30B-67890 - Prudential (Bên thứ 3) - Hết hạn: 30/11 │
│ ✓ 30C-11111 - FWD (Toàn diện) - Hết hạn: 15/03        │
│                                                         │
│ XE KHÔNG CÓ BẢO HIỂM (2 xe):                         │
│ ⚠️ 30H-66666 - Toyota RAV4 2020 - Cần mua bảo hiểm    │
│ ⚠️ 30L-88888 - Honda Civic 2021 - Cần mua bảo hiểm    │
└─────────────────────────────────────────────────────────┘
```

#### **B. Quản lý bảo hiểm xe**

##### **Thêm bảo hiểm mới cho xe**
1. Chọn xe cần thêm bảo hiểm
2. Click **"🛡️ Quản lý bảo hiểm"**
3. Click **"➕ Thêm bảo hiểm"**:

```
┌─────────────────────────────────────────────────────────┐
│              THÊM BẢO HIỂM MỚI                          │
├─────────────────────────────────────────────────────────┤
│ Thông tin xe:                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 30A-12345 - Mercedes C-Class 2020 - Nguyễn Minh Tuấn │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Thông tin bảo hiểm:                                    │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Công ty BH *    │ │ Số hợp đồng *   │                 │
│ │ [Bảo Việt ▼]    │ │ [BV2024001]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Loại bảo hiểm * │ │ Ngày bắt đầu *  │                 │
│ │ [Toàn diện ▼]   │ │ [01/01/2024]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày kết thúc * │ │ Phí bảo hiểm *  │                 │
│ │ [31/12/2024]    │ │ [5,000,000]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Thông tin đại lý:                                      │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tên đại lý      │ │ SĐT đại lý      │                 │
│ │ [Nguyễn Văn B]  │ │ [0909876543]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Email đại lý        │ [nguyenvanb@baoviet.com]     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Chi tiết bảo hiểm:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Bao gồm: Thiệt hại xe, thiệt hại người thứ 3,      │ │
│ │ trộm cắp, hỏa hoạn, thiên tai...                   │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số tiền khấu    │ │ Liên hệ khẩn    │                 │
│ │ trừ             │ │ cấp             │                 │
│ │ [500,000]       │ │ [0901234567]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

##### **Quản lý claim bảo hiểm**
1. Chọn xe có bảo hiểm
2. Click **"📋 Lịch sử bảo hiểm"**
3. Click **"➕ Tạo claim mới"**:

```
┌─────────────────────────────────────────────────────────┐
│              TẠO CLAIM BẢO HIỂM MỚI                     │
├─────────────────────────────────────────────────────────┤
│ Thông tin claim:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số claim *      │ │ Loại sự cố *    │                 │
│ │ [CLM-2024-001]  │ │ [Tai nạn ▼]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày sự cố *    │ │ Địa điểm *      │                 │
│ │ [15/01/2024]    │ │ [123 Nguyễn Huệ]│                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Mô tả sự cố:                                           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Xe bị va chạm từ phía sau, cản xe bị móp,          │ │
│ │ đèn pha bị vỡ. Cần sửa chữa toàn bộ cản xe        │ │
│ │ và thay đèn pha.                                   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Thông tin điều chỉnh viên:                             │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tên điều chỉnh  │ │ SĐT             │                 │
│ │ [Trần Văn C]    │ │ [0908765432]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Email              │ [tranvanc@baoviet.com]        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Thiệt hại ước tính:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Số tiền ước tính: 4,500,000 VNĐ                    │ │
│ │ Chi tiết:                                          │ │
│ │ - Sửa chữa cản xe: 2,500,000 VNĐ                   │ │
│ │ - Thay đèn pha: 2,000,000 VNĐ                      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Tài liệu đính kèm:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [📎] Ảnh thiệt hại (5 files)                        │ │
│ │ [📎] Biên bản công an (1 file)                      │ │
│ │ [📎] Báo giá sửa chữa (1 file)                      │ │
│ │                                                     │ │
│ │ [📤 Thêm tài liệu]                                  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TẠO CLAIM ]        [ HỦY ]                    │
└─────────────────────────────────────────────────────────┘
```

#### **C. Các thao tác khác**
- **Xem lịch sử sửa chữa**: Click **"📋 Lịch sử"**
- **Xem lịch sử bảo hiểm**: Click **"🛡️ Bảo hiểm"**
- **Thêm ghi chú**: Click **"📝 Ghi chú"**
- **Cập nhật thông tin**: Click **"✏️ Chỉnh sửa"**
- **Cảnh báo hết hạn bảo hiểm**: Hệ thống tự động hiển thị màu đỏ

---

## 🔧 QUẢN LÝ PHỤ TÙNG

### **Phân loại phụ tùng theo nguồn gốc và hóa đơn**

#### **📦 CÁC LOẠI PHỤ TÙNG**

```
┌─────────────────────────────────────────────────────────┐
│              PHÂN LOẠI PHỤ TÙNG                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 1. HÀNG MỚI CÓ HÓA ĐƠN (Purchased + WithInvoice):    │
│    ✅ Dùng cho: Công ty, Bảo hiểm, Cá nhân            │
│    ✅ Có hóa đơn VAT đầy đủ                            │
│    ✅ Xuất được hóa đơn đầu ra                         │
│    📝 VD: Đèn pha MB C-Class - Nhập từ MB Vietnam      │
│         Số HĐ: BV20240001 - Ngày: 10/01/2024         │
│                                                         │
│ 2. HÀNG MỚI KHÔNG HÓA ĐƠN (Purchased + WithoutInvoice): │
│    ⚠️ Chỉ dùng cho: Cá nhân (không yêu cầu HĐ)       │
│    ❌ KHÔNG dùng cho: Công ty, Bảo hiểm               │
│    ❌ KHÔNG xuất được hóa đơn đầu ra                  │
│    📝 VD: Gương chiếu hậu - Mua lẻ tại chợ            │
│         Không có hóa đơn                              │
│                                                         │
│ 3. HÀNG THÁO TỪ XE CŨ (Used + WithoutInvoice):       │
│    ⚠️ Chỉ dùng cho: Cá nhân (không yêu cầu HĐ)       │
│    ❌ KHÔNG dùng cho: Công ty, Bảo hiểm               │
│    ✅ Giá rẻ, tình trạng còn tốt                      │
│    📝 VD: Đèn xi nhan - Tháo từ xe 30A-12345          │
│         Đơn hàng: SO-2024-015                        │
│                                                         │
│ 4. HÀNG TÁI CHẾ (Refurbished):                       │
│    ⚠️ Phụ thuộc vào hóa đơn tái chế                   │
│    ⚠️ Nếu có HĐ: Dùng cho tất cả                      │
│    ⚠️ Nếu không HĐ: Chỉ dùng cá nhân                  │
│    📝 VD: Hộp số tái chế - Đại lý ủy quyền            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **⚠️ CẢNH BÁO KẾ TOÁN**

```
┌─────────────────────────────────────────────────────────┐
│              NGUYÊN TẮC SỬ DỤNG PHỤ TÙNG              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 🏢 XE CÔNG TY (Cần hóa đơn đầy đủ):                   │
│    ✅ CHỈ được dùng: Hàng có hóa đơn                   │
│    ❌ KHÔNG được dùng: Hàng không hóa đơn/tháo xe cũ   │
│    📋 Lý do: Cần hóa đơn để hạch toán chi phí         │
│                                                         │
│ 🛡️ XE BẢO HIỂM (Cần hóa đơn chính hãng):             │
│    ✅ CHỈ được dùng: Hàng mới có hóa đơn VAT           │
│    ✅ Ưu tiên: Phụ tùng chính hãng (OEM)               │
│    ❌ KHÔNG được dùng: Hàng không hóa đơn/tháo xe cũ   │
│    📋 Lý do: Bảo hiểm yêu cầu chứng từ đầy đủ         │
│                                                         │
│ 👤 XE CÁ NHÂN (Linh hoạt):                            │
│    ✅ CÓ THỂ dùng: Tất cả các loại                     │
│    ✅ Khách đồng ý: Dùng hàng tháo xe cũ giá rẻ        │
│    ⚠️ Lưu ý: Khách không yêu cầu hóa đơn              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 🔧 QUẢN LÝ PHỤ TÙNG

### **Nhập kho phụ tùng**

#### **A. Nhập hàng mới CÓ HÓA ĐƠN**
```
┌─────────────────────────────────────────────────────────┐
│              NHẬP KHO PHỤ TÙNG (CÓ HÓA ĐƠN)            │
├─────────────────────────────────────────────────────────┤
│ Thông tin cơ bản:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mã phụ tùng *   │ │ Tên phụ tùng *  │                 │
│ │ [HEADLIGHT001]  │ │ [Đèn pha MB...]  │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Nguồn gốc và hóa đơn:                                  │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Nguồn gốc *     │ │ Loại hóa đơn *  │                 │
│ │ [Mới (new) ▼]   │ │ [Có HĐ ▼]       │                 │
│ │                 │ │                 │                 │
│ │ • Mới           │ │ • Có hóa đơn    │                 │
│ │ • Tháo xe cũ    │ │ • Không HĐ      │                 │
│ │ • Tái chế       │ │ • Nội bộ        │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Thông tin hóa đơn:                                     │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Nhà cung cấp *  │ │ Số hóa đơn *    │                 │
│ │ [MB Vietnam ▼]  │ │ [BV20240001]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày hóa đơn *  │ │ Số lượng *      │                 │
│ │ [10/01/2024]    │ │ [5]             │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Giá nhập *      │ │ Giá bán *       │                 │
│ │ [2,500,000]     │ │ [3,200,000]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Phân loại sử dụng:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [✓] Cho phép dùng cho Công ty                      │ │
│ │ [✓] Cho phép dùng cho Bảo hiểm                     │ │
│ │ [✓] Cho phép dùng cho Cá nhân                      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ✅ HÀNG NÀY CÓ HÓA ĐƠN → Dùng được cho TẤT CẢ         │
│                                                         │
│        [ NHẬP KHO ]             [ HỦY ]                │
└─────────────────────────────────────────────────────────┘
```

#### **B. Nhập hàng KHÔNG HÓA ĐƠN (Mua lẻ)**
```
┌─────────────────────────────────────────────────────────┐
│          NHẬP KHO PHỤ TÙNG (KHÔNG HÓA ĐƠN)            │
├─────────────────────────────────────────────────────────┤
│ Thông tin cơ bản:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mã phụ tùng *   │ │ Tên phụ tùng *  │                 │
│ │ [MIRROR001]     │ │ [Gương chiếu...]│                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Nguồn gốc và hóa đơn:                                  │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Nguồn gốc *     │ │ Loại hóa đơn *  │                 │
│ │ [Mới (new) ▼]   │ │ [Không HĐ ▼]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Nguồn nhập:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Nguồn: [Mua lẻ tại chợ phụ tùng Bến Thành]        │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày mua *      │ │ Số lượng *      │                 │
│ │ [15/01/2024]    │ │ [3]             │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Giá mua *       │ │ Giá bán *       │                 │
│ │ [400,000]       │ │ [600,000]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Phân loại sử dụng:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [ ] Cho phép dùng cho Công ty                      │ │
│ │ [ ] Cho phép dùng cho Bảo hiểm                     │ │
│ │ [✓] Cho phép dùng cho Cá nhân                      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ⚠️ HÀNG NÀY KHÔNG HÓA ĐƠN → CHỈ dùng cho CÁ NHÂN     │
│                                                         │
│        [ NHẬP KHO ]             [ HỦY ]                │
└─────────────────────────────────────────────────────────┘
```

#### **C. Nhập hàng THÁO TỪ XE CŨ**
```
┌─────────────────────────────────────────────────────────┐
│          NHẬP KHO PHỤ TÙNG (THÁO TỪ XE CŨ)            │
├─────────────────────────────────────────────────────────┤
│ Thông tin cơ bản:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mã phụ tùng *   │ │ Tên phụ tùng *  │                 │
│ │ [USED-DOOR001]  │ │ [Cửa xe trái...]│                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Nguồn gốc và hóa đơn:                                  │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Nguồn gốc *     │ │ Tình trạng *    │                 │
│ │ [Tháo xe cũ ▼]  │ │ [Đã qua SD ▼]   │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Thông tin nguồn:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tháo từ xe *    │ │ Đơn hàng *      │                 │
│ │ [30C-11111 ▼]   │ │ [SO-2024-015]   │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Ghi chú: Tháo từ BMW 3 Series do thay cửa mới.    │ │
│ │          Tình trạng còn tốt 80%.                   │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày tháo *     │ │ Số lượng *      │                 │
│ │ [20/01/2024]    │ │ [1]             │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Định giá *      │ │ Giá bán đề xuất│                 │
│ │ [0]             │ │ [1,500,000]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Phân loại sử dụng:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [ ] Cho phép dùng cho Công ty                      │ │
│ │ [ ] Cho phép dùng cho Bảo hiểm                     │ │
│ │ [✓] Cho phép dùng cho Cá nhân                      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ⚠️ HÀNG THÁO XE CŨ → CHỈ dùng cho CÁ NHÂN            │
│                                                         │
│        [ NHẬP KHO ]             [ HỦY ]                │
└─────────────────────────────────────────────────────────┘
```

### **Thêm phụ tùng mới**

#### **Bước 1: Tạo nhóm phụ tùng**
1. Vào **"🔧 Phụ tùng"** → **"📁 Nhóm phụ tùng"**
2. Click **"➕ Thêm nhóm"**:
```
┌─────────────────────────────────────────────────────────┐
│              TẠO NHÓM PHỤ TÙNG                          │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tên nhóm *              │ [Bộ lọc gió động cơ]      │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Mã nhóm *               │ [AIR_FILTER_ENGINE]       │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Danh mục *             │ [Engine System ▼]          │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Danh mục con          │ [Air Intake ▼]              │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Chức năng             │ [Lọc không khí vào động cơ] │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Đơn vị                │ [Cái ▼]                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 2: Thêm phụ tùng cụ thể**
1. Chọn nhóm phụ tùng vừa tạo
2. Click **"➕ Thêm phụ tùng"**:
```
┌─────────────────────────────────────────────────────────┐
│              THÊM PHỤ TÙNG                              │
├─────────────────────────────────────────────────────────┤
│ Thông tin cơ bản:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mã phụ tùng *   │ │ Tên phụ tùng *  │                 │
│ │ [FILTER001]     │ │ [Bộ lọc gió MB] │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Nhóm phụ tùng * │ │ Thương hiệu     │                 │
│ │ [Bộ lọc gió ▼]  │ │ [MANN-FILTER]   │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Thông tin kỹ thuật:                                     │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số OEM          │ │ Số thay thế     │                 │
│ │ [A2710920100]   │ │ [C27009]        │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Kích thước      │ │ Trọng lượng     │                 │
│ │ [120x80x25mm]   │ │ [0.5 kg]        │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Giá cả:                                                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Giá nhập *      │ │ Giá bán *       │                 │
│ │ [150,000]       │ │ [200,000]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tồn kho *       │ │ Cảnh báo tối thiểu │              │
│ │ [10]            │ │ [2]             │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

### **Quản lý tồn kho**
1. Vào **"📦 Tồn kho"** để xem tình trạng
2. **Cảnh báo tồn kho thấp**: Hiển thị màu đỏ
3. **Nhập kho**: Click **"📥 Nhập kho"**
4. **Xuất kho**: Click **"📤 Xuất kho"**

---

## ⚙️ QUẢN LÝ DỊCH VỤ

### **Tạo dịch vụ sửa chữa**

#### **Bước 1: Tạo loại dịch vụ**
1. Vào **"⚙️ Dịch vụ"** → **"📁 Loại dịch vụ"**
2. Click **"➕ Thêm loại"**:
```
┌─────────────────────────────────────────────────────────┐
│              TẠO LOẠI DỊCH VỤ                           │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tên loại *      │ │ Mã loại *       │                 │
│ │ [Thay thế]      │ │ [REPLACE]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Danh mục *      │ │ Mô tả           │                 │
│ │ [Mechanical ▼]  │ │ [Thay thế phụ   │                 │
│ │                 │ │  tùng mới]      │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 2: Tạo công lao động**
1. Vào **"👷 Công lao động"** → **"📁 Danh mục công"**
2. Click **"➕ Thêm danh mục"**:
```
┌─────────────────────────────────────────────────────────┐
│              TẠO DANH MỤC CÔNG LAO ĐỘNG                 │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tên danh mục *  │ │ Mã danh mục *   │                 │
│ │ [Công tháo lắp] │ │ [REMOVE_INSTALL]│                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Đơn giá/giờ *   │ │ Mô tả           │                 │
│ │ [50,000]        │ │ [Công tháo và   │                 │
│ │                 │ │  lắp đặt phụ    │                 │
│ │                 │ │  tùng]          │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 3: Tạo chi tiết công lao động**
1. Chọn danh mục vừa tạo
2. Click **"➕ Thêm chi tiết công"**:
```
┌─────────────────────────────────────────────────────────┐
│              TẠO CHI TIẾT CÔNG LAO ĐỘNG                 │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tên công việc *         │ [Công tháo đèn pha]       │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Danh mục công *        │ [Công tháo lắp ▼]          │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Nhóm phụ tùng liên quan │ [Đèn pha ▼]               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Thông tin công việc:                                    │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số giờ chuẩn *  │ │ Đơn giá/giờ *   │                 │
│ │ [1.5]           │ │ [50,000]        │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mức độ kỹ năng  │ │ Độ khó          │                 │
│ │ [Trung bình ▼]  │ │ [Trung bình ▼]  │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Công cụ cần thiết     │ [Cờ lê 10, tuốc nơ vít]    │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Các bước thực hiện                                  │ │
│ │ [1. Tháo ốc vít                                     │ │
│ │  2. Tháo dây điện                                   │ │
│ │  3. Lắp đèn mới                                     │ │
│ │  4. Đấu dây điện                                    │ │
│ │  5. Lắp ốc vít]                                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ LƯU ]              [ HỦY ]                     │
└─────────────────────────────────────────────────────────┘
```

---

## 💼 TẠO ĐƠN HÀNG SỬA CHỮA

### **Quy trình tạo đơn hàng hoàn chỉnh**

#### **Bước 1: Tạo đơn hàng mới**
1. Vào **"💼 Đơn hàng"** → **"➕ Tạo đơn hàng mới"**
2. Chọn khách hàng và xe:
```
┌─────────────────────────────────────────────────────────┐
│              TẠO ĐƠN HÀNG MỚI                           │
├─────────────────────────────────────────────────────────┤
│ Thông tin cơ bản:                                       │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Khách hàng *    │ │ Xe *            │                 │
│ │ [Nguyễn Văn A ▼]│ │ [30A-12345 ▼]   │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Ngày đặt *      │ │ Ngày hẹn        │                 │
│ │ [15/01/2024]    │ │ [16/01/2024]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Ghi chú                                            │ │
│ │ [Khách hàng yêu cầu sửa chữa đèn pha]              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TIẾP TỤC ]                                     │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 2: Thêm dịch vụ**
1. Click **"➕ Thêm dịch vụ"**:
```
┌─────────────────────────────────────────────────────────┐
│              THÊM DỊCH VỤ                               │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Dịch vụ *               │ [Thay đèn pha ▼]          │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số lượng *      │ │ Đơn giá         │                 │
│ │ [1]             │ │ [150,000]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Thời gian (phút)│ │ Tổng tiền       │                 │
│ │ [90]            │ │ [150,000]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ THÊM ]              [ HỦY ]                    │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 3: Thêm phụ tùng**
1. Click **"➕ Thêm phụ tùng"**:
```
┌─────────────────────────────────────────────────────────┐
│              THÊM PHỤ TÙNG                               │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Phụ tùng *             │ [Bộ lọc gió động cơ ▼]     │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Phụ tùng cụ thể *     │ [Bộ lọc gió Mercedes ▼]    │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số lượng *      │ │ Đơn giá         │                 │
│ │ [1]             │ │ [200,000]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Có bảo hành     │ │ Bảo hành đến    │                 │
│ │ [✓]             │ │ [15/01/2025]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ THÊM ]              [ HỦY ]                    │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 4: Thêm công lao động**
1. Click **"➕ Thêm công lao động"**:
```
┌─────────────────────────────────────────────────────────┐
│              THÊM CÔNG LAO ĐỘNG                         │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Công lao động *       │ [Công tháo đèn pha ▼]       │ │
│ └─────────────────────────────────────────────────────┘ │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Thợ thực hiện   │ │ Số giờ thực tế  │                 │
│ │ [Nguyễn Văn B ▼]│ │ [1.5]           │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Đơn giá/giờ     │ │ Tổng tiền công  │                 │
│ │ [50,000]        │ │ [75,000]        │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Ghi chú thực hiện                                   │ │
│ │ [Đèn pha bị mờ, cần thay mới]                       │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ THÊM ]              [ HỦY ]                    │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 5: Tổng kết đơn hàng**
```
┌─────────────────────────────────────────────────────────┐
│              TỔNG KẾT ĐƠN HÀNG                          │
├─────────────────────────────────────────────────────────┤
│ Thông tin đơn hàng:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Số đơn hàng: SO-2024-001                           │ │
│ │ Khách hàng: Nguyễn Văn A                           │ │
│ │ Xe: 30A-12345 - Mercedes C-Class 2020               │ │
│ │ Ngày tạo: 15/01/2024 10:30                         │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Chi tiết:                                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ DỊCH VỤ:                                           │ │
│ │ • Thay đèn pha                    150,000 VNĐ       │ │
│ │                                                      │ │
│ │ PHỤ TÙNG:                                          │ │
│ │ • Bộ lọc gió Mercedes             200,000 VNĐ       │ │
│ │                                                      │ │
│ │ CÔNG LAO ĐỘNG:                                     │ │
│ │ • Công tháo đèn pha               75,000 VNĐ        │ │
│ │                                                      │ │
│ │ ─────────────────────────────────────────────────── │ │
│ │ TỔNG CỘNG:                         425,000 VNĐ      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ LƯU ĐƠN HÀNG ]        [ IN BÁO GIÁ ]          │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 6: Sau khi tạo phiếu sửa chữa xong**

Sau khi click **"Lưu"** và tạo phiếu sửa chữa thành công, phiếu sẽ có trạng thái **"Chờ Xử Lý" (Pending)**. Tiếp theo cần thực hiện:

**📋 QUY TRÌNH SAU KHI TẠO PHIẾU SỬA CHỮA:**

1. **✅ Bước 1: Chuyển sang "Chờ Phân Công"** (Xem chi tiết tại [2.1.1: Chuyển JO sang "Chờ Phân công"](#211-chuyển-jo-sang-chờ-phân-công))
   - Tìm phiếu vừa tạo (status = "Chờ Xử Lý")
   - Click nút **"→"** (Chuyển trạng thái) trong cột "Thao Tác"
   - Xác nhận → Phiếu chuyển sang **"Chờ Phân Công" (PendingAssignment)**

2. **✅ Bước 2: Phân Công KTV & Giờ Công** (Xem chi tiết tại [2.1.2: Phân công KTV & Thời gian](#212-phân-công-ktv--thời-gian))
   - Click nút **"👔 Phân Công KTV"** (màu xanh lá)
   - Chọn KTV cho từng hạng mục
   - Nhập Giờ Công Dự Kiến (0.1 - 24 giờ)
   - Click **"Lưu Tất Cả Phân Công"**
   - Nếu tất cả items đã phân công → Phiếu tự động chuyển sang **"Sẵn Sàng Làm" (ReadyToWork)**

3. **✅ Bước 3: Quản Lý Vật Tư (MR) - Tùy chọn** (Chỉ khi cần phụ tùng từ kho)
   - **❓ Khi nào cần tạo MR?**
     - ✅ Đơn hàng có phụ tùng (parts) cần xuất kho → **CẦN** tạo MR
     - ❌ Đơn hàng chỉ có dịch vụ và tiền công → **KHÔNG CẦN** tạo MR, bỏ qua bước này
   - **📝 Cách kiểm tra:**
     - Vào **"Yêu Cầu Vật Tư (MR)"** → Click **"+ Tạo MR"**
     - Chọn phiếu sửa chữa (JO)
     - Nếu hệ thống hiển thị thông báo "Không có phụ tùng cần xuất kho" → **Bỏ qua bước này**, chuyển sang Bước 4
     - Nếu có danh sách phụ tùng hiển thị → Tạo MR → Submit → Chờ phê duyệt → Xuất kho
   - **📊 Workflow MR:**
     - Tạo MR → Submit → Phê duyệt → Xuất kho
     - Phiếu sẽ chuyển sang **"Chờ Vật Tư" (WaitingForParts)** → **"Sẵn Sàng Làm" (ReadyToWork)**

4. **✅ Bước 4: Bắt Đầu Sửa Chữa**
   - Khi status = **"Sẵn Sàng Làm"**, click **"Chuyển Trạng Thái"**
   - Chọn **"Đang Sửa Chữa" (InProgress)**
   - Phiếu chuyển sang **"Đang Sửa Chữa"**

5. **✅ Bước 5: Hoàn Thành**
   - Khi hoàn thành công việc, click **"Chuyển Trạng Thái"**
   - Chọn **"Đã Hoàn Thành" (Completed)**
   - Phiếu chuyển sang **"Đã Hoàn Thành"** → Workflow kết thúc

**⚠️ Lưu ý quan trọng:**
- ✅ Khi phiếu ở trạng thái **"Sẵn Sàng Làm" (ReadyToWork)** hoặc **"Đang Sửa Chữa" (InProgress)**:
  - ✅ **Có thể đổi KTV** nếu cần (nút "Đổi KTV" màu vàng)
  - ❌ **Không thể Edit/Delete** phiếu trực tiếp (phải dùng workflow)
- ✅ Sau khi tạo phiếu, Báo Giá sẽ bị **khóa** (không thể chỉnh sửa)

**📊 Tóm tắt workflow:**
```
Tạo Phiếu (Pending)
    ↓
Chuyển sang Chờ Phân Công (PendingAssignment)
    ↓
Phân Công KTV → Sẵn Sàng Làm (ReadyToWork)
    ↓
[❓ Có phụ tùng?]
    ├─ CÓ → Tạo MR → Xuất kho → Sẵn Sàng Làm
    └─ KHÔNG → Bỏ qua MR
    ↓
Bắt Đầu Sửa Chữa → Đang Sửa Chữa (InProgress)
    ↓
Hoàn Thành → Đã Hoàn Thành (Completed)
```

**💡 Lưu ý:**
- ✅ Nếu đơn hàng **chỉ có dịch vụ và tiền công** (không có phụ tùng):
  - ❌ **KHÔNG CẦN** tạo MR
  - ✅ **Bỏ qua** Bước 3, chuyển thẳng sang Bước 4 (Bắt Đầu Sửa Chữa)
- ✅ Hệ thống sẽ tự động phát hiện và thông báo khi không có phụ tùng

---

## 📦 QUẢN LÝ KHO CHI TIẾT

### **Tổng quan về quản lý kho**

**Nguyên tắc cơ bản:**
- **Mọi thay đổi tồn kho** phải được ghi nhận qua **Giao dịch kho**
- **Không được sửa trực tiếp** số lượng tồn kho
- **Tất cả giao dịch** đều có lịch sử để kiểm tra

**Các loại giao dịch kho:**
- 🔵 **Tồn đầu kỳ**: Ghi nhận hàng có sẵn khi bắt đầu sử dụng hệ thống
- 🟢 **Nhập kho**: Ghi nhận hàng mới từ nhà cung cấp
- 🔴 **Xuất kho**: Ghi nhận hàng đã sử dụng cho sửa chữa hoặc bán
- 🟡 **Điều chỉnh**: Điều chỉnh tồn kho khi kiểm kê

---

### **🆕 QUY TRÌNH TẠO SẢN PHẨM MỚI**

#### **Bước 1: Tạo danh mục sản phẩm**

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Phụ Tùng`
2. **Click nút:** `+ Thêm Phụ Tùng`
3. **Điền thông tin sản phẩm:**

```
┌─────────────────────────────────────────────────────────┐
│              TẠO SẢN PHẨM MỚI                          │
├─────────────────────────────────────────────────────────┤
│ Thông tin bắt buộc:                                    │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Mã phụ tùng *   │ │ Tên phụ tùng *  │                 │
│ │ [ACQUY_NEW]     │ │ [Ắc Quy GS N70] │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Giá vốn *       │ │ Giá bán *       │                 │
│ │ [1,500,000]     │ │ [1,650,000]     │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Tồn tối thiểu * │ │ Đơn vị *        │                 │
│ │ [5]             │ │ [CÁI ▼]         │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Danh mục *      │ │ Thương hiệu *   │                 │
│ │ [Ắc quy ▼]      │ │ [GS ▼]          │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ ⚠️ Lưu ý: Số lượng tồn kho mặc định = 0                │
│                                                         │
│        [ HỦY ]                    [ LƯU ]               │
└─────────────────────────────────────────────────────────┘
```

4. **Click:** `Lưu`
5. **Kết quả:** Sản phẩm được tạo với `Số lượng tồn kho = 0`

---

### **📥 QUY TRÌNH NHẬP KHO**

#### **Tình huống 1: Ghi nhận tồn đầu kỳ**

**Khi nào:** Khi bắt đầu sử dụng hệ thống và có sẵn hàng trong kho

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Tồn Kho`
2. **Click nút:** `+ Thêm Giao Dịch Mới`
3. **Điền thông tin:**

```
┌─────────────────────────────────────────────────────────┐
│              GHI NHẬN TỒN ĐẦU KỲ                       │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Loại giao dịch: [Tồn đầu kỳ ▼]                    │ │
│ │ Phụ tùng: [ACQUY_NEW - Ắc Quy GS N70 Mới ▼]       │ │
│ │ Số lượng: [10]                                     │ │
│ │ Giá vốn đơn vị: [1,500,000 VNĐ]                   │ │
│ │ Giá bán đơn vị: [1,650,000 VNĐ]                   │ │
│ │ Ngày giao dịch: [01/01/2025 08:00]                │ │
│ │ Ghi chú: [Tồn đầu kỳ - Ắc Quy GS N70 Mới]         │ │
│ │ Có hóa đơn: [✅ Có]                               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ HỦY ]                    [ LƯU ]               │
└─────────────────────────────────────────────────────────┘
```

4. **Click:** `Lưu`

**✅ Kết quả:**
- Tạo `StockTransaction` (Type = TonDauKy)
- `Parts.QuantityInStock` tự động cập nhật: `0 → 10`
- Hiển thị trong bảng lịch sử giao dịch kho

#### **Tình huống 2: Nhập hàng từ nhà cung cấp**

**Khi nào:** Khi nhận hàng mới từ nhà cung cấp

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Tồn Kho`
2. **Click nút:** `+ Thêm Giao Dịch Mới`
3. **Điền thông tin:**

```
┌─────────────────────────────────────────────────────────┐
│              NHẬP HÀNG TỪ NHÀ CUNG CẤP                 │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Loại giao dịch: [Nhập kho ▼]                       │ │
│ │ Phụ tùng: [ACQUY_NEW - Ắc Quy GS N70 Mới ▼]       │ │
│ │ Số lượng: [20]                                     │ │
│ │ Nhà cung cấp: [NCC Ắc Quy Miền Nam]               │ │
│ │ Số hóa đơn: [HD-2025-001]                         │ │
│ │ Giá vốn đơn vị: [1,480,000 VNĐ] (giá mới)        │ │
│ │ Giá bán đơn vị: [1,650,000 VNĐ]                   │ │
│ │ Ngày giao dịch: [15/01/2025 10:00]                │ │
│ │ Ghi chú: [Nhập kho - Ắc Quy GS N70 Mới]           │ │
│ │ Có hóa đơn: [✅ Có]                               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ HỦY ]                    [ LƯU ]               │
└─────────────────────────────────────────────────────────┘
```

4. **Click:** `Lưu`

**✅ Kết quả:**
- Tạo `StockTransaction` (Type = NhapKho)
- `Parts.QuantityInStock` tự động cập nhật: `10 → 30`
- Hệ thống tự động tính giá trung bình
- Tổng giá trị nhập kho tự động tính

#### **Tình huống 3: Nhập hàng từ Excel**

**Khi nào:** Khi có nhiều sản phẩm cần nhập cùng lúc

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Tồn Kho`
2. **Click nút:** `Tải Template` để lấy file mẫu
3. **Điền dữ liệu vào Excel:**

```
Mã Hiệu    | Tên VTTH              | Đơn Vị | Tồn Đầu Kỳ | Đơn Giá  | Ghi Chú
ACQUY_NEW  | Ắc Quy GS N70 Mới    | CÁI    | 10         | 1500000  | Tồn đầu kỳ
LOTP_NEW   | Lốp Michelin 205/55  | Chiếc  | 20         | 1200000  | Tồn đầu kỳ
```

4. **Click nút:** `Import Excel`
5. **Chọn file Excel** và click `Tải lên`
6. **Kiểm tra preview** và click `Xác nhận nhập`

---

### **📤 QUY TRÌNH XUẤT KHO**

#### **Tình huống 1: Xuất kho cho đơn sửa chữa**

**Cách 1: Từ đơn sửa chữa (Tự động)**
1. **Vào menu:** `Quản Lý Đơn Hàng` → `Quản Lý Lệnh Sửa Chữa`
2. **Mở đơn sửa chữa** cần thêm phụ tùng
3. **Click tab:** `Phụ Tùng`
4. **Click nút:** `Thêm Phụ Tùng`
5. **Điền thông tin:**
   - **Phụ tùng**: Chọn từ danh sách
   - **Số lượng**: `1`
   - **Giá bán**: Tự động điền từ giá bán của sản phẩm
6. **Click:** `Lưu`
7. **Hệ thống tự động:**
   - Tạo giao dịch xuất kho
   - Cập nhật số lượng tồn kho
   - Gắn với đơn sửa chữa

**Cách 2: Xuất kho thủ công**
1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Tồn Kho`
2. **Click nút:** `+ Thêm Giao Dịch Mới`
3. **Điền thông tin:**

```
┌─────────────────────────────────────────────────────────┐
│              XUẤT KHO THỦ CÔNG                         │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Loại giao dịch: [Xuất kho ▼]                       │ │
│ │ Phụ tùng: [ACQUY_NEW - Ắc Quy GS N70 Mới ▼]       │ │
│ │ Số lượng: [5]                                      │ │
│ │ Lý do xuất: [Sửa chữa ▼]                          │ │
│ │ Đơn hàng liên quan: [SO-2025-001] (tùy chọn)      │ │
│ │ Ngày giao dịch: [20/01/2025 14:00]                │ │
│ │ Ghi chú: [Xuất kho - Ắc Quy GS N70 Mới cho đơn...]│ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ HỦY ]                    [ LƯU ]               │
└─────────────────────────────────────────────────────────┘
```

4. **Click:** `Lưu`

#### **Tình huống 2: Xuất kho bán lẻ**

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Tồn Kho`
2. **Click nút:** `+ Thêm Giao Dịch Mới`
3. **Điền thông tin:**
   - **Loại giao dịch**: `Xuất kho`
   - **Phụ tùng**: Chọn sản phẩm
   - **Số lượng**: `2`
   - **Lý do xuất**: `Bán lẻ`
   - **Khách hàng**: `Nguyễn Văn A` (tùy chọn)
   - **Ngày giao dịch**: `22/01/2025 09:00`
   - **Ghi chú**: `Xuất kho bán lẻ - Ắc Quy GS N70 Mới`
4. **Click:** `Lưu`

---

### **📊 THEO DÕI TỒN KHO**

#### **Xem tồn kho hiện tại**

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Phụ Tùng`
2. **Xem bảng danh sách** với các cột:
   - **Mã phụ tùng**
   - **Tên phụ tùng**
   - **Tồn cuối kỳ**: Số lượng hiện có
   - **Tồn tối thiểu**: Mức cảnh báo
   - **Trạng thái**: 🟢 Đủ hàng / 🔴 Sắp hết / ❌ Hết hàng

#### **Xem lịch sử giao dịch**

1. **Vào menu:** `Quản Lý Kho` → `Quản Lý Tồn Kho`
2. **Xem bảng giao dịch** với các cột:
   - **Mã giao dịch**: `ST001`, `ST002`...
   - **Phụ tùng**: Tên sản phẩm
   - **Loại giao dịch**: 
     - 🔵 `Tồn đầu kỳ`
     - 🟢 `Nhập kho`
     - 🔴 `Xuất kho`
   - **Số lượng**: Số lượng giao dịch
   - **Tồn trước**: Tồn kho trước giao dịch
   - **Tồn sau**: Tồn kho sau giao dịch
   - **Đơn giá**: Giá đơn vị
   - **Thành tiền**: Tổng giá trị
   - **Ngày giao dịch**: Thời gian thực hiện
   - **Ghi chú**: Mô tả giao dịch

#### **Tìm kiếm giao dịch**

**Tìm theo:**
- **Mã giao dịch**: `ST001`
- **Tên phụ tùng**: `Ắc Quy`
- **Loại giao dịch**: `Nhập kho`
- **Ngày**: Từ `01/01/2025` đến `31/01/2025`

**Cách sử dụng:**
1. **Nhập từ khóa** vào ô tìm kiếm
2. **Chọn bộ lọc** (nếu có)
3. **Click:** `Tìm kiếm`

---

### **📈 BÁO CÁO VÀ THỐNG KÊ**

#### **Báo cáo tồn kho**

1. **Vào menu:** `Quản Lý Kho` → `Báo Cáo Tồn Kho`
2. **Chọn thời gian**: Tháng, quý, năm
3. **Chọn danh mục**: Tất cả hoặc danh mục cụ thể
4. **Click:** `Tạo báo cáo`

**Nội dung báo cáo:**
- **Tổng số sản phẩm**: 150 loại
- **Tổng giá trị tồn kho**: 2,500,000,000 VNĐ
- **Sản phẩm sắp hết**: 15 loại
- **Sản phẩm hết hàng**: 3 loại
- **Top 10 sản phẩm** có giá trị cao nhất

#### **Báo cáo nhập xuất**

1. **Vào menu:** `Quản Lý Kho` → `Báo Cáo Nhập Xuất`
2. **Chọn loại báo cáo:**
   - **Báo cáo nhập kho**: Thống kê hàng nhập
   - **Báo cáo xuất kho**: Thống kê hàng xuất
   - **Báo cáo tổng hợp**: Cả nhập và xuất
3. **Chọn thời gian** và **Click:** `Tạo báo cáo`

**Nội dung báo cáo:**
- **Tổng giá trị nhập**: 5,000,000 VNĐ
- **Tổng giá trị xuất**: 3,500,000 VNĐ
- **Số lượng giao dịch**: 25 lần
- **Nhà cung cấp lớn nhất**: NCC ABC
- **Sản phẩm xuất nhiều nhất**: Ắc quy GS

---

### **❓ CÂU HỎI THƯỜNG GẶP**

#### **Q1: Tại sao không thể sửa trực tiếp số lượng tồn kho?**

**A:** Để đảm bảo tính minh bạch và có thể kiểm tra lịch sử. Mọi thay đổi tồn kho phải được ghi nhận qua giao dịch để:
- Có lịch sử rõ ràng
- Dễ dàng kiểm tra và đối chiếu
- Tránh sai sót và gian lận

#### **Q2: Khi nào nên sử dụng "Tồn đầu kỳ"?**

**A:** Sử dụng khi:
- Bắt đầu sử dụng hệ thống
- Có sẵn hàng trong kho từ trước
- Kiểm kê và ghi nhận lại tồn kho

#### **Q3: Làm sao biết sản phẩm nào sắp hết hàng?**

**A:** Hệ thống sẽ:
- **Hiển thị cảnh báo** màu đỏ khi `Tồn kho < Tồn tối thiểu`
- **Gửi thông báo** email (nếu cấu hình)
- **Hiển thị trong báo cáo** tồn kho

#### **Q4: Có thể xóa giao dịch kho không?**

**A:** **Không được xóa** giao dịch đã lưu. Nếu sai sót:
- **Tạo giao dịch điều chỉnh** để sửa lại
- **Liên hệ quản trị viên** để hỗ trợ

#### **Q5: Làm sao tính giá trung bình khi nhập hàng nhiều lần?**

**A:** Hệ thống tự động tính theo công thức:
```
Giá trung bình = (Giá cũ × Số lượng cũ + Giá mới × Số lượng mới) ÷ Tổng số lượng
```

**Ví dụ:**
- Lần 1: 10 cái × 1,500,000 = 15,000,000
- Lần 2: 20 cái × 1,480,000 = 29,600,000
- **Giá trung bình**: (15,000,000 + 29,600,000) ÷ 30 = **1,486,667 VNĐ**

#### **Q6: Có thể in báo cáo tồn kho không?**

**A:** Có, hệ thống hỗ trợ:
- **In trực tiếp** từ màn hình
- **Xuất Excel** để chỉnh sửa
- **Xuất PDF** để gửi email

#### **Q7: Làm sao phân quyền cho nhân viên?**

**A:** Quản trị viên có thể cấp quyền:
- **Xem tồn kho**: Chỉ xem, không sửa
- **Nhập kho**: Được tạo giao dịch nhập
- **Xuất kho**: Được tạo giao dịch xuất
- **Quản lý đầy đủ**: Tất cả quyền

---

## 💰 QUẢN LÝ THANH TOÁN

### **Tạo hóa đơn thanh toán**

#### **Bước 1: Chọn đơn hàng**
1. Vào **"💰 Thanh toán"** → **"➕ Tạo hóa đơn"**
2. Chọn đơn hàng cần thanh toán:
```
┌─────────────────────────────────────────────────────────┐
│              CHỌN ĐƠN HÀNG THANH TOÁN                   │
├─────────────────────────────────────────────────────────┤
│ 🔍 [Tìm đơn hàng...]                                    │
│                                                         │
│ ✓ SO-2024-001 - Nguyễn Văn A - 30A-12345               │
│   Tổng tiền: 425,000 VNĐ - Chưa thanh toán             │
│                                                         │
│   SO-2024-002 - Lê Thị B - 30B-67890                   │
│   Tổng tiền: 320,000 VNĐ - Thanh toán một phần         │
│                                                         │
│        [ TIẾP TỤC ]                                     │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 2: Nhập thông tin thanh toán**
```
┌─────────────────────────────────────────────────────────┐
│              THÔNG TIN THANH TOÁN                       │
├─────────────────────────────────────────────────────────┤
│ Thông tin hóa đơn:                                      │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Số hóa đơn *    │ │ Ngày thanh toán │                 │
│ │ [INV-2024-001]  │ │ [15/01/2024]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Phương thức *   │ │ Số tiền *       │                 │
│ │ [Tiền mặt ▼]    │ │ [425,000]       │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ Chi tiết thanh toán:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tổng tiền đơn hàng:           425,000 VNĐ          │ │
│ │ Giảm giá:                     0 VNĐ                │ │
│ │ Thuế VAT (10%):              42,500 VNĐ            │ │
│ │ ─────────────────────────────────────────────────── │ │
│ │ TỔNG THANH TOÁN:             467,500 VNĐ          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TẠO HÓA ĐƠN ]        [ HỦY ]                  │
└─────────────────────────────────────────────────────────┘
```

### **Quản lý công nợ**
1. Vào **"📊 Công nợ"** để xem danh sách khách nợ
2. **Lọc theo trạng thái**: Tất cả, Đã thanh toán, Chưa thanh toán
3. **Gửi nhắc nợ**: Click **"📧 Gửi nhắc nợ"**

---

## 🛠️ QUẢN LÝ ĐƠN HÀNG SỬA CHỮA

### **Quy trình tạo đơn hàng hoàn chỉnh**

#### **Bước 1: Tiếp nhận xe và kiểm tra**

```
┌─────────────────────────────────────────────────────────┐
│              TẠO ĐƠN HÀNG SỬA CHỮA                      │
├─────────────────────────────────────────────────────────┤
│ BƯỚC 1: CHỌN KHÁCH HÀNG VÀ XE                          │
│                                                         │
│ Khách hàng:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 🔍 [Tìm kiếm khách hàng...]                        │ │
│ │                                                     │ │
│ │ ✓ Nguyễn Minh Tuấn - 0901234567                    │ │
│ │   Email: tuan.nguyen@email.com                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Chọn xe:                                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ( ) 30A-12345 - Mercedes C-Class 2020 - Cá nhân   │ │
│ │     Bảo hiểm: Bảo Việt (Còn HSD: 31/12/2024)      │ │
│ │                                                     │ │
│ │ ( ) 30C-11111 - BMW 3 Series 2020 - Công ty       │ │
│ │     Công ty: TNHH DEF                              │ │
│ │     Bảo hiểm: FWD (Còn HSD: 15/03/2024)           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TIẾP TỤC ]             [ HỦY ]                │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 2: Kiểm tra tình trạng xe**

```
┌─────────────────────────────────────────────────────────┐
│              KIỂM TRA TÌNH TRẠNG XE                     │
├─────────────────────────────────────────────────────────┤
│ Xe: 30A-12345 - Mercedes C-Class 2020                  │
│ Khách hàng: Nguyễn Minh Tuấn                           │
│ Loại xe: Cá nhân                                       │
│                                                         │
│ Số km hiện tại:                                        │
│ ┌─────────────────┐                                     │
│ │ [45,000] km     │                                     │
│ └─────────────────┘                                     │
│                                                         │
│ Tình trạng phát hiện:                                  │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ☑ Động cơ         [✓] Bình thường  [ ] Có vấn đề  │ │
│ │ ☑ Hộp số          [✓] Bình thường  [ ] Có vấn đề  │ │
│ │ ☑ Hệ thống phanh  [✓] Bình thường  [ ] Có vấn đề  │ │
│ │ ☑ Hệ thống điện   [ ] Bình thường  [✓] Có vấn đề  │ │
│ │   → Đèn pha bị mờ, cần thay mới                   │ │
│ │ ☑ Thân vỏ         [✓] Bình thường  [ ] Có vấn đề  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Yêu cầu khách hàng:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Thay đèn pha mới, khách yêu cầu phụ tùng chính    │ │
│ │ hãng. Hoàn thành trong 1 ngày.                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TIẾP TỤC ]             [ QUAY LẠI ]           │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 3: Chọn dịch vụ và phụ tùng**

```
┌─────────────────────────────────────────────────────────┐
│              CHỌN DỊCH VỤ VÀ PHỤ TÙNG                   │
├─────────────────────────────────────────────────────────┤
│ DỊCH VỤ:                                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 🔍 [Tìm dịch vụ...]                                │ │
│ │                                                     │ │
│ │ ✓ Thay đèn pha Mercedes C-Class                    │ │
│ │   Giá: 200,000 VNĐ | Thời gian: 90 phút           │ │
│ │   Bao gồm: Công tháo lắp + điều chỉnh             │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ PHỤ TÙNG CẦN THIẾT:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 🔍 [Tìm phụ tùng...]   [Lọc: ✓Có HĐ ▼]           │ │
│ │                                                     │ │
│ │ ⭐ ĐỂ Ý: Xe CÁ NHÂN - Có thể dùng TẤT CẢ loại hàng│ │
│ │                                                     │ │
│ │ ✅ CÓ HÓA ĐƠN (Khuyến nghị):                       │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ [✓] Đèn pha Mercedes C-Class W205 (OEM)      │  │ │
│ │ │     Mã: HEADLIGHT001                          │  │ │
│ │ │     Giá: 3,200,000 VNĐ | Tồn: 3 cái          │  │ │
│ │ │     ✅ Có hóa đơn VAT                          │  │ │
│ │ │     📦 Nguồn: MB Vietnam                       │  │ │
│ │ │     🛡️ Bảo hành: 24 tháng                      │  │ │
│ │ │     Số lượng: [1] ▼                           │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ │                                                     │ │
│ │ ⚠️ KHÔNG HÓA ĐƠN (Giá rẻ hơn):                    │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ [ ] Đèn pha tương thích (Aftermarket)        │  │ │
│ │ │     Mã: HEADLIGHT002                          │  │ │
│ │ │     Giá: 1,800,000 VNĐ | Tồn: 2 cái          │  │ │
│ │ │     ⚠️ Không có hóa đơn                        │  │ │
│ │ │     📦 Nguồn: Mua lẻ                           │  │ │
│ │ │     ⚠️ Bảo hành: 6 tháng                       │  │ │
│ │ │     Số lượng: [1] ▼                           │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ CÔNG LAO ĐỘNG:                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✓ Công tháo đèn pha         1.0 giờ x 50,000 VNĐ  │ │
│ │ ✓ Công lắp đèn pha          0.5 giờ x 50,000 VNĐ  │ │
│ │ ✓ Công điều chỉnh góc chiếu 0.5 giờ x 50,000 VNĐ  │ │
│ │ Tổng: 2.0 giờ = 100,000 VNĐ                       │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ TỔNG CỘNG:                                             │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Dịch vụ:      200,000 VNĐ                         │ │
│ │ Phụ tùng:   3,200,000 VNĐ                         │ │
│ │ Công:         100,000 VNĐ                         │ │
│ │ ─────────────────────────                         │ │
│ │ TỔNG:       3,500,000 VNĐ                         │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TẠO ĐƠN ]    [ QUAY LẠI ]    [ HỦY ]         │
└─────────────────────────────────────────────────────────┘
```

#### **⚠️ Trường hợp XE CÔNG TY hoặc BẢO HIỂM**

```
┌─────────────────────────────────────────────────────────┐
│              CHỌN PHỤ TÙNG - XE CÔNG TY                 │
├─────────────────────────────────────────────────────────┤
│ ⚠️ ĐÂY LÀ XE CÔNG TY - CHỈ DÙNG HÀNG CÓ HÓA ĐƠN       │
│                                                         │
│ PHỤ TÙNG KHẢ DỤNG:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ CÓ HÓA ĐƠN (Được phép sử dụng):                 │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ [✓] Đèn pha Mercedes C-Class W205 (OEM)      │  │ │
│ │ │     Giá: 3,200,000 VNĐ | Tồn: 3 cái          │  │ │
│ │ │     ✅ Có hóa đơn VAT - MB Vietnam            │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ │                                                     │ │
│ │ ❌ KHÔNG HÓA ĐƠN (KHÔNG được phép):                │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ [ ] Đèn pha tương thích (Aftermarket)        │  │ │
│ │ │     ❌ BỊ VÔ HIỆU HÓA                          │  │ │
│ │ │     ⚠️ Xe công ty cần hóa đơn để hạch toán    │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ │                                                     │ │
│ │ [ ] Đèn tháo xe cũ (Used)                          │ │
│ │     ❌ BỊ VÔ HIỆU HÓA                              │  │ │
│ │     ⚠️ Không đủ tiêu chuẩn cho xe công ty        │  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 💡 LƯU Ý: Hệ thống tự động lọc chỉ hiển thị hàng có   │
│    hóa đơn khi chọn xe công ty hoặc bảo hiểm.         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 4: Xác nhận và tạo đơn**

```
┌─────────────────────────────────────────────────────────┐
│              XÁC NHẬN ĐƠN HÀNG                          │
├─────────────────────────────────────────────────────────┤
│ Số đơn: SO-2024-001                                    │
│ Ngày tạo: 15/01/2024 10:30                            │
│                                                         │
│ THÔNG TIN KHÁCH HÀNG:                                  │
│ • Tên: Nguyễn Minh Tuấn                                │
│ • SĐT: 0901234567                                      │
│ • Email: tuan.nguyen@email.com                         │
│                                                         │
│ THÔNG TIN XE:                                          │
│ • Biển số: 30A-12345                                   │
│ • Xe: Mercedes C-Class 2020                            │
│ • Loại: Cá nhân                                        │
│ • Số km: 45,000 km                                     │
│                                                         │
│ CHI TIẾT ĐƠN HÀNG:                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ DỊCH VỤ:                                           │ │
│ │ • Thay đèn pha Mercedes C-Class     200,000 VNĐ    │ │
│ │                                                     │ │
│ │ PHỤ TÙNG:                                          │ │
│ │ • Đèn pha MB C-Class W205 (x1)   3,200,000 VNĐ    │ │
│ │   ✅ Có hóa đơn VAT                                │ │
│ │                                                     │ │
│ │ CÔNG LAO ĐỘNG:                                     │ │
│ │ • Công tháo đèn pha (1.0h)          50,000 VNĐ    │ │
│ │ • Công lắp đèn pha (0.5h)           25,000 VNĐ    │ │
│ │ • Công điều chỉnh (0.5h)            25,000 VNĐ    │ │
│ │                                                     │ │
│ │ TỔNG CỘNG:                       3,500,000 VNĐ    │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ THỜI GIAN:                                             │
│ • Dự kiến hoàn thành: 16/01/2024 15:00                │
│ • Thời gian sửa chữa: ~4 giờ                           │
│                                                         │
│ PHÂN CÔNG:                                             │
│ • Thợ chính: Nguyễn Văn Minh                           │
│ • Trợ lý: -                                            │
│                                                         │
│ GHI CHÚ:                                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Khách yêu cầu hoàn thành trong 1 ngày. Dùng phụ   │ │
│ │ tùng chính hãng có bảo hành.                       │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ XÁC NHẬN ]    [ SỬA ]    [ HỦY ]              │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 5: Thực hiện sửa chữa**

```
┌─────────────────────────────────────────────────────────┐
│              THỰC HIỆN SỬA CHỮA                         │
├─────────────────────────────────────────────────────────┤
│ Đơn hàng: SO-2024-001                                  │
│ Trạng thái: 🔧 Đang thực hiện                          │
│                                                         │
│ TIẾN TRÌNH:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Tiếp nhận xe        08:00 - 15/01/2024          │ │
│ │ ✅ Kiểm tra tình trạng 08:15 - 15/01/2024          │ │
│ │ ✅ Tạo đơn hàng        10:30 - 15/01/2024          │ │
│ │ 🔧 Tháo đèn cũ         14:00 - 16/01/2024 (Đang)  │ │
│ │ ⏳ Lắp đèn mới         -                            │ │
│ │ ⏳ Điều chỉnh          -                            │ │
│ │ ⏳ Kiểm tra cuối       -                            │ │
│ │ ⏳ Giao xe             -                            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ CÔNG LAO ĐỘNG THỰC HIỆN:                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Thợ: Nguyễn Văn Minh                               │ │
│ │ Bắt đầu: 16/01/2024 08:00                          │ │
│ │ Hiện tại: 16/01/2024 14:30 (6.5 giờ)              │ │
│ │                                                     │ │
│ │ • Công tháo đèn pha: ✅ Hoàn thành (1.5h thực tế)  │ │
│ │ • Công lắp đèn pha: 🔧 Đang thực hiện...           │ │
│ │ • Công điều chỉnh: ⏳ Chờ                           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ PHỤ TÙNG ĐÃ XUẤT KHO:                                  │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Đèn pha MB C-Class (x1) - Xuất lúc 08:30        │ │
│ │    Lô: BATCH-2024-001 (Có HĐ VAT)                 │ │
│ │    Tồn kho còn: 2 cái                              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ CẬP NHẬT ]    [ GHI CHÚ ]    [ QUAY LẠI ]    │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 6: Hoàn thành và thanh toán**

```
┌─────────────────────────────────────────────────────────┐
│              HOÀN THÀNH ĐƠN HÀNG                        │
├─────────────────────────────────────────────────────────┤
│ Đơn hàng: SO-2024-001                                  │
│ Trạng thái: ✅ Hoàn thành                              │
│ Hoàn thành lúc: 16/01/2024 15:00                      │
│                                                         │
│ TỔNG KẾT CÔNG VIỆC:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Tất cả công việc đã hoàn thành                   │ │
│ │ ✅ Xe đã được kiểm tra cuối cùng                    │ │
│ │ ✅ Khách hàng đã xác nhận hài lòng                  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ THỜI GIAN THỰC TẾ:                                     │
│ • Dự kiến: 4.0 giờ                                     │
│ • Thực tế: 4.5 giờ                                     │
│ • Chênh lệch: +0.5 giờ                                 │
│                                                         │
│ CHI PHÍ THỰC TẾ:                                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Dịch vụ:        200,000 VNĐ                        │ │
│ │ Phụ tùng:     3,200,000 VNĐ                        │ │
│ │ Công (2.5h):    125,000 VNĐ (thực tế)              │ │
│ │ ─────────────────────────                          │ │
│ │ TỔNG:         3,525,000 VNĐ                        │ │
│ │ Chênh lệch:    +25,000 VNĐ (do công thực tế)      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ THANH TOÁN:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tổng tiền:                        3,525,000 VNĐ    │ │
│ │ Giảm giá:                                 0 VNĐ    │ │
│ │ ─────────────────────────────────────────────────  │ │
│ │ THÀNH TIỀN:                       3,525,000 VNĐ    │ │
│ │                                                     │ │
│ │ Phương thức thanh toán:                            │ │
│ │ ( ) Tiền mặt                                       │ │
│ │ (•) Chuyển khoản                                   │ │
│ │ ( ) Thẻ tín dụng                                   │ │
│ │                                                     │ │
│ │ Số tiền thanh toán: [3,525,000] VNĐ               │ │
│ │                                                     │ │
│ │ [✓] Xuất hóa đơn VAT                               │ │
│ │     Tên: Nguyễn Minh Tuấn                          │ │
│ │     MST: (để trống nếu cá nhân)                    │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ THANH TOÁN ]    [ IN HÓA ĐƠN ]   [ HỦY ]     │
└─────────────────────────────────────────────────────────┘
```

### **Quản lý đơn hàng**

#### **Xem danh sách đơn hàng**

```
┌─────────────────────────────────────────────────────────┐
│              DANH SÁCH ĐƠN HÀNG                         │
├─────────────────────────────────────────────────────────┤
│ 🔍 [Tìm kiếm...]  📅 [15/01-20/01]  📊 [Tất cả ▼]      │
│                                                         │
│ ⏳ ĐANG XỬ LÝ (3 đơn):                                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ SO-2024-003 | 30C-11111 - BMW 3 Series             │ │
│ │ KH: Công ty TNHH DEF | Trạng thái: 🔧 Đang sửa    │ │
│ │ Tiến độ: 60% | Dự kiến: 18/01 09:00               │ │
│ │ Tổng: 1,700,000 VNĐ | Đã TT: 1,000,000 VNĐ        │ │
│ │ [📋 Chi tiết] [✏️ Cập nhật] [✅ Hoàn thành]        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ✅ HOÀN THÀNH (2 đơn):                                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ SO-2024-001 | 30A-12345 - Mercedes C-Class         │ │
│ │ KH: Nguyễn Minh Tuấn | ✅ Hoàn thành 16/01 15:00   │ │
│ │ Tổng: 3,525,000 VNĐ | ✅ Đã thanh toán             │ │
│ │ [📋 Chi tiết] [🖨️ In hóa đơn] [📊 Báo cáo]        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ⏸️ TẠM DỪNG (1 đơn):                                   │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ SO-2024-004 | 30D-22222 - Honda Accord             │ │
│ │ KH: Phạm Thị Lan | ⏸️ Chờ phụ tùng                 │ │
│ │ Lý do: Đợi nhập hàng từ Honda Vietnam              │ │
│ │ [📋 Chi tiết] [▶️ Tiếp tục] [❌ Hủy]               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TẠO ĐƠN MỚI ]    [ LỌC ]    [ XUẤT BC ]      │
└─────────────────────────────────────────────────────────┘
```

### **Trường hợp đặc biệt: Đơn hàng phức tạp**

#### **Tình huống: Xe cần VỪA sửa chữa, VỪA sơn, VỪA thay thiết bị mới**

**Ví dụ:** Mercedes C-Class 30A-12345 bị tai nạn va chạm:
- **Thay thế**: Cản trước, đèn pha, gương chiếu hậu (mới)
- **Sửa chữa**: Chỉnh sửa thân xe bị móp
- **Sơn**: Sơn cản trước, capô, cửa trước bên phải

```
┌─────────────────────────────────────────────────────────┐
│         ĐƠN HÀNG PHỨC TẠP - TAI NẠN VA CHẠM             │
├─────────────────────────────────────────────────────────┤
│ Xe: 30A-12345 - Mercedes C-Class 2020                  │
│ Khách: Nguyễn Minh Tuấn (Cá nhân)                      │
│ Loại: Xe cá nhân - CÓ bảo hiểm Bảo Việt                │
│                                                         │
│ TÌNH TRẠNG THIỆT HẠI:                                  │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ❌ Cản trước: Vỡ hoàn toàn → CẦN THAY MỚI          │ │
│ │ ❌ Đèn pha phải: Vỡ kính → CẦN THAY MỚI            │ │
│ │ ❌ Gương chiếu hậu phải: Gãy → CẦN THAY MỚI        │ │
│ │ ⚠️ Capô: Móp nhẹ → CẦN SỬA CHỮA (Đập nắn)          │ │
│ │ ⚠️ Cửa trước phải: Xước sâu → CẦN SƠN               │ │
│ │ 🎨 Cản mới, capô, cửa → CẦN SƠN ĐỒng BỘ            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 💡 LƯU Ý: Đây là XE BẢO HIỂM → CHỈ dùng hàng có HĐ    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 1: Đánh giá và phân loại công việc**

```
┌─────────────────────────────────────────────────────────┐
│              PHÂN LOẠI CÔNG VIỆC                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📦 PHẦN 1: THAY THẾ PHỤ TÙNG MỚI                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Loại: Thay thế (REPLACE)                         │ │
│ │ ✅ Phụ tùng: Có hóa đơn VAT (cho bảo hiểm)          │ │
│ │                                                     │ │
│ │ • Cản trước MB C-Class W205 (OEM)                  │ │
│ │   Giá: 2,400,000 VNĐ | Có HĐ ✅                    │ │
│ │                                                     │ │
│ │ • Đèn pha phải MB C-Class W205 (OEM)               │ │
│ │   Giá: 3,200,000 VNĐ | Có HĐ ✅                    │ │
│ │                                                     │ │
│ │ • Gương chiếu hậu phải (OEM)                       │ │
│ │   Giá: 1,100,000 VNĐ | Có HĐ ✅                    │ │
│ │                                                     │ │
│ │ TỔNG PHỤ TÙNG THAY THẾ: 6,700,000 VNĐ             │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🔧 PHẦN 2: SỬA CHỮA (KHÔNG CẦN PHỤ TÙNG)              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Loại: Sửa chữa (REPAIR)                          │ │
│ │ ✅ Chủ yếu là công lao động                         │ │
│ │                                                     │ │
│ │ • Sửa chữa capô bị móp (Đập nắn):                  │ │
│ │   Loại công: Công sửa chữa thân xe                 │ │
│ │   Thời gian: 3.0 giờ x 60,000 VNĐ                  │ │
│ │   Tổng: 180,000 VNĐ                                │ │
│ │                                                     │ │
│ │ • Vật liệu sửa chữa (matit, keo...):               │ │
│ │   Tổng: 200,000 VNĐ                                │ │
│ │                                                     │ │
│ │ TỔNG SỬA CHỮA: 380,000 VNĐ                         │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🎨 PHẦN 3: SƠN (PAINT)                                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Loại: Sơn (PAINT)                                │ │
│ │ ✅ Vật liệu + Công sơn                              │ │
│ │                                                     │ │
│ │ VẬT LIỆU SƠN:                                       │ │
│ │ • Sơn màu đen (Mercedes Code 040):                 │ │
│ │   2 lít x 350,000 = 700,000 VNĐ                    │ │
│ │ • Sơn lót epoxy: 500,000 VNĐ                       │ │
│ │ • Sơn bóng (clear coat): 400,000 VNĐ               │ │
│ │ • Vật liệu phụ (nhám, dung môi...): 300,000 VNĐ    │ │
│ │ Tổng vật liệu: 1,900,000 VNĐ                       │ │
│ │                                                     │ │
│ │ CÔNG SƠN:                                           │ │
│ │ • Cản trước: 4.0 giờ x 80,000 = 320,000 VNĐ        │ │
│ │ • Capô: 3.5 giờ x 80,000 = 280,000 VNĐ             │ │
│ │ • Cửa trước phải: 3.0 giờ x 80,000 = 240,000 VNĐ   │ │
│ │ Tổng công sơn: 840,000 VNĐ                         │ │
│ │                                                     │ │
│ │ TỔNG SƠN: 2,740,000 VNĐ                            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 👷 PHẦN 4: CÔNG THÁO LẮP                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ • Công tháo cản cũ: 0.5 giờ x 50,000 = 25,000      │ │
│ │ • Công lắp cản mới: 1.0 giờ x 50,000 = 50,000      │ │
│ │ • Công tháo đèn pha cũ: 0.5 giờ x 50,000 = 25,000  │ │
│ │ • Công lắp đèn pha mới: 1.0 giờ x 50,000 = 50,000  │ │
│ │ • Công tháo gương cũ: 0.3 giờ x 50,000 = 15,000    │ │
│ │ • Công lắp gương mới: 0.5 giờ x 50,000 = 25,000    │ │
│ │ • Công điều chỉnh góc chiếu đèn: 0.5 giờ = 25,000  │ │
│ │                                                     │ │
│ │ TỔNG CÔNG THÁO LẮP: 215,000 VNĐ                    │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 2: Tạo đơn hàng tổng hợp**

```
┌─────────────────────────────────────────────────────────┐
│         TẠO ĐƠN HÀNG - CHỌN DỊCH VỤ VÀ PHỤ TÙNG        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📋 DỊCH VỤ:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [✓] Thay cản trước MB C-Class                       │ │
│ │     Loại: Thay thế | Giá: 300,000 VNĐ              │ │
│ │                                                     │ │
│ │ [✓] Thay đèn pha MB C-Class                         │ │
│ │     Loại: Thay thế | Giá: 200,000 VNĐ              │ │
│ │                                                     │ │
│ │ [✓] Thay gương chiếu hậu                            │ │
│ │     Loại: Thay thế | Giá: 100,000 VNĐ              │ │
│ │                                                     │ │
│ │ [✓] Sửa chữa thân xe (Đập nắn capô)                │ │
│ │     Loại: Sửa chữa | Giá: 380,000 VNĐ              │ │
│ │                                                     │ │
│ │ [✓] Sơn 3 chi tiết (Cản, Capô, Cửa)                │ │
│ │     Loại: Sơn | Giá: 2,740,000 VNĐ                 │ │
│ │                                                     │ │
│ │ TỔNG DỊCH VỤ: 3,720,000 VNĐ                        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📦 PHỤ TÙNG:                                           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 🛡️ ĐÂY LÀ XE BẢO HIỂM - CHỈ hiển thị hàng có HĐ   │ │
│ │                                                     │ │
│ │ [✓] Cản trước MB C-Class W205 (OEM)                │ │
│ │     Giá: 2,400,000 VNĐ | Tồn: 2 | ✅ Có HĐ         │ │
│ │     Lô: BATCH-2024-010 | NCC: MB Vietnam           │ │
│ │     Số lượng: [1] ▼                                │ │
│ │                                                     │ │
│ │ [✓] Đèn pha phải MB C-Class W205 (OEM)             │ │
│ │     Giá: 3,200,000 VNĐ | Tồn: 3 | ✅ Có HĐ         │ │
│ │     Lô: BATCH-2024-001 | NCC: MB Vietnam           │ │
│ │     Số lượng: [1] ▼                                │ │
│ │                                                     │ │
│ │ [✓] Gương chiếu hậu phải (OEM)                     │ │
│ │     Giá: 1,100,000 VNĐ | Tồn: 4 | ✅ Có HĐ         │ │
│ │     Lô: BATCH-2024-005 | NCC: MB Vietnam           │ │
│ │     Số lượng: [1] ▼                                │ │
│ │                                                     │ │
│ │ [✓] Sơn màu đen Mercedes 040                       │ │
│ │     Giá: 350,000 VNĐ/lít | ✅ Có HĐ                │ │
│ │     Số lượng: [2] lít                              │ │
│ │                                                     │ │
│ │ [✓] Sơn lót epoxy + Sơn bóng + Vật liệu phụ        │ │
│ │     Tổng: 1,200,000 VNĐ | ✅ Có HĐ                 │ │
│ │                                                     │ │
│ │ TỔNG PHỤ TÙNG: 8,600,000 VNĐ                       │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 👷 CÔNG LAO ĐỘNG:                                      │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ CÔNG THÁO LẮP (Thợ máy):                           │ │
│ │ • Cản: 1.5 giờ x 50,000 = 75,000 VNĐ               │ │
│ │ • Đèn pha: 1.5 giờ x 50,000 = 75,000 VNĐ           │ │
│ │ • Gương: 0.8 giờ x 50,000 = 40,000 VNĐ             │ │
│ │ • Điều chỉnh: 0.5 giờ x 50,000 = 25,000 VNĐ        │ │
│ │                                                     │ │
│ │ CÔNG SỬA CHỮA (Thợ sửa thân xe):                   │ │
│ │ • Đập nắn capô: 3.0 giờ x 60,000 = 180,000 VNĐ     │ │
│ │                                                     │ │
│ │ CÔNG SƠN (Thợ sơn):                                │ │
│ │ • Chuẩn bị bề mặt: 2.0 giờ x 80,000 = 160,000 VNĐ  │ │
│ │ • Sơn lót: 2.0 giờ x 80,000 = 160,000 VNĐ          │ │
│ │ • Sơn màu: 3.5 giờ x 80,000 = 280,000 VNĐ          │ │
│ │ • Sơn bóng: 3.0 giờ x 80,000 = 240,000 VNĐ         │ │
│ │                                                     │ │
│ │ TỔNG CÔNG: 1,235,000 VNĐ                           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 💰 TỔNG CỘNG:                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Dịch vụ:        3,720,000 VNĐ                      │ │
│ │ Phụ tùng:       8,600,000 VNĐ                      │ │
│ │ Công:           1,235,000 VNĐ                      │ │
│ │ ─────────────────────────────────                  │ │
│ │ TỔNG:          13,555,000 VNĐ                      │ │
│ │                                                     │ │
│ │ 🛡️ CLAIM BẢO HIỂM:                                 │ │
│ │ Số claim: CLM-2024-005                             │ │
│ │ Số tiền claim ước tính: 13,555,000 VNĐ             │ │
│ │ (Chờ điều chỉnh viên duyệt)                        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ TẠO ĐƠN ]    [ LƯU NHÁP ]    [ HỦY ]         │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 3: Phân công thợ theo chuyên môn**

```
┌─────────────────────────────────────────────────────────┐
│              PHÂN CÔNG NHÂN SỰ                          │
├─────────────────────────────────────────────────────────┤
│ Đơn hàng: SO-2024-025                                  │
│ Loại: Đơn phức tạp (Thay + Sửa + Sơn)                 │
│                                                         │
│ 🔧 ĐỘI THÁO LẮP (Thợ máy):                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Thợ chính: Nguyễn Văn Minh                         │ │
│ │ Trợ lý: Trần Văn Bình                               │ │
│ │                                                     │ │
│ │ Công việc:                                          │ │
│ │ • Tháo cản, đèn, gương cũ                          │ │
│ │ • Lắp cản, đèn, gương mới                          │ │
│ │ • Điều chỉnh và kiểm tra                           │ │
│ │                                                     │ │
│ │ Thời gian ước tính: 4 giờ                          │ │
│ │ Ngày thực hiện: 16/01/2024 (08:00-12:00)          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🔨 ĐỘI SỬA CHỮA THÂN XE:                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Thợ chính: Lê Văn Tú (Chuyên gia đập nắn)          │ │
│ │                                                     │ │
│ │ Công việc:                                          │ │
│ │ • Đập nắn capô bị móp                              │ │
│ │ • Chỉnh sửa bề mặt                                 │ │
│ │ • Chuẩn bị bề mặt cho sơn                          │ │
│ │                                                     │ │
│ │ Thời gian ước tính: 3 giờ                          │ │
│ │ Ngày thực hiện: 16/01/2024 (08:00-11:00)          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🎨 ĐỘI SƠN:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Thợ sơn chính: Phạm Văn Sơn (Level: Cao cấp)       │ │
│ │ Trợ lý: Hoàng Văn Tùng                              │ │
│ │                                                     │ │
│ │ Công việc:                                          │ │
│ │ • Chà nhám và làm sạch bề mặt                      │ │
│ │ • Sơn lót epoxy                                     │ │
│ │ • Sơn màu đen (3 lớp)                              │ │
│ │ • Sơn bóng clear coat (2 lớp)                      │ │
│ │ • Đánh bóng hoàn thiện                             │ │
│ │                                                     │ │
│ │ Thời gian ước tính: 10.5 giờ                       │ │
│ │ Ngày 1 (16/01): Chà + Sơn lót (3h)                │ │
│ │ Ngày 2 (17/01): Sơn màu (4h)                       │ │
│ │ Ngày 3 (18/01): Sơn bóng + Đánh bóng (3.5h)       │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ TỔNG THỜI GIAN DỰ KIẾN: 3 NGÀY LÀM VIỆC               │
│ Hoàn thành: 18/01/2024 - 17:00                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 4: Quy trình thực hiện từng giai đoạn**

```
┌─────────────────────────────────────────────────────────┐
│              TIẾN TRÌNH THỰC HIỆN                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📅 NGÀY 1 - 16/01/2024:                                │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 08:00-09:00 | Đội tháo lắp: Tháo các chi tiết hỏng │ │
│ │             ├─ Tháo cản cũ ✅                       │ │
│ │             ├─ Tháo đèn pha cũ ✅                   │ │
│ │             └─ Tháo gương cũ ✅                     │ │
│ │                                                     │ │
│ │ 08:00-11:00 | Đội sửa chữa: Đập nắn capô           │ │
│ │             ├─ Đánh giá mức độ móp ✅              │ │
│ │             ├─ Đập nắn từng phần ✅                 │ │
│ │             └─ Chỉnh sửa bề mặt ✅                  │ │
│ │                                                     │ │
│ │ 09:00-12:00 | Đội tháo lắp: Lắp chi tiết mới       │ │
│ │             ├─ Lắp cản mới ✅                       │ │
│ │             ├─ Lắp đèn pha mới ✅                   │ │
│ │             ├─ Lắp gương mới ✅                     │ │
│ │             └─ Kiểm tra và điều chỉnh ✅            │ │
│ │                                                     │ │
│ │ 13:00-16:00 | Đội sơn: Chuẩn bị bề mặt              │ │
│ │             ├─ Chà nhám cản, capô, cửa ✅          │ │
│ │             ├─ Làm sạch bề mặt ✅                   │ │
│ │             └─ Sơn lót epoxy ✅                     │ │
│ │                                                     │ │
│ │ ✅ Kết thúc ngày 1: Hoàn thành tháo lắp + sơn lót  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📅 NGÀY 2 - 17/01/2024:                                │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 08:00-12:00 | Đội sơn: Sơn màu                      │ │
│ │             ├─ Kiểm tra lớp lót ✅                  │ │
│ │             ├─ Sơn màu lớp 1 ✅                     │ │
│ │             ├─ Chờ khô (30 phút)                   │ │
│ │             ├─ Sơn màu lớp 2 ✅                     │ │
│ │             ├─ Chờ khô (30 phút)                   │ │
│ │             └─ Sơn màu lớp 3 ✅                     │ │
│ │                                                     │ │
│ │ 12:00-17:00 | Chờ khô hoàn toàn                    │ │
│ │             └─ Để xe trong phòng sơn ⏳             │ │
│ │                                                     │ │
│ │ ⏳ Kết thúc ngày 2: Chờ khô để sơn bóng ngày mai   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📅 NGÀY 3 - 18/01/2024:                                │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 08:00-11:00 | Đội sơn: Sơn bóng                     │ │
│ │             ├─ Kiểm tra bề mặt sơn màu ✅           │ │
│ │             ├─ Sơn bóng clear coat lớp 1 ✅         │ │
│ │             ├─ Chờ khô (45 phút)                   │ │
│ │             └─ Sơn bóng lớp 2 ✅                    │ │
│ │                                                     │ │
│ │ 11:00-14:00 | Chờ khô                               │ │
│ │                                                     │ │
│ │ 14:00-17:00 | Hoàn thiện                            │ │
│ │             ├─ Đánh bóng toàn bộ ✅                 │ │
│ │             ├─ Kiểm tra chất lượng ✅               │ │
│ │             ├─ Lắp lại chi tiết nhỏ ✅              │ │
│ │             └─ Rửa xe và vệ sinh ✅                 │ │
│ │                                                     │ │
│ │ ✅ HOÀN THÀNH: 18/01/2024 - 17:00                   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **Bước 5: Giao xe và thanh toán**

```
┌─────────────────────────────────────────────────────────┐
│         HOÀN THÀNH VÀ THANH TOÁN (BẢO HIỂM)            │
├─────────────────────────────────────────────────────────┤
│ Đơn hàng: SO-2024-025                                  │
│ Hoàn thành: 18/01/2024 17:00                          │
│                                                         │
│ TỔNG KẾT CÔNG VIỆC:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Thay thế: Cản, đèn pha, gương                    │ │
│ │ ✅ Sửa chữa: Capô đã được đập nắn hoàn hảo          │ │
│ │ ✅ Sơn: 3 chi tiết đã sơn đồng bộ màu               │ │
│ │ ✅ Chất lượng: Khách hàng xác nhận hài lòng         │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ THỜI GIAN:                                             │
│ • Dự kiến: 3 ngày (72 giờ)                            │
│ • Thực tế: 3 ngày (hoàn thành đúng hạn)               │
│                                                         │
│ CHI PHÍ THỰC TẾ:                                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Dịch vụ:        3,720,000 VNĐ                      │ │
│ │ Phụ tùng:       8,600,000 VNĐ (✅ Tất cả có HĐ)    │ │
│ │ Công:           1,280,000 VNĐ (thực tế +45k)       │ │
│ │ ─────────────────────────────                      │ │
│ │ TỔNG:          13,600,000 VNĐ                      │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🛡️ THANH TOÁN QUA BẢO HIỂM:                           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Claim number: CLM-2024-005                         │ │
│ │ Trạng thái: ✅ Đã duyệt                             │ │
│ │ Số tiền duyệt: 13,000,000 VNĐ                      │ │
│ │ (Giảm 600k do khấu hao)                            │ │
│ │                                                     │ │
│ │ PHÂN BỔ THANH TOÁN:                                │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ Bảo hiểm thanh toán: 13,000,000 VNĐ          │  │ │
│ │ │ Khách tự thanh toán:    600,000 VNĐ          │  │ │
│ │ │ (Phần khấu hao)                               │  │ │
│ │ │ ─────────────────────────────                │  │ │
│ │ │ TỔNG:                 13,600,000 VNĐ          │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ │                                                     │ │
│ │ Phương thức:                                        │ │
│ │ • Bảo hiểm → Garage: Chuyển khoản (7 ngày)        │ │
│ │ • Khách hàng → Garage: Tiền mặt ngay              │ │
│ │                                                     │ │
│ │ [✓] Xuất hóa đơn VAT cho bảo hiểm                  │ │
│ │     Tên: Công ty Bảo hiểm Bảo Việt                │ │
│ │     MST: 0100107929                                │ │
│ │     Số tiền: 13,000,000 VNĐ                        │ │
│ │                                                     │ │
│ │ [✓] Xuất phiếu thu cho khách hàng                  │ │
│ │     Tên: Nguyễn Minh Tuấn                          │ │
│ │     Số tiền: 600,000 VNĐ                           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📋 TÀI LIỆU BẢO HIỂM ĐÃ NỘP:                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Ảnh hiện trường (10 ảnh)                         │ │
│ │ ✅ Biên bản công an PB-2024-005                     │ │
│ │ ✅ Báo giá sửa chữa                                 │ │
│ │ ✅ Hóa đơn phụ tùng (có VAT)                        │ │
│ │ ✅ Ảnh sau sửa chữa (8 ảnh)                         │ │
│ │ ✅ Biên bản nghiệm thu                              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ IN HÓA ĐƠN ]    [ IN BIÊN BẢN ]   [ XONG ]   │
└─────────────────────────────────────────────────────────┘
```

### **💡 NHỮNG LƯU Ý QUAN TRỌNG cho đơn hàng phức tạp:**

#### **1. Phân loại công việc rõ ràng:**
```
✅ Thay thế (Replace):
   • Dùng phụ tùng mới
   • Cần có hóa đơn nếu xe công ty/bảo hiểm
   • Thợ máy thực hiện

✅ Sửa chữa (Repair):
   • Không cần phụ tùng hoặc ít phụ tùng
   • Chủ yếu là công lao động
   • Thợ chuyên môn (đập nắn, hàn...)

✅ Sơn (Paint):
   • Cần vật liệu sơn + công sơn
   • Thợ sơn chuyên nghiệp
   • Cần thời gian chờ khô
```

#### **2. Quản lý thời gian:**
```
⏰ Lưu ý thời gian:
   • Sơn cần 3 ngày (chờ khô giữa các lớp)
   • Không thể đẩy nhanh quá trình sơn
   • Thông báo rõ cho khách thời gian hoàn thành
```

#### **3. Phân công thợ theo chuyên môn:**
```
👷 Đội ngũ:
   • Thợ máy: Tháo lắp
   • Thợ sửa thân xe: Đập nắn, hàn
   • Thợ sơn: Sơn và hoàn thiện
   • Có thể làm song song để tiết kiệm thời gian
```

#### **4. Quản lý phụ tùng cho bảo hiểm:**
```
🛡️ Xe bảo hiểm:
   • CHỈ dùng hàng có hóa đơn VAT
   • Ưu tiên phụ tùng OEM
   • Lưu đầy đủ chứng từ
   • Chụp ảnh trước/sau sửa chữa
```

#### **5. Theo dõi chi phí:**
```
💰 Phân loại chi phí:
   • Phụ tùng thay thế
   • Vật liệu sửa chữa
   • Vật liệu sơn
   • Công tháo lắp
   • Công sửa chữa
   • Công sơn
```

---

## 🧾 XUẤT HÓA ĐƠN CHO ĐƠN HÀNG PHỨC TẠP

### **Trường hợp: Xe công ty hoặc Bảo hiểm - Cần hóa đơn VAT**

#### **📋 NGUYÊN TẮC XUẤT HÓA ĐƠN:**

```
┌─────────────────────────────────────────────────────────┐
│         QUY ĐỊNH XUẤT HÓA ĐƠN                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 🏢 XE CÔNG TY:                                         │
│    ✅ PHẢI xuất hóa đơn VAT đầy ra                     │
│    ✅ CHỈ được dùng phụ tùng có hóa đơn VAT đầu vào    │
│    ✅ Tên hóa đơn: Tên công ty + MST                   │
│    ✅ Nội dung chi tiết: Phụ tùng, dịch vụ, công       │
│                                                         │
│ 🛡️ XE BẢO HIỂM:                                        │
│    ✅ PHẢI xuất hóa đơn VAT cho công ty bảo hiểm       │
│    ✅ CHỈ được dùng phụ tùng có hóa đơn VAT đầu vào    │
│    ✅ Tên hóa đơn: Tên công ty BH + MST                │
│    ✅ Kèm theo: Biên bản nghiệm thu, ảnh chụp          │
│    ⚠️ Phần khách tự trả: Xuất phiếu thu riêng          │
│                                                         │
│ 👤 XE CÁ NHÂN (Không yêu cầu HĐ):                     │
│    ⚠️ CÓ THỂ xuất hóa đơn nếu khách yêu cầu            │
│    ✅ Nếu dùng hàng KHÔNG HĐ → KHÔNG xuất được HĐ      │
│    ⚠️ Chỉ xuất phiếu thu/biên lai                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### **Cách xuất hóa đơn cho đơn hàng phức tạp**

#### **Tình huống mẫu:**
Đơn hàng SO-2024-025 (Xe bảo hiểm):
- Thay: Cản, đèn pha, gương
- Sửa: Capô
- Sơn: Cản, capô, cửa

#### **CÁCH 1: Xuất 1 hóa đơn tổng hợp (Khuyến nghị)**

```
┌─────────────────────────────────────────────────────────┐
│              HÓA ĐƠN GIÁ TRỊ GIA TĂNG                   │
├─────────────────────────────────────────────────────────┤
│ Số: 0001234                Ký hiệu: AA/24E             │
│ Ngày 18 tháng 01 năm 2024                              │
│                                                         │
│ Đơn vị bán hàng: GARAGE Ô TÔ ABC                       │
│ MST: 0123456789                                        │
│ Địa chỉ: 456 Lê Lợi, Q3, TP.HCM                       │
│                                                         │
│ Họ tên người mua: CÔNG TY BẢO HIỂM BẢO VIỆT           │
│ MST: 0100107929                                        │
│ Địa chỉ: 233 Đồng Khởi, Q1, TP.HCM                    │
│                                                         │
│ Hình thức thanh toán: Chuyển khoản                     │
│ Claim số: CLM-2024-005                                 │
│ Xe: 30A-12345 - Mercedes C-Class 2020                  │
│ Chủ xe: Nguyễn Minh Tuấn - 0901234567                 │
│                                                         │
├─────────────────────────────────────────────────────────┤
│ STT │ Tên hàng hóa/DV      │ ĐVT │ SL │ Đơn giá │ Thành tiền │
├─────┼──────────────────────┼─────┼────┼─────────┼────────────┤
│                                                         │
│ I. PHỤ TÙNG THAY THẾ:                                  │
│                                                         │
│ 1   │ Cản trước Mercedes   │ Cái │  1 │2,400,000│  2,400,000 │
│     │ C-Class W205 OEM     │     │    │         │            │
│     │ (Mã: BUMPER001)      │     │    │         │            │
│                                                         │
│ 2   │ Đèn pha phải MB      │ Cái │  1 │3,200,000│  3,200,000 │
│     │ C-Class W205 OEM     │     │    │         │            │
│     │ (Mã: HEADLIGHT001)   │     │    │         │            │
│                                                         │
│ 3   │ Gương chiếu hậu phải │ Cái │  1 │1,100,000│  1,100,000 │
│     │ (Mã: MIRROR001)      │     │    │         │            │
│                                                         │
│ II. VẬT LIỆU SƠN:                                      │
│                                                         │
│ 4   │ Sơn màu đen MB 040   │ Lít │  2 │  350,000│    700,000 │
│                                                         │
│ 5   │ Sơn lót epoxy        │ Bộ  │  1 │  500,000│    500,000 │
│                                                         │
│ 6   │ Sơn bóng clear coat  │ Lít │  1 │  400,000│    400,000 │
│                                                         │
│ 7   │ Vật liệu phụ sơn     │ Bộ  │  1 │  300,000│    300,000 │
│     │ (nhám, dung môi...)  │     │    │         │            │
│                                                         │
│ III. DỊCH VỤ & CÔNG LAO ĐỘNG:                         │
│                                                         │
│ 8   │ Dịch vụ thay cản     │ Lần │  1 │  300,000│    300,000 │
│     │ trước                │     │    │         │            │
│                                                         │
│ 9   │ Dịch vụ thay đèn pha │ Lần │  1 │  200,000│    200,000 │
│                                                         │
│ 10  │ Dịch vụ thay gương   │ Lần │  1 │  100,000│    100,000 │
│                                                         │
│ 11  │ Dịch vụ sửa chữa     │ Lần │  1 │  380,000│    380,000 │
│     │ thân xe (đập nắn)    │     │    │         │            │
│                                                         │
│ 12  │ Dịch vụ sơn 3 chi    │ Lần │  1 │2,740,000│  2,740,000 │
│     │ tiết (cản,capô,cửa)  │     │    │         │            │
│                                                         │
├─────────────────────────────────────────────────────────┤
│ Cộng tiền hàng & dịch vụ chịu thuế:      12,520,000    │
│ Thuế suất GTGT: 10%                       1,252,000    │
├─────────────────────────────────────────────────────────┤
│ Tổng hàng & dịch vụ (bao gồm VAT):       13,772,000    │
│                                                         │
│ CÔNG LAO ĐỘNG (Không chịu thuế VAT):                  │
│                                                         │
│ 13  │ Công tháo lắp phụ tùng          │ Giờ │4.3 │50,000│  215,000 │
│ 14  │ Công sửa chữa thân xe           │ Giờ │3.0 │60,000│  180,000 │
│ 15  │ Công sơn (chuẩn bị + sơn)       │ Giờ │10.5│80,000│  840,000 │
│                                                         │
│ Cộng công lao động (KHÔNG thuế):          1,235,000    │
├─────────────────────────────────────────────────────────┤
│ TỔNG TIỀN THANH TOÁN:                    15,007,000    │
│ Số tiền bằng chữ:                                      │
│ Mười lăm triệu không trăm linh bảy nghìn đồng chẵn    │
│                                                         │
│ 💡 LƯU Ý QUAN TRỌNG:                                   │
│ • Phụ tùng + Vật liệu + Dịch vụ: Chịu VAT 10%          │
│ • Công lao động: KHÔNG chịu VAT                        │
│ • Căn cứ: Thông tư 219/2013/TT-BTC                     │
└─────────────────────────────────────────────────────────┘

Người mua hàng          Người bán hàng         Thủ quỹ
(Ký, họ tên)            (Ký, họ tên)           (Ký, họ tên)
```

**💡 PHÂN TÍCH CÁCH TÍNH:**
```
┌─────────────────────────────────────────────────────────┐
│ A. HẠNG MỤC CHỊU VAT 10%:                              │
│    • Phụ tùng:          6,700,000 VNĐ                  │
│    • Vật liệu sơn:      1,900,000 VNĐ                  │
│    • Vật liệu sửa:        200,000 VNĐ                  │
│    • Dịch vụ:           3,720,000 VNĐ                  │
│    ──────────────────────────────                      │
│    Tổng chịu thuế:     12,520,000 VNĐ                  │
│    VAT 10%:             1,252,000 VNĐ                  │
│    ──────────────────────────────                      │
│    Tổng A:             13,772,000 VNĐ                  │
│                                                         │
│ B. HẠNG MỤC KHÔNG VAT:                                 │
│    • Công lao động:     1,235,000 VNĐ                  │
│    ──────────────────────────────                      │
│    Tổng B:              1,235,000 VNĐ                  │
│                                                         │
│ TỔNG THANH TOÁN (A + B): 15,007,000 VNĐ                │
└─────────────────────────────────────────────────────────┘
```

**⚠️ KHUYẾN NGHỊ:**
- ✅ **Nên tách rõ** công lao động để KHÔNG tính VAT
- ✅ Tiết kiệm 123,500 VNĐ VAT so với cách gộp
- ✅ Hợp pháp theo quy định Việt Nam

---

#### **CÁCH 2: Xuất nhiều hóa đơn theo từng loại (Nếu yêu cầu)**

##### **Hóa đơn 1: Phụ tùng thay thế**
```
┌─────────────────────────────────────────────────────────┐
│         HÓA ĐƠN VAT - PHỤ TÙNG THAY THẾ                │
├─────────────────────────────────────────────────────────┤
│ Số: 0001234A               Ngày: 16/01/2024            │
│ Người mua: Công ty Bảo hiểm Bảo Việt                   │
│ MST: 0100107929                                        │
│ Claim: CLM-2024-005 | Xe: 30A-12345                    │
│                                                         │
│ 1. Cản trước MB C-Class W205        2,400,000 VNĐ      │
│ 2. Đèn pha phải MB C-Class W205     3,200,000 VNĐ      │
│ 3. Gương chiếu hậu phải             1,100,000 VNĐ      │
│                                                         │
│ Cộng tiền hàng:                     6,700,000 VNĐ      │
│ VAT 10%:                              670,000 VNĐ      │
│ TỔNG:                               7,370,000 VNĐ      │
└─────────────────────────────────────────────────────────┘
```

##### **Hóa đơn 2: Vật liệu sơn**
```
┌─────────────────────────────────────────────────────────┐
│         HÓA ĐƠN VAT - VẬT LIỆU SƠN                     │
├─────────────────────────────────────────────────────────┤
│ Số: 0001234B               Ngày: 16/01/2024            │
│ Người mua: Công ty Bảo hiểm Bảo Việt                   │
│ MST: 0100107929                                        │
│ Claim: CLM-2024-005 | Xe: 30A-12345                    │
│                                                         │
│ 1. Sơn màu đen Mercedes 040 (2L)      700,000 VNĐ      │
│ 2. Sơn lót epoxy                      500,000 VNĐ      │
│ 3. Sơn bóng clear coat                400,000 VNĐ      │
│ 4. Vật liệu phụ (nhám, dung môi)      300,000 VNĐ      │
│                                                         │
│ Cộng tiền hàng:                     1,900,000 VNĐ      │
│ VAT 10%:                              190,000 VNĐ      │
│ TỔNG:                               2,090,000 VNĐ      │
└─────────────────────────────────────────────────────────┘
```

##### **Hóa đơn 3: Dịch vụ**
```
┌─────────────────────────────────────────────────────────┐
│         HÓA ĐƠN VAT - DỊCH VỤ SỬA CHỮA                 │
├─────────────────────────────────────────────────────────┤
│ Số: 0001234C               Ngày: 18/01/2024            │
│ Người mua: Công ty Bảo hiểm Bảo Việt                   │
│ MST: 0100107929                                        │
│ Claim: CLM-2024-005 | Xe: 30A-12345                    │
│                                                         │
│ DỊCH VỤ (Chịu VAT 10%):                               │
│ 1. Dịch vụ thay cản trước             300,000 VNĐ      │
│ 2. Dịch vụ thay đèn pha               200,000 VNĐ      │
│ 3. Dịch vụ thay gương                 100,000 VNĐ      │
│ 4. Dịch vụ sửa chữa thân xe           380,000 VNĐ      │
│ 5. Dịch vụ sơn 3 chi tiết           2,740,000 VNĐ      │
│                                                         │
│ Cộng tiền dịch vụ chịu thuế:        3,720,000 VNĐ      │
│ VAT 10%:                              372,000 VNĐ      │
│ Tổng dịch vụ:                       4,092,000 VNĐ      │
│                                                         │
│ CÔNG LAO ĐỘNG (KHÔNG chịu VAT):                       │
│ 6. Công tháo lắp (4.3 giờ)            215,000 VNĐ      │
│ 7. Công sửa chữa (3.0 giờ)            180,000 VNĐ      │
│ 8. Công sơn (10.5 giờ)                840,000 VNĐ      │
│                                                         │
│ Cộng công lao động:                 1,235,000 VNĐ      │
│ ─────────────────────────────────                      │
│ TỔNG:                               5,327,000 VNĐ      │
└─────────────────────────────────────────────────────────┘
```

---

### **TỔNG HỢP HÓA ĐƠN:**

```
┌─────────────────────────────────────────────────────────┐
│         TỔNG HỢP HÓA ĐƠN XUẤT CHO BẢO HIỂM            │
├─────────────────────────────────────────────────────────┤
│ Claim: CLM-2024-005                                    │
│ Xe: 30A-12345 - Mercedes C-Class 2020                  │
│ Chủ xe: Nguyễn Minh Tuấn                               │
│ Công ty BH: Bảo Việt - MST: 0100107929                │
│                                                         │
│ DANH SÁCH HÓA ĐƠN ĐÃ XUẤT:                            │
│                                                         │
│ Cách 1 - HÓA ĐƠN TỔNG HỢP (Khuyến nghị):              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ HĐ số: 0001234                                     │ │
│ │ Ngày: 18/01/2024                                   │ │
│ │ Tiền chưa VAT: 13,555,000 VNĐ                      │ │
│ │ VAT 10%:        1,355,500 VNĐ                      │ │
│ │ Tổng cộng:     14,910,500 VNĐ                      │ │
│ │                                                     │ │
│ │ Nội dung:                                          │ │
│ │ • Phụ tùng thay thế: 6,700,000 VNĐ                │ │
│ │ • Vật liệu sơn: 1,900,000 VNĐ                      │ │
│ │ • Dịch vụ: 3,720,000 VNĐ                           │ │
│ │ • Công lao động: 1,235,000 VNĐ                     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Cách 2 - NHIỀU HÓA ĐƠN (Nếu yêu cầu):                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ HĐ 0001234A - Phụ tùng:     7,370,000 VNĐ          │ │
│ │ HĐ 0001234B - Vật liệu:     2,310,000 VNĐ          │ │
│ │ HĐ 0001234C - DV + Công:    5,327,000 VNĐ          │ │
│ │ ─────────────────────────────────                  │ │
│ │ TỔNG:                      15,007,000 VNĐ          │ │
│ │                                                     │ │
│ │ 💡 Tiết kiệm VAT: 123,500 VNĐ (do công không VAT)  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

### **⚠️ TRƯỜNG HỢP ĐẶC BIỆT: Bảo hiểm chi trả một phần**

#### **Tình huống:**
- Tổng chi phí: 13,600,000 VNĐ
- Bảo hiểm duyệt: 13,000,000 VNĐ (trừ khấu hao 600k)
- Khách tự trả: 600,000 VNĐ

```
┌─────────────────────────────────────────────────────────┐
│         XUẤT HÓA ĐƠN KHI BẢO HIỂM TRẢ MỘT PHẦN        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 🧾 HÓA ĐƠN 1: CHO BẢO HIỂM (Phần được duyệt)          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Số HĐ: 0001234                                     │ │
│ │ Người mua: Công ty BH Bảo Việt                     │ │
│ │ MST: 0100107929                                    │ │
│ │ Claim: CLM-2024-005                                │ │
│ │                                                     │ │
│ │ Nội dung: Sửa chữa xe 30A-12345                    │ │
│ │ - Phụ tùng thay thế                                │ │
│ │ - Vật liệu sơn                                     │ │
│ │ - Dịch vụ sửa chữa và sơn                          │ │
│ │ - Công lao động                                    │ │
│ │                                                     │ │
│ │ Tiền chưa VAT: 11,818,182 VNĐ                      │ │
│ │ VAT 10%:        1,181,818 VNĐ                      │ │
│ │ ─────────────────────────                          │ │
│ │ TỔNG CỘNG:     13,000,000 VNĐ                      │ │
│ │                                                     │ │
│ │ 💡 Lưu ý: Đã trừ khấu hao 600,000 VNĐ              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🧾 PHIẾU THU 2: CHO KHÁCH HÀNG (Phần tự trả)           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Số phiếu: PT-2024-025                              │ │
│ │ Người trả: Nguyễn Minh Tuấn                        │ │
│ │ (KHÔNG xuất hóa đơn VAT)                           │ │
│ │                                                     │ │
│ │ Nội dung: Phần khách tự trả cho đơn SO-2024-025   │ │
│ │ Lý do: Khấu hao theo quy định bảo hiểm             │ │
│ │                                                     │ │
│ │ Số tiền: 600,000 VNĐ                               │ │
│ │ Thanh toán: Tiền mặt                               │ │
│ │                                                     │ │
│ │ ⚠️ Không xuất HĐ VAT cho phần này                  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ TỔNG THU:                                              │
│ • Từ bảo hiểm (HĐ VAT): 13,000,000 VNĐ                │
│ • Từ khách hàng (Phiếu thu): 600,000 VNĐ              │
│ • TỔNG: 13,600,000 VNĐ                                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

### **📋 QUY TRÌNH XUẤT HÓA ĐƠN TRONG HỆ THỐNG**

```
┌─────────────────────────────────────────────────────────┐
│         GIAO DIỆN XUẤT HÓA ĐƠN                         │
├─────────────────────────────────────────────────────────┤
│ Đơn hàng: SO-2024-025                                  │
│ Loại xe: Bảo hiểm                                      │
│ Tổng tiền: 13,600,000 VNĐ                             │
│                                                         │
│ PHÂN BỔ THANH TOÁN:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Bảo hiểm trả:    13,000,000 VNĐ (✅ Cần HĐ VAT)    │ │
│ │ Khách tự trả:       600,000 VNĐ (⚠️ Phiếu thu)     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🧾 HÓA ĐƠN CHO BẢO HIỂM:                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Loại hóa đơn:                                      │ │
│ │ (•) Hóa đơn tổng hợp (Khuyến nghị)                │ │
│ │ ( ) Tách nhiều hóa đơn theo loại                   │ │
│ │                                                     │ │
│ │ Thông tin người mua:                               │ │
│ │ ┌─────────────────┐ ┌─────────────────┐            │ │
│ │ │ Tên *           │ │ MST *           │            │ │
│ │ │ [Công ty BH...]  │ │ [0100107929]    │            │ │
│ │ └─────────────────┘ └─────────────────┘            │ │
│ │                                                     │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ Địa chỉ: 233 Đồng Khởi, Q1, TP.HCM          │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ │                                                     │ │
│ │ Chi tiết hóa đơn:                                  │ │
│ │ ┌───────────────────────────────────────────────┐  │ │
│ │ │ [✓] Bao gồm phụ tùng (6,700,000 VNĐ)        │  │ │
│ │ │ [✓] Bao gồm vật liệu sơn (1,900,000 VNĐ)    │  │ │
│ │ │ [✓] Bao gồm dịch vụ (3,720,000 VNĐ)         │  │ │
│ │ │ [✓] Bao gồm công lao động (1,235,000 VNĐ)   │  │ │
│ │ └───────────────────────────────────────────────┘  │ │
│ │                                                     │ │
│ │ Tổng trước VAT:  12,363,636 VNĐ (trừ khấu hao)    │ │
│ │ VAT 10%:          1,236,364 VNĐ                    │ │
│ │ Tổng sau VAT:    13,600,000 VNĐ                    │ │
│ │ Khấu hao (10%):    -600,000 VNĐ                    │ │
│ │ ─────────────────────────                          │ │
│ │ SỐ TIỀN HĐ:      13,000,000 VNĐ                    │ │
│ │                                                     │ │
│ │ [✓] Đính kèm claim CLM-2024-005                    │ │
│ │ [✓] Đính kèm biên bản nghiệm thu                   │ │
│ │ [✓] Đính kèm ảnh trước/sau sửa chữa                │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🧾 PHIẾU THU CHO KHÁCH HÀNG:                           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Số phiếu: PT-2024-025                              │ │
│ │ Người trả: Nguyễn Minh Tuấn                        │ │
│ │ Nội dung: Phần khấu hao tự trả                     │ │
│ │ Số tiền: 600,000 VNĐ                               │ │
│ │ Thanh toán: [Tiền mặt ▼]                           │ │
│ │                                                     │ │
│ │ ⚠️ KHÔNG xuất hóa đơn VAT                          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ XUẤT HÓA ĐƠN ]    [ XEM TRƯỚC ]   [ HỦY ]    │
└─────────────────────────────────────────────────────────┘
```

---

### **💡 CÁC LƯU Ý QUAN TRỌNG:**

#### **1. Đối chiếu hóa đơn đầu vào - đầu ra**

```
┌─────────────────────────────────────────────────────────┐
│         ĐỐI CHIẾU HÓA ĐƠN                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📥 HÓA ĐƠN ĐẦU VÀO (Mua phụ tùng):                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ • Cản MB: HĐ BV20240010 - 2,400,000 VNĐ (có VAT)  │ │
│ │ • Đèn pha: HĐ BV20240001 - 3,200,000 VNĐ (có VAT) │ │
│ │ • Gương: HĐ BV20240005 - 1,100,000 VNĐ (có VAT)   │ │
│ │ • Sơn: HĐ PAINT2024001 - 1,900,000 VNĐ (có VAT)   │ │
│ │ ─────────────────────────────────                  │ │
│ │ TỔNG HĐ ĐẦU VÀO: 8,600,000 VNĐ                    │ │
│ │ (Đã bao gồm VAT 10%)                               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📤 HÓA ĐƠN ĐẦU RA (Bán cho BH):                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ HĐ 0001234 - Tổng hợp:                             │ │
│ │ • Phụ tùng + Vật liệu: 8,600,000 VNĐ               │ │
│ │ • Dịch vụ + Công: 4,955,000 VNĐ                    │ │
│ │ • VAT 10%: 1,355,500 VNĐ                           │ │
│ │ ─────────────────────────────────                  │ │
│ │ TỔNG HĐ ĐẦU RA: 14,910,500 VNĐ                    │ │
│ │ (Bao gồm VAT 10%)                                  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ✅ HỢP LỆ: Có đủ hóa đơn đầu vào để xuất đầu ra       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **2. Trường hợp KHÔNG đủ hóa đơn đầu vào**

```
┌─────────────────────────────────────────────────────────┐
│         ⚠️ CẢNH BÁO: KHÔNG ĐỦ HÓA ĐƠN                  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ Đơn hàng: SO-2024-030                                  │
│ Xe: 30C-11111 - BMW 3 Series (CÔNG TY)                │
│                                                         │
│ ❌ PHÁT HIỆN VẤN ĐỀ:                                   │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Một số phụ tùng KHÔNG CÓ hóa đơn VAT:              │ │
│ │                                                     │ │
│ │ • Gương chiếu hậu: 800,000 VNĐ                     │ │
│ │   ❌ Lô: BATCH-USED-001 (Tháo từ xe cũ)           │ │
│ │   ❌ Không có hóa đơn VAT                          │ │
│ │                                                     │ │
│ │ ⚠️ XE CÔNG TY không được dùng hàng này!            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ HÀNH ĐỘNG:                                             │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [ ] Thay thế bằng phụ tùng có HĐ                   │ │
│ │ [ ] Hủy phụ tùng này khỏi đơn hàng                 │ │
│ │ [ ] Liên hệ khách hàng thương lượng                │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 🚫 KHÔNG THỂ XUẤT HÓA ĐƠN VAT cho phụ tùng này!        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### **3. Báo cáo đối chiếu VAT**

```
┌─────────────────────────────────────────────────────────┐
│         BÁO CÁO ĐỐI CHIẾU VAT THÁNG 01/2024           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📥 VAT ĐẦU VÀO (Mua hàng):                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tổng mua hàng có HĐ:      52,300,000 VNĐ           │ │
│ │ VAT 10% đầu vào:           5,230,000 VNĐ           │ │
│ │ (Được khấu trừ)                                    │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📤 VAT ĐẦU RA (Bán hàng):                             │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Tổng bán hàng:            81,500,000 VNĐ           │ │
│ │ VAT 10% đầu ra:            8,150,000 VNĐ           │ │
│ │ (Phải nộp)                                         │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 💰 VAT PHẢI NỘP:                                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ VAT đầu ra:                8,150,000 VNĐ           │ │
│ │ VAT đầu vào (khấu trừ):   -5,230,000 VNĐ           │ │
│ │ ─────────────────────────────────                  │ │
│ │ VAT PHẢI NỘP:              2,920,000 VNĐ           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ⚠️ CHÚ Ý:                                              │
│ • Chỉ khấu trừ được VAT từ hàng có HĐ đầu vào         │
│ • Hàng không HĐ KHÔNG được khấu trừ VAT                │
│ • Hàng tháo xe cũ KHÔNG có VAT đầu vào                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

### **🎯 KẾT LUẬN: QUY TRÌNH XUẤT HÓA ĐƠN CHO ĐƠN PHỨC TẠP**

```
┌─────────────────────────────────────────────────────────┐
│         QUY TRÌNH CHUẨN                                │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ BƯỚC 1: XÁC ĐỊNH LOẠI XE                              │
│ ├─ Xe cá nhân → Linh hoạt (có/không HĐ)               │
│ ├─ Xe công ty → BẮT BUỘC hóa đơn VAT                  │
│ └─ Xe bảo hiểm → BẮT BUỘC hóa đơn VAT                 │
│                                                         │
│ BƯỚC 2: CHỌN PHỤ TÙNG PHÙ HỢP                         │
│ ├─ Hệ thống tự động lọc hàng có HĐ                    │
│ ├─ Chặn nếu chọn hàng không HĐ cho công ty/BH         │
│ └─ Hiển thị cảnh báo rõ ràng                          │
│                                                         │
│ BƯỚC 3: PHÂN LOẠI CHI PHÍ                             │
│ ├─ Phụ tùng thay thế (có HĐ đầu vào)                  │
│ ├─ Vật liệu sửa chữa/sơn (có HĐ đầu vào)              │
│ ├─ Dịch vụ (không cần HĐ đầu vào)                     │
│ └─ Công lao động (không cần HĐ đầu vào)               │
│                                                         │
│ BƯỚC 4: TÍNH TOÁN VAT                                 │
│ ├─ Tổng tiền chưa VAT                                 │
│ ├─ Cộng VAT 10%                                       │
│ └─ Tổng tiền sau VAT                                  │
│                                                         │
│ BƯỚC 5: XUẤT HÓA ĐƠN                                  │
│ ├─ CÁCH 1: Hóa đơn tổng hợp (Dễ quản lý)             │
│ │   • 1 hóa đơn bao gồm tất cả                       │
│ │   • Phân loại rõ: PT, VL, DV, Công                 │
│ │                                                     │
│ └─ CÁCH 2: Nhiều hóa đơn (Nếu yêu cầu)               │
│     • HĐ Phụ tùng                                     │
│     • HĐ Vật liệu                                     │
│     • HĐ Dịch vụ                                      │
│                                                         │
│ BƯỚC 6: XỬ LÝ KHẤU HAO (Nếu có)                       │
│ ├─ Bảo hiểm trả: Số tiền được duyệt → HĐ VAT          │
│ └─ Khách tự trả: Phần khấu hao → Phiếu thu            │
│                                                         │
│ BƯỚC 7: LƯU HỒ SƠ                                     │
│ ├─ Lưu bản gốc hóa đơn                                │
│ ├─ Lưu chứng từ liên quan                             │
│ └─ Lưu vào hệ thống kế toán                           │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 💰 QUẢN LÝ TÀI CHÍNH

### **Theo dõi thu chi**

#### **Xem tổng quan tài chính**

```
┌─────────────────────────────────────────────────────────┐
│              TỔNG QUAN TÀI CHÍNH                        │
├─────────────────────────────────────────────────────────┤
│ Kỳ báo cáo: Tháng 01/2024                             │
│                                                         │
│ 💰 DOANH THU:                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Dịch vụ sửa chữa:         45,500,000 VNĐ           │ │
│ │ Bán phụ tùng:             23,200,000 VNĐ           │ │
│ │ Tiền công:                12,800,000 VNĐ           │ │
│ │ ─────────────────────────────────────              │ │
│ │ TỔNG DOANH THU:           81,500,000 VNĐ           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 💸 CHI PHÍ:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Chi phí phụ tùng:         52,300,000 VNĐ           │ │
│ │ Chi phí nhân công:        15,600,000 VNĐ           │ │
│ │ Chi phí vận hành:          5,200,000 VNĐ           │ │
│ │ (Điện, nước, thuê MB...)                           │ │
│ │ ─────────────────────────────────────              │ │
│ │ TỔNG CHI PHÍ:             73,100,000 VNĐ           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 📊 LỢI NHUẬN:                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Lợi nhuận gộp:             8,400,000 VNĐ           │ │
│ │ Tỷ suất lợi nhuận:              10.3 %             │ │
│ │                                                     │ │
│ │ 📈 So với tháng trước: +5.2% (↗)                   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        [ CHI TIẾT ]    [ XUẤT BC ]    [ LỌC ]          │
└─────────────────────────────────────────────────────────┘
```

#### **Quản lý giao dịch**

```
┌─────────────────────────────────────────────────────────┐
│              GIAO DỊCH TÀI CHÍNH                        │
├─────────────────────────────────────────────────────────┤
│ 🔍 [Tìm kiếm...]  📅 [01/01-31/01]  💰 [Tất cả ▼]      │
│                                                         │
│ 💰 THU NHẬP HÔM NAY (16/01/2024):                      │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ FIN-2024-001 | 15:00 | Thu từ đơn SO-2024-001      │ │
│ │ Loại: Doanh thu dịch vụ | Tiền mặt                 │ │
│ │ Số tiền: +3,525,000 VNĐ                            │ │
│ │ KH: Nguyễn Minh Tuấn                               │ │
│ │ [📋 Chi tiết] [🖨️ In phiếu]                        │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 💸 CHI PHÍ HÔM NAY:                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ FIN-2024-101 | 08:00 | Chi phí điện tháng 1        │ │
│ │ Loại: Chi phí vận hành | Chuyển khoản              │ │
│ │ Số tiền: -2,500,000 VNĐ                            │ │
│ │ NCC: Điện lực TP.HCM                               │ │
│ │ [📋 Chi tiết] [✏️ Sửa]                              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ TỔNG KẾT HÔM NAY:                                      │
│ • Thu: +3,525,000 VNĐ                                 │
│ • Chi: -2,500,000 VNĐ                                 │
│ • Lãi: +1,025,000 VNĐ                                 │
│                                                         │
│        [ TẠO GD ]    [ XUẤT BC ]    [ LỌC ]            │
└─────────────────────────────────────────────────────────┘
```

### **Quản lý công nợ**

```
┌─────────────────────────────────────────────────────────┐
│              QUẢN LÝ CÔNG NỢ                            │
├─────────────────────────────────────────────────────────┤
│ 🔍 [Tìm kiếm...]  📅 [Tất cả]  ⚠️ [Quá hạn ▼]          │
│                                                         │
│ ⚠️ QUÁ HẠN THANH TOÁN (2 đơn):                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ⚠️ SO-2024-010 | Trần Văn Đức                       │ │
│ │ Xe: 30C-11111 - BMW 3 Series (Công ty)             │ │
│ │ Tổng: 4,500,000 VNĐ | Đã TT: 2,000,000 VNĐ         │ │
│ │ Còn nợ: 2,500,000 VNĐ                              │ │
│ │ Hạn TT: 25/01/2024 | Quá hạn: 6 ngày               │ │
│ │ [📞 Nhắc nợ] [💰 Thu tiền] [📋 Chi tiết]           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ⏰ SẮP ĐẾN HẠN (3 đơn):                                │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ⏰ SO-2024-015 | Phạm Thị Lan                        │ │
│ │ Xe: 30D-22222 - Honda Accord                       │ │
│ │ Tổng: 1,800,000 VNĐ | Đã TT: 0 VNĐ                 │ │
│ │ Còn nợ: 1,800,000 VNĐ                              │ │
│ │ Hạn TT: 05/02/2024 | Còn: 4 ngày                   │ │
│ │ [📞 Nhắc nhở] [💰 Thu tiền] [📋 Chi tiết]          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ TỔNG KẾT CÔNG NỢ:                                      │
│ • Tổng công nợ: 8,500,000 VNĐ                         │
│ • Quá hạn: 2,500,000 VNĐ (2 đơn)                      │
│ • Sắp đến hạn: 6,000,000 VNĐ (3 đơn)                  │
│                                                         │
│        [ GỬI NHẮC NỢ ]    [ XUẤT BC ]    [ LỌC ]      │
└─────────────────────────────────────────────────────────┘
```

---

## 📊 BÁO CÁO VÀ THỐNG KÊ

### **Dashboard tổng quan**
```
┌─────────────────────────────────────────────────────────┐
│                    DASHBOARD                            │
├─────────────────────────────────────────────────────────┤
│ 📈 DOANH THU HÔM NAY                                    │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ 2,500,000 VNĐ   │ │ +15% so với     │                 │
│ │                 │ │ hôm qua         │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ 📋 ĐƠN HÀNG HÔM NAY                                     │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ 12 đơn hàng     │ │ 8 hoàn thành    │                 │
│ │                 │ │ 4 đang xử lý    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ 🔧 PHỤ TÙNG CẢNH BÁO                                    │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ 5 phụ tùng      │ │ Tồn kho thấp    │                 │
│ │                 │ │ Cần nhập thêm   │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│ 💰 CÔNG NỢ                                              │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ 3 khách hàng    │ │ Tổng nợ:        │                 │
│ │                 │ │ 1,200,000 VNĐ   │                 │
│ └─────────────────┘ └─────────────────┘                 │
└─────────────────────────────────────────────────────────┘
```

### **Báo cáo doanh thu**
1. Vào **"📊 Báo cáo"** → **"💰 Doanh thu"**
2. Chọn khoảng thời gian:
```
┌─────────────────────────────────────────────────────────┐
│              BÁO CÁO DOANH THU                          │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Từ ngày *       │ │ Đến ngày *      │                 │
│ │ [01/01/2024]    │ │ [31/01/2024]    │                 │
│ └─────────────────┘ └─────────────────┘                 │
│ ┌─────────────────┐ ┌─────────────────┐                 │
│ │ Loại báo cáo    │ │ Định dạng xuất  │                 │
│ │ [Chi tiết ▼]    │ │ [PDF ▼]         │                 │
│ └─────────────────┘ └─────────────────┘                 │
│                                                         │
│        [ TẠO BÁO CÁO ]                                  │
└─────────────────────────────────────────────────────────┘
```

### **Báo cáo tồn kho**
1. Vào **"📊 Báo cáo"** → **"📦 Tồn kho"**
2. **Báo cáo tồn kho thấp**: Hiển thị phụ tùng cần nhập thêm
3. **Báo cáo xuất nhập**: Theo dõi giao dịch kho

---

## 🚨 TROUBLESHOOTING

### **Lỗi thường gặp**

#### **1. Không đăng nhập được**
**Triệu chứng**: Nhập đúng username/password nhưng không vào được
**Giải pháp**:
1. Kiểm tra kết nối internet
2. Xóa cache trình duyệt
3. Thử trình duyệt khác
4. Liên hệ admin để reset mật khẩu

#### **2. Không tìm thấy phụ tùng**
**Triệu chứng**: Tìm kiếm phụ tùng nhưng không có kết quả
**Giải pháp**:
1. Kiểm tra từ khóa tìm kiếm
2. Thử tìm theo mã phụ tùng
3. Kiểm tra phụ tùng có đang hoạt động không
4. Liên hệ admin để thêm phụ tùng mới

#### **3. Lỗi khi lưu đơn hàng**
**Triệu chứng**: Click "Lưu" nhưng không lưu được
**Giải pháp**:
1. Kiểm tra các trường bắt buộc (có dấu *)
2. Kiểm tra kết nối internet
3. Thử refresh trang và làm lại
4. Liên hệ IT support

#### **4. Báo cáo không hiển thị**
**Triệu chứng**: Click "Tạo báo cáo" nhưng không có dữ liệu
**Giải pháp**:
1. Kiểm tra khoảng thời gian chọn
2. Kiểm tra quyền truy cập báo cáo
3. Thử xuất định dạng khác (Excel, PDF)
4. Liên hệ admin để cấp quyền

### **Liên hệ hỗ trợ**
- **📞 Hotline**: 1900-xxxx
- **📧 Email**: support@garamanager.com
- **💬 Chat**: Trực tiếp trên website
- **🕐 Giờ làm việc**: 8:00 - 17:30 (Thứ 2 - Thứ 6)

---

## 13. QUY TRÌNH NGHIỆP VỤ

### **Tổng quan:**
Hệ thống quản lý garage theo quy trình nghiệp vụ từ Tiếp nhận → Sửa chữa → Thanh toán.

---

### **Giai đoạn 1: Tiếp Nhận & Báo Giá**

Quy trình tiếp nhận khách hàng, kiểm tra xe và tạo báo giá.

*(Chi tiết sẽ được bổ sung sau)*

---

### **Giai đoạn 2: Sửa Chữa & Quản Lý Xuất Kho**

Giai đoạn 2 bao gồm toàn bộ quy trình từ khi Phiếu Sửa Chữa (JO) được tạo cho đến khi xe được nghiệm thu chất lượng và sẵn sàng bàn giao cho khách hàng.

---

## 📋 TỔNG QUAN GIAI ĐOẠN 2

### **🎯 Mục đích chính:**

Giai đoạn 2 quản lý toàn bộ quy trình sửa chữa từ khi JO được khách hàng duyệt đến khi xe được nghiệm thu chất lượng và sẵn sàng bàn giao.

### **📊 Workflow tổng thể:**

```
┌─────────────────────────────────────────────────────────────┐
│ GIAI ĐOẠN 2: SỬA CHỮA & QUẢN LÝ XUẤT KHO                     │
└─────────────────────────────────────────────────────────────┘

2.1: LẬP KẾ HOẠCH & PHÂN CÔNG
├── 2.1.1: Chuyển JO sang "Chờ Phân công"
│   └── CVDV chuyển trạng thái JO từ "Pending" → "PendingAssignment"
│
└── 2.1.2: Phân công KTV & Thời gian
    └── Quản đốc/Tổ trưởng phân công KTV và nhập giờ công dự kiến cho từng item
    └── JO tự động chuyển sang "ReadyToWork" khi tất cả items đã được phân công

         ↓

2.2: YÊU CẦU VẬT TƯ (MATERIAL REQUEST - MR)
└── Tạo MR để yêu cầu phụ tùng từ kho
    └── Workflow: Draft → PendingApproval → Approved → Picked → Issued → Delivered
    └── JO chuyển sang "WaitingForParts" (nếu cần vật tư) hoặc vẫn "ReadyToWork" (nếu không cần)

         ↓

2.3: QUẢN LÝ TIẾN ĐỘ & PHÁT SINH
├── 2.3.1: Bắt đầu Công việc
│   └── KTV bắt đầu làm việc trên từng item (Start → Stop → Complete)
│   └── Hệ thống tự động tính giờ công thực tế
│
├── 2.3.2: Phát hiện Phát sinh
│   └── KTV báo cáo vấn đề phát hiện trong quá trình sửa chữa
│   └── Item liên quan tự động chuyển sang "OnHold"
│
├── 2.3.3: Báo giá Phát sinh
│   └── CVDV lập báo giá bổ sung cho phát sinh
│   └── Khách hàng duyệt → Tạo LSC Bổ sung → Quay lại 2.2 (nếu có vật tư)
│
└── 2.3.4: Cập nhật Tiến độ
    └── Hệ thống tự động cập nhật tiến độ dựa trên trạng thái items
    └── Hiển thị tổng giờ công thực tế, số items đã hoàn thành, tiến độ %

         ↓

2.4: KIỂM TRA CHẤT LƯỢNG (QC) VÀ BÀN GIAO
├── 2.4.1: Hoàn thành Kỹ thuật
│   └── KTV hoàn thành tất cả items → Click "Hoàn Thành Kỹ Thuật"
│   └── JO chuyển sang "WaitingForQC"
│
├── 2.4.2: Kiểm tra QC
│   └── Tổ trưởng/QC kiểm tra chất lượng → Đánh giá "Đạt" hoặc "Không Đạt"
│   └── Nếu Đạt: JO chuyển sang "ReadyToBill"
│   └── Nếu Không Đạt: JO chuyển về "InProgress" → KTV làm lại
│
├── 2.4.3: Xử lý QC Không đạt
│   └── KTV làm lại theo ghi chú QC → Ghi nhận giờ công làm lại
│   └── Complete Technical lại → QC lại
│
└── 2.4.4: Bàn giao xe
    └── Sau khi QC Đạt, CVDV bàn giao xe cho khách hàng
    └── JO sẵn sàng để thanh toán (Giai đoạn 3)

         ↓

GIAI ĐOẠN 3: QUYẾT TOÁN & GIAO XE
```

### **🔑 Key Points:**

1. **Thứ tự thực hiện:**
   - Phải tuân thủ đúng workflow: 2.1 → 2.2 → 2.3 → 2.4
   - Không được bỏ qua bước hoặc thực hiện không đúng thứ tự

2. **Status Transitions:**
   ```
   Pending → PendingAssignment → WaitingForParts/ReadyToWork → 
   InProgress → Completed → WaitingForQC → QCInProgress → 
   ReadyToBill (nếu QC Pass) hoặc InProgress (nếu QC Fail)
   ```

3. **Roles & Responsibilities:**
   - **CVDV (Cố vấn Dịch vụ):** Chuyển trạng thái JO, tạo báo giá phát sinh, bàn giao xe
   - **Quản đốc/Tổ trưởng:** Phân công KTV, phê duyệt MR, kiểm tra QC
   - **KTV:** Bắt đầu/Dừng/Hoàn thành công việc, báo cáo phát sinh, cập nhật tiến độ
   - **Thủ kho:** Xử lý MR (Pick → Issue → Deliver)

4. **Integration giữa các giai đoạn:**
   - 2.1 tự động khóa Quotation khi chuyển sang "PendingAssignment"
   - 2.2 tạo MR từ JO, vật tư được xuất kho cho JO
   - 2.3.3 có thể quay lại 2.2 nếu phát sinh cần vật tư
   - 2.4 kết thúc Giai đoạn 2 và chuyển sang Giai đoạn 3

---

## 2.1. LẬP KẾ HOẠCH & PHÂN CÔNG

### **📍 Vị trí trong hệ thống:**

**Menu Navigation:**
```
Sidebar Menu
└── Quy Trình Nghiệp Vụ
    ├── GIAI ĐOẠN 1: Tiếp Nhận & Báo Giá
    │   ├── 1. Tiếp Đón Khách Hàng
    │   ├── 2. Kiểm Tra Xe
    │   └── 3. Báo Giá
    │
    └── GIAI ĐOẠN 2: Sửa Chữa & Thanh Toán
        └── 4. Phiếu Sửa Chữa ⬅️ **GIAI ĐOẠN 2.1 NẰM ĐÂY**
```

**URL/Route:**
- Controller: `OrderManagement`
- Action: `Index`
- URL: `/OrderManagement` hoặc `/OrderManagement/Index`

**Màn hình chính:**
Trang **"Quản Lý Phiếu Sửa Chữa"** với DataTable hiển thị danh sách ServiceOrder (JO)

---

### **🎯 Tổng quan quy trình:**

**Giai đoạn 2.1** được thực hiện sau khi:
- ✅ Báo giá đã được khách hàng duyệt (Approve)
- ✅ ServiceOrder (JO) đã được tạo từ Quotation
- ✅ JO có trạng thái **"Pending"** (Chờ Xử Lý)

**Workflow:**
```
Pending → PendingAssignment → ReadyToWork → InProgress → Completed
   ↑              ↑                    ↑
   │              │                    │
   │         2.1.1 Chuyển      2.1.2 Phân công
   │         trạng thái        KTV hoàn tất
```

---

## 2.1.1. CHUYỂN JO SANG "CHỜ PHÂN CÔNG"

### **Mục đích:**
Chuyển JO từ trạng thái "Pending" sang "PendingAssignment" để bắt đầu quy trình phân công KTV.

### **Yêu cầu:**
- ✅ Quyền: **Bất kỳ user nào** đều có thể chuyển trạng thái
- ✅ JO phải ở trạng thái **"Pending"** (Chờ Xử Lý)

### **Các bước thực hiện:**

#### **Bước 1: Vào trang Quản Lý Phiếu Sửa Chữa**

1. Đăng nhập vào hệ thống
2. Click menu **"Quy Trình Nghiệp Vụ"** ở sidebar bên trái
3. Click **"4. Phiếu Sửa Chữa"** (trong GIAI ĐOẠN 2)
4. Màn hình hiển thị danh sách các JO (ServiceOrder) với các cột:
   - ID
   - Số Đơn Hàng
   - Khách Hàng
   - Xe
   - Ngày Đặt
   - Tổng Tiền
   - Trạng Thái
   - Thao Tác

#### **Bước 2: Tìm JO có trạng thái "Pending"**

- Trong cột "Trạng Thái", tìm các JO có status = **"Chờ Xử Lý"** hoặc **"Pending"**

#### **Bước 3: Click nút chuyển trạng thái**

- Trong cột "Thao Tác", tìm nút **"→"** (mũi tên phải, màu xanh dương)
- Nút này chỉ hiển thị khi status = "Pending"
- Tooltip: **"Chuyển sang Chờ Phân công"**

#### **Bước 4: Xác nhận**

- Popup SweetAlert hiện: **"Chuyển trạng thái?"**
- Click **"Xác nhận"**

#### **Kết quả:**
- ✅ JO chuyển sang trạng thái **"Chờ Phân Công"** (PendingAssignment)
- ✅ Báo giá (Quotation) tự động bị khóa - không thể chỉnh sửa nữa
- ✅ DataTable tự động reload để hiển thị trạng thái mới

**Lưu ý:**
- Sau khi chuyển, nút **"→"** sẽ biến mất
- Nút **"👔 Phân công"** sẽ xuất hiện ở bước tiếp theo

---

## 2.1.2. PHÂN CÔNG KTV & THỜI GIAN

### **Mục đích:**
Phân công KTV phù hợp cho từng hạng mục sửa chữa và nhập giờ công dự kiến.

### **Yêu cầu:**
- ✅ Quyền: **Chỉ Quản đốc/Tổ trưởng/Quản lý** mới có quyền phân công
- ✅ JO phải ở trạng thái **"PendingAssignment"** (Chờ Phân Công)

---

### **A. Mở Modal Phân Công**

1. **Tìm JO có trạng thái "Chờ Phân Công"**
   - Trong cột "Trạng Thái", tìm JO có status = **"Chờ Phân Công"** hoặc **"PendingAssignment"**

2. **Click nút phân công**
   - Trong cột "Thao Tác", click nút **"👔"** (màu xanh lá)
   - Tooltip: **"Phân công KTV"**
   - Nút này chỉ hiển thị khi status = "PendingAssignment"

3. **Modal hiện ra** với:
   - Header: **"Phân Công KTV - JO: [Số đơn hàng]"**
   - Phần **"Phân Công Hàng Loạt"** (tùy chọn)
   - Bảng danh sách các hạng mục (items)

---

### **B. Phân Công Từng Item (Chi tiết)**

**Các cột trong bảng:**
- **#**: Số thứ tự
- **Hạng Mục**: Tên dịch vụ/phụ tùng
- **KTV Được Phân Công**: Dropdown chọn KTV (có hiển thị workload)
- **Giờ Công Dự Kiến**: Input số giờ (0.1 - 24 giờ)
- **Trạng Thái**: Status của item
- **Thao Tác**: Nút **"✓"** để phân công

**Workload trong Dropdown:**
Khi chọn KTV, dropdown hiển thị:
```
"Nguyễn Văn A - KTV (6.5h/8h, 3 JO, 81% tải)"
         ↑              ↑     ↑        ↑
      Tên + Chức vụ   Đã phân   Số JO   % capacity
```

**Thao tác:**

1. **Chọn KTV cho item**
   - Click dropdown "KTV Được Phân Công" ở item muốn phân công
   - Chọn KTV từ danh sách (có hiển thị workload)
   - Workload hiển thị: tổng giờ công, số JO đang làm, % capacity

2. **Nhập Giờ Công Dự Kiến** (tùy chọn)
   - Click vào ô "Giờ Công Dự Kiến"
   - Nhập số giờ (ví dụ: 2.5 cho 2 giờ rưỡi)
   - Validation: 0.1 - 24 giờ

3. **Phân công item**
   - Click nút **"✓"** (màu xanh lá) ở cột "Thao Tác"
   - Hệ thống gửi request đến API
   - Thông báo: **"Phân công KTV thành công!"**
   - Modal tự động reload để hiển thị thông tin mới

**Lặp lại** cho các items khác nếu cần.

---

### **C. Phân Công Hàng Loạt (Nhanh)**

**Mục đích:** Phân công cùng một KTV và giờ công cho tất cả items chưa được phân công.

**Thao tác:**

1. **Ở phần "Phân Công Hàng Loạt"** (phía trên bảng items)

2. **Chọn KTV**
   - Dropdown **"KTV:"** (có hiển thị workload)

3. **Nhập Giờ Công Dự Kiến** (tùy chọn)
   - Input **"Giờ Công Dự Kiến:"**
   - Số giờ này sẽ áp dụng cho TẤT CẢ items chưa được phân công

4. **Click "Áp Dụng"**
   - Button màu xanh lá
   - Hệ thống tự động phân công cho tất cả items chưa có KTV
   - Thông báo: **"Đã phân công X hạng mục thành công!"**

**Lưu ý:**
- Chỉ áp dụng cho items **chưa được phân công** (KTV = "-- Chọn KTV --")
- Items đã có KTV sẽ không bị thay đổi

---

### **D. Lưu Tất Cả Phân Công**

**Mục đích:** Lưu tất cả các thay đổi phân công đã chọn nhưng chưa submit.

**Khi nào dùng:**
- Đã chọn KTV cho nhiều items nhưng chưa click "✓" từng cái
- Đã dùng phân công hàng loạt nhưng muốn đảm bảo tất cả được lưu

**Thao tác:**

1. **Đảm bảo đã chọn KTV cho các items cần phân công**
   - Kiểm tra trong dropdown của từng item

2. **Click "Lưu Tất Cả Phân Công"**
   - Button màu xanh dương ở footer modal
   - Icon: 💾 (save)

3. **Hệ thống xử lý:**
   - Gửi requests song song cho tất cả items đã chọn KTV
   - Thông báo: **"Đã lưu X phân công thành công!"**
   - Modal tự động đóng
   - DataTable reload

**Kết quả:**
- ✅ Tất cả items đã được phân công
- ✅ Nếu **TẤT CẢ items đã có KTV** → JO tự động chuyển sang **"Sẵn Sàng Làm"** (ReadyToWork)

---

### **🔒 Phân quyền:**

**Chỉ các role sau mới có quyền phân công:**
- ✅ **Quản đốc** (Position chứa "quản đốc")
- ✅ **Tổ trưởng** (Position chứa "tổ trưởng")
- ✅ **Quản lý** (Position chứa "quản lý")
- ✅ **Manager** (Role trong IdentityServer)
- ✅ **Supervisor** (Role trong IdentityServer)
- ✅ **Admin** / **SuperAdmin** (Role trong IdentityServer)

**Nếu không có quyền:**
- API sẽ trả về **403 Forbidden**
- Thông báo: **"Chỉ Quản đốc, Tổ trưởng hoặc Quản lý mới có quyền phân công KTV"**

---

### **📊 Hiển thị thông tin phân công:**

#### **Trong View Modal:**

1. **Mở View Modal:**
   - Click nút **"👁️"** (màu xanh dương) trong cột "Thao Tác"

2. **Xem thông tin:**
   - Trong bảng "Danh Sách Hạng Mục", có 2 cột mới:
     - **"KTV Được Phân Công"**: Tên KTV (hoặc "Chưa phân công")
     - **"Giờ Công Dự Kiến"**: Số giờ (hoặc "-" nếu chưa có)

---

### **⚠️ Lưu ý quan trọng:**

1. **Workflow States:**
   - Phải tuân thủ đúng workflow: **Pending → PendingAssignment → ReadyToWork**
   - Không thể nhảy bước hoặc quay lại (trừ khi là Admin)

2. **Lock Quotation:**
   - Khi JO đã chuyển sang **"PendingAssignment"**, Báo giá (Quotation) sẽ **bị khóa**
   - Không thể chỉnh sửa Quotation nữa
   - Nút "Sửa" trong Quotation Management sẽ bị ẩn hoặc hiển thị warning

3. **Validation:**
   - **EstimatedHours**: Phải từ 0.1 đến 24 giờ
   - **TechnicianId**: Bắt buộc phải chọn (không thể để trống)

4. **Auto-transition:**
   - Khi **TẤT CẢ items** đã được phân công → JO tự động chuyển sang **"Sẵn Sàng Làm"** (ReadyToWork)
   - Điều này xảy ra ngay sau khi phân công item cuối cùng

5. **Appointment Integration:**
   - Khi phân công KTV, hệ thống tự động:
     - Tìm Appointment liên quan đến ServiceOrder
     - Cập nhật `AssignedToId` nếu chưa có
     - Cập nhật `EstimatedDuration` dựa trên tổng EstimatedHours
     - Tạo Appointment mới nếu chưa có (khi có ScheduledDate)

---

### **💡 Ví dụ thực tế:**

**Scenario: Phân công sửa chữa xe**

**Tình huống:**
- JO có 3 items:
  - Item 1: "Thay dầu máy" (chưa phân công)
  - Item 2: "Sửa phanh" (chưa phân công)
  - Item 3: "Bảo dưỡng" (chưa phân công)

**Cách làm:**

**Option 1: Phân công từng item**
1. Chọn KTV "Nguyễn Văn A - KTV" cho Item 1, nhập 1.5 giờ → Click "✓"
2. Chọn KTV "Trần Thị B - KTV" cho Item 2, nhập 2 giờ → Click "✓"
3. Chọn KTV "Nguyễn Văn A - KTV" cho Item 3, nhập 1 giờ → Click "✓"

**Option 2: Phân công hàng loạt**
1. Chọn KTV "Nguyễn Văn A - KTV" trong dropdown hàng loạt
2. Nhập 1.5 giờ
3. Click "Áp Dụng" → Tất cả 3 items đều được phân công cho KTV A với 1.5 giờ

**Option 3: Kết hợp**
1. Phân công hàng loạt Item 1, 3 cho KTV A (1.5 giờ)
2. Phân công riêng Item 2 cho KTV B (2 giờ)

---

### **❓ Xử lý sự cố:**

**Không thấy nút "Phân công":**
- ✅ Kiểm tra JO có status = "PendingAssignment" chưa?
- ✅ Kiểm tra có quyền Quản đốc/Tổ trưởng không?

**Không thể chọn KTV:**
- ✅ Kiểm tra danh sách KTV có được load không?
- ✅ Kiểm tra network console xem có lỗi API không?

**Lỗi khi phân công:**
- ✅ Kiểm tra EstimatedHours có trong khoảng 0.1 - 24 không?
- ✅ Kiểm tra KTV có tồn tại không?
- ✅ Kiểm tra console để xem lỗi chi tiết

**Workload không hiển thị:**
- ✅ Kiểm tra API endpoint `/api/employees/{id}/workload` có hoạt động không?
- ✅ Workload chỉ hiển thị khi có dữ liệu phân công

---

## 2.3. QUẢN LÝ TIẾN ĐỘ & PHÁT SINH

### **📍 Vị trí trong hệ thống:**

**Menu Navigation:**
```
Sidebar Menu
└── Quy Trình Nghiệp Vụ
    └── GIAI ĐOẠN 2: Sửa Chữa & Thanh Toán
        ├── 4. Phiếu Sửa Chữa (JO)
        └── Tab "Phát Sinh" trong Chi Tiết Phiếu Sửa Chữa ⬅️ **GIAI ĐOẠN 2.3 NẰM ĐÂY**
```

**URL/Route:**
- Controller: `OrderManagement`
- Action: `Index` → Click "Xem" → Tab "Phát Sinh"
- URL: `/OrderManagement` → Modal "Chi Tiết Phiếu Sửa Chữa" → Tab "Phát Sinh"

---

### **🎯 Tổng quan quy trình:**

**Giai đoạn 2.3** bao gồm 4 phần chính:
1. **2.3.1: Bắt đầu Công việc** - KTV bắt đầu làm việc theo từng item
2. **2.3.2: Phát hiện Phát sinh** - KTV báo cáo vấn đề phát hiện ngoài JO ban đầu
3. **2.3.3: Báo giá Phát sinh** - CVDV lập báo giá bổ sung cho phát sinh
4. **2.3.4: Cập nhật Tiến độ** - KTV cập nhật tiến độ công việc theo từng mốc

**Workflow tổng thể:**
```
KTV bắt đầu làm việc (2.3.1)
    ↓
Phát hiện phát sinh (2.3.2)
    ↓
CVDV tạo báo giá bổ sung (2.3.3)
    ↓
Khách hàng duyệt → Tạo LSC Bổ sung
    ↓
Xuất kho vật tư cho phát sinh (quay lại 2.2)
    ↓
KTV tiếp tục sửa chữa
    ↓
Cập nhật tiến độ và hoàn thành (2.3.4)
```

---

## 2.3.1. BẮT ĐẦU CÔNG VIỆC

### **Mục đích:**
KTV bắt đầu làm việc trên từng hạng mục (ServiceOrderItem) và hệ thống tự động ghi nhận thời gian thực tế.

### **Yêu cầu:**
- ✅ KTV phải được phân công cho hạng mục đó (`AssignedTechnicianId`)
- ✅ ServiceOrder phải ở trạng thái `PendingAssignment`, `ReadyToWork`, hoặc `InProgress`
- ✅ Hạng mục phải ở trạng thái `Pending` hoặc `InProgress`

### **Các bước thực hiện:**

#### **Bước 1: Mở Chi Tiết Phiếu Sửa Chữa**
1. Vào trang **"Quản Lý Phiếu Sửa Chữa"**
2. Click nút **"Xem"** (icon mắt) của ServiceOrder cần làm việc
3. Modal **"Chi Tiết Phiếu Sửa Chữa"** hiện ra
4. Click tab **"Chi Tiết Dịch Vụ"**

#### **Bước 2: Bắt đầu làm việc**
Trong bảng "Chi Tiết Dịch Vụ", mỗi hạng mục có:
- **Trạng Thái**: Hiển thị badge màu (Pending, InProgress, Completed)
- **Giờ Công Thực Tế**: Hiển thị số giờ đã làm (nếu có)
- **Thao Tác**: Các nút điều khiển

**Để bắt đầu làm việc:**
1. Tìm hạng mục có trạng thái **"Chờ" (Pending)**
2. Click nút **"Bắt đầu"** (màu xanh lá) trong cột "Thao Tác"
3. Hệ thống sẽ:
   - Ghi nhận `StartTime` = thời gian hiện tại
   - Chuyển trạng thái sang **"Đang làm" (InProgress)**
   - Nếu là item đầu tiên bắt đầu → Tự động chuyển ServiceOrder sang `InProgress`

#### **Bước 3: Dừng làm việc (tùy chọn)**
Nếu cần tạm dừng:
1. Click nút **"Dừng"** (màu vàng) trên hạng mục đang làm
2. Hệ thống sẽ:
   - Ghi nhận `EndTime` = thời gian hiện tại
   - Tính `ActualHours` từ `StartTime` đến `EndTime`
   - **Cộng dồn** vào `ActualHours` hiện có (nếu đã dừng trước đó)
   - Chuyển trạng thái sang **"Chờ" (Pending)**

#### **Bước 4: Hoàn thành hạng mục**
Khi hoàn thành công việc:
1. Click nút **"Hoàn thành"** (màu xanh dương) trên hạng mục đang làm
2. Hệ thống sẽ:
   - Ghi nhận `EndTime` và `CompletedTime` = thời gian hiện tại
   - Tính `ActualHours` (cộng dồn nếu đã dừng trước đó)
   - Chuyển trạng thái sang **"Hoàn thành" (Completed)**
   - Nếu tất cả items đã hoàn thành → Tự động chuyển ServiceOrder sang `Completed`

---

## 2.3.2. PHÁT HIỆN PHÁT SINH

### **Mục đích:**
KTV báo cáo các vấn đề phát hiện trong quá trình sửa chữa ngoài JO ban đầu. Khi có phát sinh, hệ thống tự động chuyển hạng mục liên quan sang trạng thái **"OnHold"**.

### **Yêu cầu:**
- ✅ KTV phải được phân công cho ServiceOrder hoặc hạng mục đó
- ✅ ServiceOrder phải ở trạng thái `ReadyToWork` hoặc `InProgress`

### **Các bước thực hiện:**

#### **Bước 1: Mở tab Phát Sinh**
1. Vào trang **"Quản Lý Phiếu Sửa Chữa"**
2. Click nút **"Xem"** của ServiceOrder
3. Trong modal **"Chi Tiết Phiếu Sửa Chữa"**, click tab **"Phát Sinh"**

#### **Bước 2: Báo cáo phát sinh mới**
1. Click nút **"Báo Cáo Phát Sinh"** (màu vàng)
2. Modal **"Báo Cáo Phát Sinh"** hiện ra
3. Điền thông tin:
   - **Hạng mục bị ảnh hưởng** (optional):
     - Chọn từ dropdown (nếu có)
     - Nếu không chọn: Phát sinh ảnh hưởng toàn bộ ServiceOrder
     - Nếu chọn: Hạng mục đó sẽ tự động chuyển sang **"OnHold"**
   - **Danh mục** (required): Engine, Brake, Suspension, Electrical, Body, Tire, Other
   - **Tên phát sinh** (required): VD: "Phát hiện rò rỉ dầu ở gioăng nắp máy"
   - **Mô tả chi tiết** (required): Mô tả đầy đủ vấn đề
   - **Mức độ nghiêm trọng**: Critical, High, Medium, Low
   - **Cần xử lý ngay**: Checkbox nếu khẩn cấp
   - **Ghi chú KTV**: Ghi chú kỹ thuật (optional)
   - **Hình ảnh**: Upload nhiều ảnh minh họa (optional, max 5MB/ảnh)
4. Click **"Lưu"** để báo cáo

#### **Bước 3: Xem danh sách phát sinh**
Sau khi lưu, danh sách phát sinh sẽ hiển thị trong tab "Phát Sinh" với:
- **Tên phát sinh**
- **Danh mục**
- **Mức độ** (badge màu)
- **Trạng thái**: 
  - 🟦 **Mới phát hiện** (Identified)
  - 🟨 **Đã báo giá** (Quoted)
  - 🟩 **Đã duyệt** (Approved)
  - 🟥 **Từ chối** (Rejected)
  - ✅ **Đã sửa** (Repaired)
- **Ngày báo cáo**
- **KTV báo cáo**
- **Hình ảnh** (nếu có)
- **Thao tác**: Xem chi tiết, Tạo Báo Giá (nếu chưa có), Sửa, Xóa

#### **Tác động khi báo cáo phát sinh:**
- ✅ Nếu chọn **hạng mục bị ảnh hưởng**: Hạng mục đó tự động chuyển sang **"OnHold"**
- ✅ Ghi chú của hạng mục được cập nhật: `"Phát sinh: [Tên phát sinh]. Dừng công việc chờ khách hàng duyệt."`
- ✅ KTV không thể tiếp tục làm việc trên hạng mục đó cho đến khi phát sinh được giải quyết

---

## 2.3.3. BÁO GIÁ PHÁT SINH

### **Mục đích:**
CVDV (Cố vấn Dịch vụ) lập báo giá bổ sung cho phát sinh và liên hệ khách hàng để xin duyệt.

### **Yêu cầu:**
- ✅ Phát sinh phải ở trạng thái `Identified` hoặc `Reported`
- ✅ Chưa có báo giá bổ sung cho phát sinh đó (`AdditionalQuotationId` = null)

### **Các bước thực hiện:**

#### **Bước 1: Mở tab Phát Sinh**
1. Vào trang **"Quản Lý Phiếu Sửa Chữa"**
2. Click **"Xem"** của ServiceOrder có phát sinh
3. Click tab **"Phát Sinh"**

#### **Bước 2: Tạo báo giá bổ sung**
1. Tìm phát sinh có trạng thái **"Mới phát hiện"** hoặc **"Đã báo cáo"**
2. Click nút **"Tạo Báo Giá"** (màu xanh lá, icon file-invoice-dollar)
3. Modal **"Tạo Báo Giá Bổ Sung Từ Phát Sinh"** hiện ra

#### **Bước 3: Điền thông tin báo giá**
Modal hiển thị:
- **Thông tin phát sinh**: Tên, danh mục, mô tả (read-only)
- **Ngày hết hạn**: Chọn ngày hết hạn báo giá (mặc định: 7 ngày)
- **Giảm giá**: Nhập số tiền giảm giá (nếu có)
- **Mô tả**: Mô tả về báo giá bổ sung
- **Điều khoản**: Điều khoản và điều kiện
- **Ghi chú khách hàng**: Ghi chú cho khách hàng

#### **Bước 4: Thêm chi tiết báo giá**
1. Click **"Thêm Item"** để thêm dịch vụ/phụ tùng vào báo giá
2. Điền thông tin cho mỗi item:
   - **Tên dịch vụ/phụ tùng**: Nhập tên
   - **Mô tả**: Mô tả chi tiết (optional)
   - **Số lượng**: Nhập số lượng (mặc định: 1)
   - **Đơn giá**: Nhập đơn giá
   - **Có HĐ**: Checkbox nếu có hóa đơn
   - **VAT %**: Nhập % VAT (mặc định: 10%)
   - **Tạm tính**: Tự động tính = Số lượng × Đơn giá
   - **VAT**: Tự động tính = Tạm tính × VAT% (nếu có HĐ)
   - **Thành tiền**: Tự động tính = Tạm tính + VAT
3. Click **"Xóa"** để xóa item không cần thiết

#### **Bước 5: Xem tổng kết**
Hệ thống tự động tính:
- **Tạm tính**: Tổng của tất cả "Tạm tính"
- **VAT**: Tổng của tất cả "VAT"
- **Giảm giá**: Số tiền giảm giá đã nhập
- **Tổng cộng**: Tạm tính + VAT - Giảm giá

#### **Bước 6: Lưu báo giá**
1. Kiểm tra lại thông tin
2. Click **"Tạo Báo Giá"**
3. Hệ thống sẽ:
   - Tạo `ServiceQuotation` mới với:
     - `IsAdditionalQuotation = true`
     - `RelatedToServiceOrderId` = ServiceOrder gốc
   - Cập nhật `AdditionalIssue`:
     - `AdditionalQuotationId` = ID báo giá vừa tạo
     - `Status = "Quoted"`
   - Chuyển hướng đến trang **"Quản Lý Báo Giá"** để xem và gửi cho khách hàng

#### **Bước 7: Gửi báo giá cho khách hàng**
Sau khi tạo báo giá:
1. Vào trang **"Quản Lý Báo Giá"**
2. Tìm báo giá vừa tạo (có thể có badge **"Báo giá bổ sung"**)
3. Click **"Gửi"** để gửi cho khách hàng
4. Hoặc click **"In"** để in báo giá

---

### **2.3.3.1. Duyệt Báo Giá Phát Sinh & Tạo LSC Bổ Sung**

#### **Mục đích:**
Khi khách hàng duyệt báo giá phát sinh, hệ thống tự động tạo LSC Bổ sung và cập nhật trạng thái phát sinh.

#### **Yêu cầu:**
- ✅ Báo giá phát sinh phải ở trạng thái `Pending` hoặc `Draft`
- ✅ Khách hàng phải duyệt báo giá (Approve)

#### **Các bước thực hiện:**

##### **Bước 1: Khách hàng duyệt báo giá**
1. Vào trang **"Quản Lý Báo Giá"**
2. Tìm báo giá phát sinh (có `IsAdditionalQuotation = true`)
3. Click **"Duyệt"** và điền thông tin:
   - **Ghi chú khách hàng**: Ghi chú của khách hàng
   - **Tạo Service Order**: Checkbox để tự động tạo LSC Bổ sung
   - **Ngày dự kiến**: Chọn ngày dự kiến bắt đầu sửa chữa
4. Click **"Xác nhận"**

##### **Bước 2: Hệ thống tự động xử lý**
Khi approve báo giá phát sinh với `CreateServiceOrder = true`:
1. **Tạo ServiceOrder mới** (LSC Bổ sung) với:
   - `ParentServiceOrderId` = ServiceOrder gốc
   - `IsAdditionalOrder = true`
   - `ServiceQuotationId` = ID báo giá phát sinh
   - Copy tất cả items từ báo giá
   - Trạng thái: `Pending`
2. **Cập nhật AdditionalIssue**:
   - `AdditionalServiceOrderId` = ID LSC Bổ sung vừa tạo
   - `Status = "Approved"`
3. **Cập nhật ServiceQuotation**:
   - `ServiceOrderId` = ID LSC Bổ sung vừa tạo
   - `Status = "Approved"`

##### **Bước 3: Quay lại quy trình xuất kho**
Sau khi tạo LSC Bổ sung:
1. **Nếu có vật tư**: Tạo MR cho LSC Bổ sung (xem phần 2.2)
   - Chọn ServiceOrder = LSC Bổ sung vừa tạo
   - Thêm vật tư cần thiết
   - Submit → Approve → Picked → Issued → Delivered
2. **Nếu chỉ có dịch vụ**: Có thể bỏ qua bước MR và tiếp tục với 2.3.1

##### **Bước 4: KTV tiếp tục sửa chữa**
Sau khi vật tư được delivered:
1. KTV có thể tiếp tục làm việc trên LSC Bổ sung
2. Hoặc tiếp tục trên ServiceOrder gốc (nếu hạng mục đã được giải phóng khỏi "OnHold")

---

## 2.3.4. CẬP NHẬT TIẾN ĐỘ & THEO DÕI TIẾN ĐỘ

### **Mục đích:**
KTV cập nhật tiến độ công việc theo từng mốc (ví dụ: Đồng sơn hoàn thành, Thay dầu hoàn thành).

### **Yêu cầu:**
- ✅ KTV phải được phân công cho hạng mục đó
- ✅ Hạng mục phải ở trạng thái `InProgress` hoặc `Pending`

### **Các bước thực hiện:**

#### **Bước 1: Xem tiến độ hiện tại**
1. Vào trang **"Quản Lý Phiếu Sửa Chữa"**
2. Click **"Xem"** của ServiceOrder
3. Click tab **"Chi Tiết Dịch Vụ"**
4. Xem bảng tiến độ:
   - **Trạng Thái**: Badge màu hiển thị trạng thái từng item
   - **Giờ Công Thực Tế**: Số giờ đã làm (tự động tính từ StartTime/EndTime)
   - **Thao Tác**: Các nút điều khiển (Bắt đầu/Dừng/Hoàn thành)

#### **Bước 2: Cập nhật tiến độ**
Tiến độ được cập nhật tự động khi:
- **Bắt đầu làm việc**: `StartTime` được ghi nhận
- **Dừng làm việc**: `ActualHours` được cập nhật (cộng dồn)
- **Hoàn thành**: `CompletedTime` được ghi nhận và `Status = "Completed"`

#### **Bước 3: Xem tổng tiến độ ServiceOrder**

Trong View Order Modal → Tab "Chi Tiết Dịch Vụ", có phần **"Tổng Tiến Độ"** hiển thị:

**📊 Progress Dashboard:**
- **Tiến độ tổng thể**: Progress bar với %
  - % = (Số items Completed / Tổng số items) × 100
- **Số hạng mục đã hoàn thành** / **Tổng số hạng mục**
  - Ví dụ: "3 / 5 hạng mục đã hoàn thành"
- **Trạng thái tổng thể**: Badge màu theo trạng thái JO (Pending, InProgress, Completed, etc.)

**⏱️ Estimated Hours Summary:**
- **Tổng Giờ Công Dự Kiến**: Tổng của tất cả `EstimatedHours` (từ các items)
- **Tổng Giờ Công Thực Tế**: Tổng của tất cả `ActualHours` (tự động tính từ StartTime/EndTime)
- **Giờ Công Còn Lại**: `Tổng Dự Kiến - Tổng Thực Tế` (nếu > 0)
- **Progress Bar**: Hiển thị tỷ lệ % giờ công thực tế / dự kiến
- **⚠️ Cảnh báo**: Nếu `Thực Tế > Dự Kiến × 1.5` → Hiển thị cảnh báo màu đỏ

**Ví dụ hiển thị:**
```
┌─────────────────────────────────────────┐
│ 📊 TỔNG TIẾN ĐỘ                         │
├─────────────────────────────────────────┤
│ Tiến độ: ████████████░░░░░░░░ 60%      │
│ 3 / 5 hạng mục đã hoàn thành            │
│                                         │
│ ⏱️ GIỜ CÔNG                              │
│ Dự kiến: 8.0 giờ                        │
│ Thực tế: 4.5 giờ                        │
│ Còn lại: 3.5 giờ                        │
│ ████████████░░░░░░░░ 56%                │
└─────────────────────────────────────────┘
```

**📋 Chi tiết từng item:**
Bảng "Chi Tiết Dịch Vụ" hiển thị:
- **Trạng Thái**: Badge màu (Pending, InProgress, Completed, OnHold, Cancelled)
- **KTV Được Phân Công**: Tên KTV
- **Giờ Công Dự Kiến**: Số giờ dự kiến
- **Giờ Công Thực Tế**: Số giờ đã làm (tự động tính)
- **Giờ Công Làm Lại**: Số giờ làm lại (nếu QC không đạt)

**Lưu ý:** Tiến độ được cập nhật tự động khi:
- KTV bắt đầu/dừng/hoàn thành công việc
- KTV ghi nhận giờ công làm lại
- Item chuyển trạng thái

---

## 2.4. KIỂM TRA CHẤT LƯỢNG (QC) VÀ BÀN GIAO

### **📍 Vị trí trong hệ thống:**

**Menu Navigation:**
```
Sidebar Menu
└── Quy Trình Nghiệp Vụ
    └── GIAI ĐOẠN 2: Sửa Chữa & Thanh Toán
        ├── 4. Phiếu Sửa Chữa (JO)
        ├── 5. Yêu Cầu Vật Tư (MR)
        └── 6. Kiểm Tra QC ⬅️ **GIAI ĐOẠN 2.4 NẰM ĐÂY**
```

**URL/Route:**
- Controller: `QCManagement`
- Action: `Index`
- URL: `/QCManagement` hoặc `/QCManagement/Index`

**Màn hình chính:**
Trang **"Quản Lý Kiểm Tra Chất Lượng (QC)"** với DataTable hiển thị danh sách JO chờ QC

---

### **🎯 Mục đích:**

Giai đoạn 2.4: Kiểm tra Chất lượng (QC) và Bàn giao là bước cuối cùng trong Giai đoạn 2. Giai đoạn này bắt đầu khi KTV hoàn thành công việc và kết thúc khi JO được chuyển sang Giai đoạn 3 (Quyết toán & Giao xe).

**Workflow:**
```
Tất cả items Completed → Hoàn thành Kỹ thuật → WaitingForQC → 
Bắt đầu QC → QCInProgress → Complete QC (Pass/Fail) → 
Nếu Pass: ReadyToBill → Bàn giao xe
Nếu Fail: InProgress → Làm lại → QC lại
```

---

## 2.4.1. HOÀN THÀNH KỸ THUẬT

### **Mục đích:**
KTV hoàn thành tất cả công việc kỹ thuật và chuyển JO sang trạng thái "Chờ QC" để kiểm tra chất lượng.

### **Yêu cầu:**
- ✅ Tất cả ServiceOrderItems phải ở trạng thái "Completed" hoặc "Cancelled"
- ✅ ServiceOrder status phải là "Completed" hoặc "InProgress"
- ✅ Không có items nào còn đang làm việc (InProgress)

### **Các bước thực hiện:**

#### **Bước 1: Kiểm tra Service Order**
1. Vào trang **"Quản Lý Phiếu Sửa Chữa"**
2. Click **"Xem"** của Service Order
3. Click tab **"Chi Tiết Dịch Vụ"**
4. Kiểm tra tất cả items đã **"Hoàn Thành"** hoặc **"Đã Hủy"** chưa

#### **Bước 2: Click "Hoàn Thành Kỹ Thuật"**
- Khi tất cả items đã Completed/Cancelled, button **"✅ Hoàn Thành Kỹ Thuật"** sẽ xuất hiện ở footer của View Order Modal
- Click button này

#### **Bước 3: Xác nhận**
- Modal xác nhận sẽ hiện ra: **"Bạn có chắc chắn muốn hoàn thành kỹ thuật và chuyển JO sang chờ QC?"**
- Click **"Xác nhận"**

#### **Bước 4: Kết quả**
- ✅ Hệ thống tự động:
  - Tính tổng giờ công thực tế (`TotalActualHours`) từ tất cả items
  - Chuyển ServiceOrder status sang **"WaitingForQC"**
  - Ghi nhận `CompletedDate`
- ✅ Thông báo: **"Đã hoàn thành kỹ thuật. Tổng giờ công thực tế: X.XX giờ"**
- ✅ Modal đóng, DataTable tự động reload
- ✅ JO sẽ xuất hiện trong trang **"Kiểm Tra QC"**

---

## 2.4.2. KIỂM TRA QC

### **Mục đích:**
Tổ trưởng/QC/Quản đốc kiểm tra chất lượng công việc và đánh giá Đạt/Không đạt.

### **Yêu cầu:**
- ✅ ServiceOrder status phải là "WaitingForQC"
- ✅ Chỉ Tổ trưởng/QC/Quản đốc/Manager/Supervisor/Admin/SuperAdmin mới có quyền bắt đầu QC
- ✅ Chỉ có thể có 1 QC record "Pending" tại một thời điểm

### **Các bước thực hiện:**

#### **Bước 1: Vào trang Quản Lý QC**
1. Click menu **"6. Kiểm Tra QC"** trong sidebar (GIAI ĐOẠN 2)
2. Màn hình hiển thị danh sách JO chờ QC với các cột:
   - Số Đơn Hàng
   - Khách Hàng
   - Xe
   - Ngày Hoàn Thành
   - Giờ Công Thực Tế
   - Số Lần QC Không Đạt
   - Thao Tác

#### **Bước 2: Bắt đầu kiểm tra QC**
1. Tìm JO cần kiểm tra trong danh sách
2. Click nút **"▶️ Bắt đầu QC"** (màu xanh)
3. Modal **"Bắt Đầu Kiểm Tra QC"** sẽ hiện ra

#### **Bước 3: Điền thông tin QC Checklist**
Modal hiển thị:
- **Thông tin JO**: Số đơn hàng, Khách hàng, Xe, Giờ công thực tế (read-only)
- **QC Checklist**: Danh sách các hạng mục kiểm tra

**Mặc định có các checklist items:**
- Kiểm tra chất lượng sơn
- Kiểm tra lắp ráp phụ tùng
- Kiểm tra hoạt động động cơ
- Kiểm tra hệ thống điện
- Kiểm tra an toàn

**Thao tác với checklist:**
1. **Thêm hạng mục kiểm tra:**
   - Click **"➕ Thêm Hạng Mục Kiểm Tra"**
   - Điền tên hạng mục (ví dụ: "Kiểm tra hệ thống phanh")
   - Chọn kết quả (Đạt/Không đạt) - Tùy chọn
   - Ghi chú - Tùy chọn
2. **Xóa hạng mục:**
   - Click nút **"🗑️"** ở cuối mỗi dòng

#### **Bước 4: Click "Bắt Đầu QC"**
- Click nút **"▶️ Bắt Đầu QC"** ở footer modal
- Hệ thống sẽ:
  - ✅ Tạo QC record với status "Pending"
  - ✅ Chuyển ServiceOrder status sang **"QCInProgress"**
  - ✅ Ghi nhận người kiểm tra (tự động từ user đăng nhập)
  - ✅ Thông báo: **"Đã bắt đầu kiểm tra QC"**
  - ✅ Modal đóng, DataTable tự động reload

#### **Bước 5: Hoàn thành QC**
1. Sau khi kiểm tra xong, quay lại trang **"Kiểm Tra QC"**
2. Click nút **"✅ Hoàn Thành QC"** (màu xanh dương) hoặc click **"Xem"** → Button trong View Order Modal
3. Modal **"Hoàn Thành Kiểm Tra QC"** sẽ hiện ra với:
   - **Kết quả QC**: Chọn **"✅ Đạt"** hoặc **"❌ Không Đạt"**
   - **Ghi Chú QC**: Nhập ghi chú về kết quả kiểm tra
   - **Cần làm lại**: Checkbox (tự động check nếu chọn "Không Đạt")
   - **Ghi Chú Làm Lại**: Nhập ghi chú về những gì cần làm lại (nếu có)
   - **QC Checklist**: Cập nhật kết quả cho từng hạng mục

#### **Bước 6: Xác nhận kết quả QC**
- Click **"✅ Hoàn Thành QC"**
- Hệ thống sẽ:
  - ✅ Nếu **"Đạt"**:
    - Cập nhật QC record: `QCResult = "Pass"`, `QCCompletedDate = now`
    - Chuyển ServiceOrder status sang **"ReadyToBill"**
    - Thông báo: **"QC đạt. JO sẵn sàng để bàn giao và thanh toán."**
  - ✅ Nếu **"Không Đạt"**:
    - Cập nhật QC record: `QCResult = "Fail"`, `QCCompletedDate = now`
    - Chuyển ServiceOrder status về **"InProgress"**
    - Tăng `QCFailedCount` lên 1
    - Thông báo: **"QC không đạt. KTV cần làm lại theo ghi chú."**

---

## 2.4.3. XỬ LÝ QC KHÔNG ĐẠT

### **Mục đích:**
Khi QC không đạt, KTV cần làm lại và ghi nhận giờ công làm lại.

### **Yêu cầu:**
- ✅ QC result phải là "Fail"
- ✅ ServiceOrder status phải là "InProgress"

### **Các bước thực hiện:**

#### **Bước 1: KTV làm lại**
1. KTV xem ghi chú QC trong View Order Modal → Tab "QC"
2. Làm lại các hạng mục không đạt theo yêu cầu
3. Cập nhật tiến độ khi làm lại (Start Work → Complete Item)

#### **Bước 2: Ghi nhận giờ công làm lại**

**Cách 1: Hệ thống tự động tính (mặc định):**
- Khi KTV làm lại và hoàn thành item, hệ thống tự động tính `ReworkHours` từ `ActualHours` mới
- Giờ công làm lại = Giờ công thực tế mới - Giờ công thực tế cũ

**Cách 2: Ghi nhận thủ công:**

1. **Vào View Order Modal:**
   - Click **"Xem"** của Service Order có QC không đạt
   - Click tab **"Chi Tiết Dịch Vụ"**
   - Tìm item cần ghi nhận giờ công làm lại

2. **Click nút "Ghi Nhận Làm Lại":**
   - Nút này chỉ hiển thị khi:
     - QC đã Fail (`QCResult = "Fail"`)
     - ServiceOrder status = `InProgress`
     - Item đã Completed lại sau khi QC Fail
   - Click nút **"🔄 Ghi Nhận Làm Lại"** (màu vàng) ở footer modal hoặc trong bảng items

3. **Điền thông tin:**
   - Modal **"Ghi Nhận Giờ Công Làm Lại"** hiện ra
   - **Giờ Công Làm Lại**: Nhập số giờ đã làm lại (ví dụ: 0.5, 1.0, 2.5)
   - **Ghi Chú**: Ghi chú về công việc làm lại (tùy chọn)

4. **Xác nhận:**
   - Click **"💾 Lưu"**
   - Hệ thống sẽ:
     - ✅ Cập nhật `ReworkHours` cho item đó
     - ✅ Hiển thị trong bảng "Chi Tiết Dịch Vụ"
     - ✅ Cập nhật tổng giờ công làm lại trong Estimated Hours Summary

**Hiển thị trong View Order Modal:**
- Trong bảng "Chi Tiết Dịch Vụ", có cột **"Giờ Công Làm Lại"**
- Trong Estimated Hours Summary, có thông tin **"Tổng Giờ Công Làm Lại"**
- Cảnh báo nếu tổng giờ công thực tế > dự kiến × 1.5

**Lưu ý:**
- Giờ công làm lại không được tính vào `ActualHours` chính
- Chỉ để theo dõi và báo cáo
- Có thể ghi nhận nhiều lần cho cùng một item (cộng dồn)

#### **Bước 3: QC lại**
- Sau khi làm lại xong, chuyển lại sang **"WaitingForQC"** (Complete Technical)
- Thực hiện lại quy trình QC (2.4.2)

---

## 2.4.4. BÀN GIAO XE

### **Mục đích:**
Sau khi QC đạt, Cố vấn Dịch vụ bàn giao xe cho khách hàng và chuyển JO sang "ReadyToBill" để thanh toán.

### **Yêu cầu:**
- ✅ QC result phải là "Pass"
- ✅ ServiceOrder status phải là "ReadyToBill"
- ✅ Chỉ Cố vấn Dịch vụ/Quản đốc/Manager/Advisor/Admin/SuperAdmin mới có quyền bàn giao

### **Các bước thực hiện:**

#### **Bước 1: Xem chi tiết JO**
1. Vào trang **"Quản Lý Phiếu Sửa Chữa"**
2. Click **"Xem"** của Service Order có QC đạt
3. Kiểm tra tab **"QC"** để xác nhận QC đã đạt

#### **Bước 2: Click "Bàn Giao Xe"**
- Button **"🤝 Bàn Giao Xe"** sẽ xuất hiện ở footer của View Order Modal (chỉ khi QC Pass và status = ReadyToBill)
- Click button này

#### **Bước 3: Điền thông tin bàn giao**
Modal **"Bàn Giao Xe"** hiển thị:
- **Thông tin JO**: Số đơn hàng, Khách hàng, Xe, Kết quả QC (read-only)
- **Ngày Bàn Giao**: Mặc định là ngày hiện tại (có thể chỉnh sửa)
- **Khu Vực Bàn Giao**: Nhập khu vực (ví dụ: "Khu vực tiếp đón", "Xưởng số 1")
- **Ghi Chú**: Ghi chú về bàn giao (tùy chọn)

#### **Bước 4: Xác nhận bàn giao**
- Click **"🤝 Xác Nhận Bàn Giao"**
- Hệ thống sẽ:
  - ✅ Cập nhật `HandoverDate` và `HandoverLocation`
  - ✅ ServiceOrder status vẫn là **"ReadyToBill"** (sẵn sàng thanh toán)
  - ✅ Thông báo: **"Đã bàn giao xe thành công"**
  - ✅ Modal đóng, DataTable tự động reload

#### **Bước 5: Thanh toán**
- Sau khi bàn giao, JO sẵn sàng để thanh toán (Giai đoạn 3)
- Có thể vào **"Quản Lý Thanh Toán"** để xử lý thanh toán

---

### **⚠️ Lưu ý quan trọng:**

1. **Workflow đúng thứ tự:**
   - ✅ Phải hoàn thành tất cả items trước khi Complete Technical
   - ✅ Phải Complete Technical trước khi Start QC
   - ✅ Phải Complete QC trước khi Handover
   - ✅ Phải QC Pass trước khi Handover

2. **Authorization:**
   - ✅ Complete Technical: KTV tự hoàn thành (không có restriction)
   - ✅ Start/Complete QC: Chỉ Tổ trưởng/QC/Quản đốc/Manager/Supervisor/Admin/SuperAdmin
   - ✅ Handover: Chỉ Cố vấn Dịch vụ/Quản đốc/Manager/Advisor/Admin/SuperAdmin

3. **QC Checklist:**
   - ✅ Có thể thêm/xóa/sửa checklist items
   - ✅ Mỗi item có thể có kết quả Pass/Fail
   - ✅ Checklist được lưu lại để audit

4. **QC Fail:**
   - ✅ Khi QC Fail, JO chuyển về "InProgress"
   - ✅ KTV cần làm lại và Complete Technical lại
   - ✅ Có thể QC lại nhiều lần (QCFailedCount tăng dần)

---

### **💡 Ví dụ thực tế:**

**Scenario: Hoàn thành QC và bàn giao xe**

**Tình huống:**
- JO-2024-001: Khách hàng Nguyễn Văn A, xe 30A-12345
- Tất cả items đã Completed:
  - Thay dầu máy ✅
  - Thay bộ lọc dầu ✅
  - Công sửa chữa ✅

**Các bước:**

1. **Complete Technical:**
   - Xem JO → Click "✅ Hoàn Thành Kỹ Thuật"
   - Xác nhận → Status chuyển sang "WaitingForQC"
   - Tổng giờ công thực tế: 2.5 giờ

2. **Start QC:**
   - Vào "Kiểm Tra QC" → Click "▶️ Bắt Đầu QC" cho JO-2024-001
   - Điền checklist:
     - Kiểm tra chất lượng sơn ✅
     - Kiểm tra lắp ráp phụ tùng ✅
     - Kiểm tra hoạt động động cơ ✅
   - Click "▶️ Bắt Đầu QC" → Status chuyển sang "QCInProgress"

3. **Complete QC:**
   - Sau khi kiểm tra xong → Click "✅ Hoàn Thành QC"
   - Chọn "✅ Đạt"
   - Ghi chú: "Chất lượng tốt, khách hàng hài lòng"
   - Click "✅ Hoàn Thành QC" → Status chuyển sang "ReadyToBill"

4. **Handover:**
   - Xem JO → Click "🤝 Bàn Giao Xe"
   - Ngày bàn giao: 18/11/2024 14:00
   - Khu vực: "Khu vực tiếp đón"
   - Ghi chú: "Khách hàng đã nhận xe và hài lòng"
   - Click "🤝 Xác Nhận Bàn Giao" → Hoàn thành!

**Kết quả:**
- ✅ JO đã sẵn sàng thanh toán (ReadyToBill)
- ✅ QC record đã được lưu với kết quả "Pass"
- ✅ Thông tin bàn giao đã được ghi nhận

---

## 2.2. YÊU CẦU VẬT TƯ (MATERIAL REQUEST - MR)

### **📍 Vị trí trong hệ thống:**

**Menu Navigation:**
```
Sidebar Menu
└── Quy Trình Nghiệp Vụ
    └── GIAI ĐOẠN 2: Sửa Chữa & Thanh Toán
        ├── 4. Phiếu Sửa Chữa (JO)
        └── 5. Yêu Cầu Vật Tư (MR) ⬅️ **GIAI ĐOẠN 2.2 NẰM ĐÂY**
```

**URL/Route:**
- Controller: `MaterialRequestManagement`
- Action: `Index`
- URL: `/MaterialRequestManagement` hoặc `/MaterialRequestManagement/Index`

**Màn hình chính:**
Trang **"Quản Lý Yêu Cầu Vật Tư"** với DataTable hiển thị danh sách Material Request (MR)

---

### **🎯 Mục đích:**

Yêu Cầu Vật Tư (MR) được sử dụng để:
- 📦 Yêu cầu phụ tùng từ kho cho Phiếu Sửa Chữa (JO)
- ✅ Quản lý quy trình phê duyệt và xuất kho vật tư
- 📊 Theo dõi trạng thái yêu cầu vật tư từ khi tạo đến khi xuất kho

**Workflow:**
```
Draft → PendingApproval → Approved → Picked → Issued → Delivered
   ↑            ↑              ↑         ↑        ↑
   │       Submit MR      Approve    Pick   Issue to JO
   │
Tạo MR
```

---

### **📋 TẠO PHIẾU YÊU CẦU VẬT TƯ MỚI**

#### **Bước 1: Vào trang Quản Lý Yêu Cầu Vật Tư**

1. Đăng nhập vào hệ thống
2. Click menu **"Quy Trình Nghiệp Vụ"** ở sidebar bên trái
3. Click **"5. Yêu Cầu Vật Tư (MR)"** (trong GIAI ĐOẠN 2)
4. Màn hình hiển thị danh sách các MR với các cột:
   - MR #
   - Service Order (JO)
   - Trạng thái
   - Thao Tác

#### **Bước 2: Click nút "Tạo MR"**

- Ở góc phải trên màn hình, click nút **"➕ Tạo MR"**
- Modal **"Tạo Phiếu Yêu Cầu Vật Tư"** sẽ hiện ra

#### **Bước 3: Chọn Phiếu Sửa Chữa (JO)**

```
┌─────────────────────────────────────────────────────────┐
│        TẠO PHIẾU YÊU CẦU VẬT TƯ                         │
├─────────────────────────────────────────────────────────┤
│ Phiếu Sửa Chữa (JO) *                                    │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [JO-2024-001 - Nguyễn Văn A (30A-12345) ▼]        │ │
│ └─────────────────────────────────────────────────────┘ │
│ ℹ️ Chọn phiếu sửa chữa cần yêu cầu vật tư              │
│                                                         │
```

**Lưu ý:**
- ✅ Dropdown chỉ hiển thị các Phiếu Sửa Chữa ở trạng thái:
  - **"Chờ Xử Lý" (Pending)**
  - **"Chờ Phân Công" (PendingAssignment)**
  - **"Chờ Vật Tư" (WaitingForParts)**
  - **"Sẵn Sàng Làm" (ReadyToWork)**
  - **"Đang Sửa Chữa" (InProgress)**
- ✅ Format hiển thị: **"Số JO - Tên KH (Biển số xe)"**
- ✅ Có thể tìm kiếm trong dropdown bằng cách gõ số JO hoặc tên khách hàng

#### **Bước 4: Thêm Vật Tư**

1. Click nút **"➕ Thêm vật tư"** ở dưới bảng
2. Một dòng mới sẽ được thêm vào bảng với 2 cột:
   - **Phụ tùng**: Input với typeahead để tìm kiếm phụ tùng
   - **Số lượng**: Input số lượng (mặc định = 1)
   - **Xóa**: Nút để xóa dòng

**Thao tác thêm phụ tùng:**
```
┌─────────────────────────────────────────────────────────┐
│ Bảng Vật Tư:                                            │
├──────────────┬──────────────┬──────────────────────────┤
│ Phụ tùng     │ Số lượng     │                           │
├──────────────┼──────────────┼──────────────────────────┤
│ [Bộ lọc gió ▼]│ [1        ] │ [🗑️ Xóa]                 │
│              │              │                           │
│ ℹ️ Gõ tên phụ tùng để tìm kiếm                          │
│ ✅ Chọn từ danh sách gợi ý                             │
└──────────────┴──────────────┴──────────────────────────┘
```

**Hướng dẫn:**
1. Click vào ô **"Phụ tùng"** trong dòng mới
2. Gõ tên phụ tùng (ví dụ: "lọc gió", "dầu máy", "bugi")
3. Danh sách gợi ý sẽ hiện ra → Click chọn phụ tùng phù hợp
4. Nhập **Số lượng** cần yêu cầu (mặc định = 1)
5. Nếu muốn xóa dòng, click nút **"🗑️ Xóa"** ở cột cuối

**Lặp lại** để thêm nhiều phụ tùng khác nhau.

#### **Bước 5: Ghi chú (Tùy chọn)**

- Nhập ghi chú về yêu cầu vật tư (nếu cần)
- Ví dụ: "Cần gấp để hoàn thành JO", "Phụ tùng thay thế"

#### **Bước 6: Click "Tạo MR"**

- Click nút **"Tạo MR"** ở footer modal
- Hệ thống sẽ:
  - ✅ Validate dữ liệu (phải có JO và ít nhất 1 vật tư)
  - ✅ Tạo MR với trạng thái **"Draft" (Bản nháp)**
  - ✅ Tự động tạo số MR (MR-YYYY-MMDD-XXX)
  - ✅ Hiển thị thông báo: **"Tạo MR thành công"**
  - ✅ Modal đóng, DataTable tự động reload

**Kết quả:**
- ✅ MR mới xuất hiện trong danh sách với trạng thái **"Bản nháp"**
- ✅ Có thể xem chi tiết MR bằng nút **"👁️ Xem"**

---

### **📊 CÁC TRẠNG THÁI CỦA MATERIAL REQUEST**

1. **Bản nháp (Draft)**: MR vừa được tạo, chưa submit
2. **Chờ Phê Duyệt (PendingApproval)**: MR đã submit, chờ Quản đốc/Thủ kho phê duyệt
3. **Đã Phê Duyệt (Approved)**: MR được phê duyệt, sẵn sàng để pick vật tư
4. **Đã Lấy (Picked)**: Vật tư đã được lấy từ kho
5. **Đã Xuất (Issued)**: Vật tư đã được xuất cho Phiếu Sửa Chữa
6. **Đã Giao (Delivered)**: Vật tư đã được giao đến nơi sửa chữa
7. **Đã Từ Chối (Rejected)**: MR bị từ chối bởi người phê duyệt
8. **Đã Hủy (Cancelled)**: MR bị hủy

---

### **📊 QUẢN LÝ WORKFLOW MR**

Sau khi tạo MR, các bước tiếp theo để hoàn thành workflow:

#### **Bước 1: Submit MR (Gửi để phê duyệt)**

**Mục đích:** Gửi MR đã tạo để Quản đốc/Thủ kho phê duyệt.

**Yêu cầu:** MR phải ở trạng thái **"Bản nháp" (Draft)**

**Các bước thực hiện:**

1. **Vào trang Quản Lý Yêu Cầu Vật Tư**
   - Click menu **"5. Yêu Cầu Vật Tư (MR)"** trong sidebar

2. **Tìm MR cần submit**
   - Trong danh sách MR, tìm MR có trạng thái **"Bản nháp"**
   - Cột "Trạng thái" hiển thị badge màu xám **"Bản nháp"**

3. **Click nút Submit**
   - Trong cột "Thao Tác", click nút **"📤 Submit"** (màu xanh dương)
   - Tooltip: **"Gửi để phê duyệt"**

4. **Xác nhận**
   - Popup SweetAlert hiện: **"Gửi MR để phê duyệt?"**
   - Click **"Xác nhận"**

5. **Kết quả**
   - ✅ MR chuyển sang trạng thái **"Chờ Phê Duyệt" (PendingApproval)**
   - ✅ Badge chuyển sang màu vàng **"Chờ Phê Duyệt"**
   - ✅ Thông báo: **"Đã gửi MR để phê duyệt"**
   - ✅ DataTable tự động reload

**Lưu ý:** Sau khi submit, không thể chỉnh sửa MR nữa (chỉ có thể xem)

---

#### **Bước 2: Approve/Reject MR (Phê duyệt/Từ chối)**

**Yêu cầu:** Chỉ **Quản đốc/Thủ kho/Manager/Supervisor/Admin/SuperAdmin** có quyền phê duyệt

**2.1. Phê duyệt MR (Approve):**

1. **Tìm MR cần approve**
   - Trong danh sách MR, tìm MR có trạng thái **"Chờ Phê Duyệt"**
   - Badge màu vàng: **"Chờ Phê Duyệt"**

2. **Click nút Approve**
   - Trong cột "Thao Tác", click nút **"✅ Approve"** (màu xanh lá)
   - Tooltip: **"Phê duyệt MR"**

3. **Điền thông tin (tùy chọn)**
   - Modal **"Phê duyệt MR"** hiện ra:
     - **Ghi chú phê duyệt**: Nhập ghi chú (tùy chọn)
     - Ví dụ: "Đã kiểm tra tồn kho, đủ vật tư"

4. **Xác nhận**
   - Click **"✅ Phê duyệt"**
   - Popup xác nhận: **"Phê duyệt MR này?"**
   - Click **"Xác nhận"**

5. **Kết quả**
   - ✅ MR chuyển sang trạng thái **"Đã Phê Duyệt" (Approved)**
   - ✅ Badge chuyển sang màu xanh lá **"Đã Phê Duyệt"**
   - ✅ JO liên quan tự động chuyển sang **"WaitingForParts"** (nếu có vật tư)
   - ✅ Thông báo: **"Đã phê duyệt MR thành công"**
   - ✅ DataTable tự động reload

**2.2. Từ chối MR (Reject):**

1. **Click nút Reject**
   - Trong cột "Thao Tác", click nút **"❌ Reject"** (màu đỏ)
   - Tooltip: **"Từ chối MR"**

2. **Điền lý do từ chối (bắt buộc)**
   - Modal **"Từ chối MR"** hiện ra:
     - **Lý do từ chối**: Nhập lý do (bắt buộc)
     - Ví dụ: "Không đủ tồn kho", "Vật tư không phù hợp"

3. **Xác nhận**
   - Click **"❌ Từ chối"**
   - Popup xác nhận: **"Từ chối MR này?"**
   - Click **"Xác nhận"**

4. **Kết quả**
   - ✅ MR chuyển sang trạng thái **"Đã Từ Chối" (Rejected)**
   - ✅ Badge chuyển sang màu đỏ **"Đã Từ Chối"**
   - ✅ Người tạo MR sẽ nhận thông báo
   - ✅ Thông báo: **"Đã từ chối MR"**
   - ✅ DataTable tự động reload

**Lưu ý:** Sau khi Reject, có thể tạo MR mới hoặc chỉnh sửa MR cũ (nếu cần)

---

#### **Bước 3: Pick (Lấy vật tư từ kho)**

**Yêu cầu:** **Thủ kho** hoặc người có quyền xuất kho

**Mục đích:** Lấy vật tư từ kho để chuẩn bị xuất cho JO

**Các bước thực hiện:**

1. **Tìm MR cần pick**
   - Trong danh sách MR, tìm MR có trạng thái **"Đã Phê Duyệt"**
   - Badge màu xanh lá: **"Đã Phê Duyệt"**

2. **Click nút Pick**
   - Trong cột "Thao Tác", click nút **"📦 Pick"** (màu vàng)
   - Tooltip: **"Lấy vật tư từ kho"**

3. **Xác nhận**
   - Popup SweetAlert: **"Lấy vật tư từ kho?"**
   - Click **"Xác nhận"**

4. **Kết quả**
   - ✅ MR chuyển sang trạng thái **"Đã Lấy" (Picked)**
   - ✅ Badge chuyển sang màu vàng cam **"Đã Lấy"**
   - ✅ Vật tư được đánh dấu là đã lấy từ kho (chưa giảm tồn kho)
   - ✅ Thông báo: **"Đã lấy vật tư từ kho"**
   - ✅ DataTable tự động reload

**Lưu ý:** Sau khi Pick, vật tư được chuẩn bị nhưng chưa được xuất kho (tồn kho chưa giảm)

---

#### **Bước 4: Issue (Xuất vật tư cho JO)**

**Yêu cầu:** **Thủ kho** hoặc người có quyền xuất kho

**Mục đích:** Xuất vật tư cho JO và giảm tồn kho

**Các bước thực hiện:**

1. **Tìm MR cần issue**
   - Trong danh sách MR, tìm MR có trạng thái **"Đã Lấy"**
   - Badge màu vàng cam: **"Đã Lấy"**

2. **Click nút Issue**
   - Trong cột "Thao Tác", click nút **"📤 Issue"** (màu xanh lá)
   - Tooltip: **"Xuất vật tư cho JO"**

3. **Xác nhận**
   - Popup SweetAlert: **"Xuất vật tư cho JO này?"**
   - Click **"Xác nhận"**

4. **Kết quả**
   - ✅ MR chuyển sang trạng thái **"Đã Xuất" (Issued)**
   - ✅ Badge chuyển sang màu xanh dương **"Đã Xuất"**
   - ✅ **Số lượng tồn kho của vật tư được giảm đi** (theo số lượng trong MR)
   - ✅ Vật tư được gán cho JO liên quan
   - ✅ Thông báo: **"Đã xuất vật tư cho JO"**
   - ✅ DataTable tự động reload

**Lưu ý:** Sau khi Issue, tồn kho chính thức giảm và vật tư đã được gán cho JO

---

#### **Bước 5: Deliver (Giao vật tư đến nơi sửa chữa)**

**Mục đích:** Xác nhận vật tư đã được giao đến nơi sửa chữa và hoàn thành workflow MR

**Các bước thực hiện:**

1. **Tìm MR cần deliver**
   - Trong danh sách MR, tìm MR có trạng thái **"Đã Xuất"**
   - Badge màu xanh dương: **"Đã Xuất"**

2. **Click nút Deliver**
   - Trong cột "Thao Tác", click nút **"🚚 Deliver"** (màu xanh dương)
   - Tooltip: **"Giao vật tư đến nơi sửa chữa"**

3. **Điền thông tin (tùy chọn)**
   - Modal **"Giao vật tư"** hiện ra:
     - **Ghi chú giao hàng**: Nhập ghi chú (tùy chọn)
     - Ví dụ: "Đã giao đến xưởng số 1", "KTV đã nhận vật tư"

4. **Xác nhận**
   - Click **"🚚 Xác nhận giao hàng"**
   - Popup xác nhận: **"Xác nhận đã giao vật tư?"**
   - Click **"Xác nhận"**

5. **Kết quả**
   - ✅ MR chuyển sang trạng thái **"Đã Giao" (Delivered)**
   - ✅ Badge chuyển sang màu xanh lá đậm **"Đã Giao"**
   - ✅ **JO liên quan có thể chuyển sang "ReadyToWork" hoặc "InProgress"** (nếu tất cả MR đã Delivered)
   - ✅ Workflow MR hoàn thành
   - ✅ Thông báo: **"Đã giao vật tư thành công"**
   - ✅ DataTable tự động reload

**Lưu ý:** Sau khi Deliver, workflow MR hoàn thành và JO có thể tiếp tục quy trình sửa chữa

---

### **⚠️ Lưu ý quan trọng:**

1. **JO phải tồn tại và ở trạng thái phù hợp:**
   - ✅ Không thể tạo MR cho JO đã hoàn thành (Completed)
   - ✅ Không thể tạo MR cho JO đã hủy (Cancelled)

2. **Validation:**
   - ✅ Phải chọn **Phiếu Sửa Chữa (JO)**
   - ✅ Phải thêm **ít nhất 1 vật tư**
   - ✅ Số lượng phải > 0

3. **Phụ tùng:**
   - ✅ Chỉ có thể chọn phụ tùng có trong hệ thống
   - ✅ Typeahead giúp tìm kiếm nhanh phụ tùng

4. **Số MR:**
   - ✅ Tự động tạo theo format: **MR-YYYY-MMDD-XXX** (ví dụ: MR-2024-0115-001)

5. **Workflow MR:**
   - ✅ Phải tuân thủ đúng thứ tự: Draft → Submit → Approve → Pick → Issue → Deliver
   - ✅ Không thể bỏ qua hoặc đảo ngược các bước
   - ✅ Chỉ có thể Approve/Reject khi MR ở trạng thái "PendingApproval"
   - ✅ Chỉ có thể Pick khi MR ở trạng thái "Approved"
   - ✅ Chỉ có thể Issue khi MR ở trạng thái "Picked"
   - ✅ Chỉ có thể Deliver khi MR ở trạng thái "Issued"

6. **Tồn kho:**
   - ✅ Tồn kho chỉ giảm khi Issue (không giảm khi Pick)
   - ✅ Kiểm tra tồn kho trước khi Approve MR
   - ✅ Nếu không đủ tồn kho, có thể Reject MR và nhập kho thêm

---

### **💡 Ví dụ thực tế:**

**Scenario: Tạo MR cho JO cần thay dầu máy**

**Tình huống:**
- JO-2024-001: Khách hàng Nguyễn Văn A, xe 30A-12345
- Cần vật tư: Dầu máy 5W-30 (2 lít), Bộ lọc dầu (1 cái)

**Các bước:**

1. Vào **"Yêu Cầu Vật Tư (MR)"** → Click **"➕ Tạo MR"**
2. Chọn **"JO-2024-001 - Nguyễn Văn A (30A-12345)"** từ dropdown
3. Click **"➕ Thêm vật tư"** → Gõ "dầu máy" → Chọn "Dầu máy 5W-30" → Nhập số lượng = 2
4. Click **"➕ Thêm vật tư"** lần nữa → Gõ "lọc dầu" → Chọn "Bộ lọc dầu" → Nhập số lượng = 1
5. Ghi chú: "Thay dầu máy định kỳ"
6. Click **"Tạo MR"** → Thành công!

**Kết quả:**
- ✅ MR-2024-0115-001 được tạo với trạng thái "Bản nháp"
- ✅ Sau đó có thể **Submit** để gửi phê duyệt

---

### **❓ Xử lý sự cố:**

**Dropdown "Phiếu Sửa Chữa" không có dữ liệu:**
- ✅ Kiểm tra xem có JO nào ở trạng thái phù hợp không (Pending, PendingAssignment, WaitingForParts, ReadyToWork, InProgress)
- ✅ Kiểm tra console để xem có lỗi API không
- ✅ Thử refresh trang (F5)

**Không tìm thấy phụ tùng trong typeahead:**
- ✅ Kiểm tra phụ tùng có tồn tại trong hệ thống không (vào "Quản Lý Phụ Tùng")
- ✅ Thử gõ tên khác hoặc mã phụ tùng
- ✅ Kiểm tra network console xem endpoint `/StockManagement/SearchParts` có hoạt động không

**Lỗi khi tạo MR:**
- ✅ Kiểm tra đã chọn JO chưa?
- ✅ Kiểm tra đã thêm ít nhất 1 vật tư chưa?
- ✅ Kiểm tra số lượng > 0 chưa?
- ✅ Kiểm tra console để xem lỗi chi tiết từ API

---

## 📚 TỔNG KẾT GIAI ĐOẠN 2

### **✅ Checklist Hoàn Thành Giai Đoạn 2:**

#### **2.1: Lập Kế Hoạch & Phân Công**
- [ ] JO đã được chuyển sang "Chờ Phân Công" (PendingAssignment)
- [ ] Tất cả items đã được phân công KTV
- [ ] Tất cả items đã có giờ công dự kiến
- [ ] JO đã tự động chuyển sang "Sẵn Sàng Làm" (ReadyToWork)
- [ ] Quotation đã bị khóa (không thể chỉnh sửa)

#### **2.2: Yêu Cầu Vật Tư (MR)**
- [ ] MR đã được tạo cho JO (nếu cần vật tư)
- [ ] MR đã được Submit để phê duyệt
- [ ] MR đã được Approved
- [ ] Vật tư đã được Picked từ kho
- [ ] Vật tư đã được Issued cho JO
- [ ] Vật tư đã được Delivered đến nơi sửa chữa
- [ ] JO đã chuyển sang "ReadyToWork" hoặc "InProgress"

#### **2.3: Quản Lý Tiến Độ & Phát Sinh**
- [ ] KTV đã bắt đầu làm việc trên các items
- [ ] Giờ công thực tế đã được ghi nhận tự động
- [ ] Tất cả items đã được hoàn thành (Completed)
- [ ] Nếu có phát sinh: Đã báo cáo, tạo báo giá, khách hàng duyệt (nếu có)
- [ ] Tiến độ đã được cập nhật đầy đủ

#### **2.4: Kiểm Tra Chất Lượng (QC) và Bàn Giao**
- [ ] KTV đã click "Hoàn Thành Kỹ Thuật"
- [ ] JO đã chuyển sang "WaitingForQC"
- [ ] QC đã được bắt đầu (Start QC)
- [ ] QC đã được hoàn thành với kết quả "Đạt" hoặc "Không Đạt"
- [ ] Nếu QC không đạt: KTV đã làm lại và QC lại
- [ ] Sau khi QC đạt: Đã bàn giao xe cho khách hàng
- [ ] JO đã chuyển sang "ReadyToBill" (sẵn sàng thanh toán)

---

### **💡 Best Practices:**

#### **1. Phân Công KTV (2.1.2):**
- ✅ **Kiểm tra workload trước khi phân công:**
  - Xem workload của KTV trong dropdown để biết capacity
  - Tránh phân công quá tải (không nên > 80% capacity)
  - Phân công người có chuyên môn phù hợp với từng hạng mục
- ✅ **Nhập giờ công dự kiến chính xác:**
  - Dựa trên kinh nghiệm và độ phức tạp của công việc
  - Nên có buffer 10-20% để dự phòng
  - Ghi chú rõ ràng nếu có yêu cầu đặc biệt
- ✅ **Phân công hàng loạt khi có thể:**
  - Sử dụng tính năng "Phân Công Hàng Loạt" để tiết kiệm thời gian
  - Đảm bảo tất cả items đã được phân công trước khi đóng modal

#### **2. Yêu Cầu Vật Tư (2.2):**
- ✅ **Tạo MR sớm:**
  - Tạo MR ngay sau khi phân công KTV
  - Đảm bảo vật tư sẵn sàng trước khi KTV bắt đầu làm việc
- ✅ **Kiểm tra tồn kho:**
  - Kiểm tra số lượng tồn kho trước khi tạo MR
  - Nếu không đủ: Liên hệ bộ phận mua hàng để nhập kho
- ✅ **Ghi chú rõ ràng:**
  - Ghi chú về lý do yêu cầu vật tư
  - Ghi chú về mức độ ưu tiên (nếu cần gấp)

#### **3. Quản Lý Tiến Độ (2.3):**
- ✅ **Ghi nhận thời gian chính xác:**
  - Bắt đầu làm việc ngay khi bắt đầu công việc
  - Dừng làm việc khi tạm dừng (không tính thời gian chờ)
  - Hoàn thành ngay khi công việc xong
- ✅ **Báo cáo phát sinh kịp thời:**
  - Báo cáo ngay khi phát hiện vấn đề
  - Upload hình ảnh rõ ràng để CVDV hiểu vấn đề
  - Mô tả chi tiết để CVDV có thể tạo báo giá chính xác
- ✅ **Theo dõi tiến độ thường xuyên:**
  - Xem tổng tiến độ trong View Order Modal
  - Kiểm tra giờ công thực tế vs dự kiến để điều chỉnh kịp thời

#### **4. Kiểm Tra QC (2.4):**
- ✅ **Hoàn thành kỹ thuật đầy đủ:**
  - Đảm bảo tất cả items đã Completed hoặc Cancelled
  - Kiểm tra lại công việc trước khi Complete Technical
- ✅ **Kiểm tra QC kỹ lưỡng:**
  - Kiểm tra từng hạng mục trong checklist
  - Ghi chú rõ ràng nếu có vấn đề
  - Không vội vàng khi đánh giá "Đạt"
- ✅ **Xử lý QC không đạt:**
  - Đọc kỹ ghi chú QC để hiểu vấn đề
  - Làm lại đúng theo yêu cầu
  - Ghi nhận giờ công làm lại để báo cáo

---

### **🔧 Troubleshooting & Common Issues:**

#### **1. Vấn đề về Phân Công (2.1):**

**Vấn đề: "Không thể chuyển JO sang Chờ Phân Công"**
- ✅ **Nguyên nhân:** JO không ở trạng thái "Pending"
- ✅ **Giải pháp:** Kiểm tra trạng thái JO trong View Order Modal
- ✅ **Phòng ngừa:** Chỉ thực hiện khi JO ở trạng thái "Pending"

**Vấn đề: "Nút Phân Công không hiển thị"**
- ✅ **Nguyên nhân:** Không có quyền phân công (không phải Quản đốc/Tổ trưởng)
- ✅ **Giải pháp:** Liên hệ Admin để cấp quyền hoặc nhờ Quản đốc phân công
- ✅ **Phòng ngừa:** Kiểm tra role và position trong hệ thống

**Vấn đề: "JO không tự động chuyển sang ReadyToWork sau khi phân công"**
- ✅ **Nguyên nhân:** Còn items chưa được phân công
- ✅ **Giải pháp:** Kiểm tra lại tất cả items trong modal phân công
- ✅ **Phòng ngừa:** Sử dụng "Lưu Tất Cả Phân Công" để đảm bảo tất cả được lưu

#### **2. Vấn đề về MR (2.2):**

**Vấn đề: "Dropdown JO không có dữ liệu"**
- ✅ **Nguyên nhân:** Không có JO nào ở trạng thái phù hợp
- ✅ **Giải pháp:** Kiểm tra danh sách JO trong "Quản Lý Phiếu Sửa Chữa"
- ✅ **Phòng ngừa:** Tạo JO trước khi tạo MR

**Vấn đề: "MR không được Approve"**
- ✅ **Nguyên nhân:** Người phê duyệt chưa xử lý hoặc từ chối
- ✅ **Giải pháp:** Liên hệ Quản đốc/Thủ kho để phê duyệt
- ✅ **Phòng ngừa:** Giải thích rõ lý do trong ghi chú MR

**Vấn đề: "Vật tư không đủ tồn kho"**
- ✅ **Nguyên nhân:** Số lượng yêu cầu > số lượng tồn kho
- ✅ **Giải pháp:** Giảm số lượng yêu cầu hoặc nhập kho thêm
- ✅ **Phòng ngừa:** Kiểm tra tồn kho trước khi tạo MR

#### **3. Vấn đề về Tiến Độ (2.3):**

**Vấn đề: "Không thể bắt đầu làm việc"**
- ✅ **Nguyên nhân:** KTV chưa được phân công hoặc item không ở trạng thái "Pending"
- ✅ **Giải pháp:** Kiểm tra xem KTV đã được phân công chưa
- ✅ **Phòng ngừa:** Đảm bảo phân công KTV trước khi bắt đầu làm việc

**Vấn đề: "Giờ công thực tế không chính xác"**
- ✅ **Nguyên nhân:** Quên dừng làm việc khi tạm dừng hoặc quên bắt đầu lại khi tiếp tục
- ✅ **Giải pháp:** Kiểm tra StartTime và EndTime trong View Order Modal
- ✅ **Phòng ngừa:** Luôn nhớ dừng khi tạm dừng và bắt đầu lại khi tiếp tục

**Vấn đề: "Item không thể hoàn thành"**
- ✅ **Nguyên nhân:** Item đang ở trạng thái "OnHold" do phát sinh
- ✅ **Giải pháp:** Giải quyết phát sinh trước (khách hàng duyệt hoặc từ chối)
- ✅ **Phòng ngừa:** Kiểm tra trạng thái item trước khi hoàn thành

#### **4. Vấn đề về QC (2.4):**

**Vấn đề: "Không thể Complete Technical"**
- ✅ **Nguyên nhân:** Còn items chưa Completed hoặc đang InProgress
- ✅ **Giải pháp:** Hoàn thành tất cả items trước khi Complete Technical
- ✅ **Phòng ngừa:** Kiểm tra kỹ trạng thái tất cả items

**Vấn đề: "QC không đạt nhiều lần"**
- ✅ **Nguyên nhân:** KTV không làm lại đúng theo yêu cầu
- ✅ **Giải pháp:** Đọc kỹ ghi chú QC và làm lại đúng theo yêu cầu
- ✅ **Phòng ngừa:** Liên hệ với QC để hiểu rõ yêu cầu trước khi làm lại

**Vấn đề: "Không thể bàn giao xe"**
- ✅ **Nguyên nhân:** QC chưa Pass hoặc chưa Complete QC
- ✅ **Giải pháp:** Hoàn thành QC và đảm bảo kết quả là "Đạt"
- ✅ **Phòng ngừa:** Kiểm tra tab "QC" trong View Order Modal trước khi bàn giao

---

### **❓ FAQs (Câu Hỏi Thường Gặp):**

#### **Q1: Có thể bỏ qua bước 2.2 (MR) nếu JO không cần vật tư không?**
**A:** Có, nếu JO chỉ có dịch vụ và tiền công thì không cần tạo MR. JO có thể chuyển thẳng từ "ReadyToWork" sang "InProgress" khi KTV bắt đầu làm việc.

#### **Q2: Phát sinh có bắt buộc phải tạo báo giá không?**
**A:** Có, nếu phát sinh cần vật tư hoặc dịch vụ thì phải tạo báo giá để khách hàng duyệt. Nếu chỉ là ghi chú hoặc vấn đề nhỏ không ảnh hưởng chi phí thì có thể không cần.

#### **Q3: Có thể hủy JO sau khi đã phân công KTV không?**
**A:** Có, nhưng phải đảm bảo:
- Không có items nào đang ở trạng thái "InProgress" hoặc đã có StartTime
- Nếu có items đã bắt đầu làm việc thì phải hoàn thành hoặc dừng lại trước

#### **Q4: Giờ công thực tế được tính như thế nào?**
**A:** Hệ thống tự động tính từ `StartTime` đến `EndTime` mỗi lần KTV bắt đầu/dừng làm việc. Tổng giờ công thực tế = tổng tất cả các khoảng thời gian đã làm việc (cộng dồn).

#### **Q5: QC có thể làm lại nhiều lần không?**
**A:** Có, có thể QC lại nhiều lần. Mỗi lần QC không đạt, `QCFailedCount` sẽ tăng lên 1. KTV cần làm lại và Complete Technical lại trước khi QC lại.

#### **Q6: KTV có thể tự Complete Technical không?**
**A:** Có, KTV có thể tự Complete Technical khi tất cả items đã Completed hoặc Cancelled. Không có restriction về quyền cho hành động này.

#### **Q7: Khi nào JO chuyển sang "ReadyToBill"?**
**A:** JO chuyển sang "ReadyToBill" khi:
- Tất cả items đã Completed
- Đã Complete Technical
- Đã Complete QC với kết quả "Pass"
- Sau đó có thể bàn giao xe và chuyển sang Giai đoạn 3 (Thanh toán)

#### **Q8: Phát sinh có thể ảnh hưởng đến JO gốc không?**
**A:** Có, nếu phát sinh liên quan đến một item cụ thể thì item đó sẽ chuyển sang "OnHold" và không thể tiếp tục làm việc cho đến khi phát sinh được giải quyết.

#### **Q9: LSC Bổ sung có liên kết với JO gốc không?**
**A:** Có, LSC Bổ sung có `ParentServiceOrderId` trỏ đến JO gốc và `IsAdditionalOrder = true`. Tất cả được hiển thị trong View Order Modal → Tab "Phát Sinh".

#### **Q10: Có thể xem lịch sử thay đổi trạng thái JO không?**
**A:** Hiện tại hệ thống chưa có tính năng này. Nhưng có thể xem trạng thái hiện tại trong View Order Modal và các QC records trong tab "QC".

---

### **📊 Metrics & KPIs:**

#### **Các chỉ số quan trọng trong Giai đoạn 2:**

1. **Thời gian phân công (2.1):**
   - Thời gian từ khi JO được tạo đến khi phân công xong
   - **Mục tiêu:** < 1 ngày làm việc

2. **Thời gian xử lý MR (2.2):**
   - Thời gian từ khi tạo MR đến khi Delivered
   - **Mục tiêu:** < 2 ngày làm việc

3. **Thời gian sửa chữa (2.3):**
   - Thời gian từ khi KTV bắt đầu đến khi Complete Technical
   - **Mục tiêu:** Theo giờ công dự kiến (± 10%)

4. **Giờ công thực tế vs Dự kiến:**
   - Tỷ lệ giờ công thực tế / giờ công dự kiến
   - **Mục tiêu:** 90-110% (không vượt quá 20%)

5. **Tỷ lệ QC Pass:**
   - Số lần QC Pass / Tổng số lần QC
   - **Mục tiêu:** > 95%

6. **Tỷ lệ phát sinh:**
   - Số JO có phát sinh / Tổng số JO
   - **Mục tiêu:** < 20%

---

## 🛒 QUẢN LÝ MUA HÀNG (Phase 4.2)

### **Tổng quan**

Module Quản Lý Mua Hàng giúp:
- 📊 Phân tích nhu cầu mua hàng từ cảnh báo tồn kho và đơn hàng sửa chữa
- 🔍 So sánh và đánh giá nhà cung cấp
- 📦 Tạo đơn đặt hàng (PO) hàng loạt
- 🚚 Theo dõi trạng thái vận chuyển PO
- 📈 Đánh giá hiệu suất nhà cung cấp

---

### **4.2.1: Phân Tích Nhu Cầu**

#### **Truy cập:**
1. Vào menu: `Quản Lý Kho` → `Phân Tích Nhu Cầu`

#### **Chức năng:**

**1. Xem Phân Tích Nhu Cầu:**
- Hệ thống tự động tổng hợp nhu cầu từ:
  - ⚠️ Cảnh báo tồn kho (Low Stock, Out of Stock)
  - 🔧 Đơn hàng sửa chữa sắp tới (trong 7-30 ngày)
- Hiển thị:
  - Phụ tùng cần mua
  - Số lượng đề xuất
  - Mức độ ưu tiên (Cao/Trung Bình/Thấp)
  - Chi phí dự kiến

**2. Lọc dữ liệu:**
- Theo mức độ ưu tiên (High/Medium/Low)
- Theo nguồn (InventoryAlert/ServiceOrder/All)
- Theo kho (nếu có nhiều kho)

**3. Tạo Đề Xuất Đặt Hàng:**
- Chọn các phụ tùng cần mua
- Click "Tạo Đề Xuất" để lưu vào danh sách đề xuất

**4. Tạo PO Hàng Loạt:**
- Chọn một hoặc nhiều đề xuất
- Chọn nhà cung cấp
- Click "Tạo PO" để tạo đơn đặt hàng
- Hệ thống tự động tạo PO với tất cả items đã chọn

---

### **4.2.2: Đánh Giá Nhà Cung Cấp**

#### **So Sánh Nhà Cung Cấp:**

**Truy cập:**
1. Vào menu: `Quản Lý Kho` → `So Sánh Nhà Cung Cấp`

**Cách sử dụng:**
1. Chọn phụ tùng cần so sánh (tìm kiếm bằng tên hoặc mã)
2. Nhập số lượng cần mua
3. Click "So Sánh"
4. Xem bảng so sánh:
   - Giá đơn vị
   - Tổng giá
   - Thời gian giao hàng
   - Đánh giá (sao)
   - Tỷ lệ giao hàng đúng hạn
   - Tỷ lệ lỗi
   - Điểm tổng thể

**5. Chọn nhà cung cấp:**
- Click "Tạo PO" bên cạnh nhà cung cấp muốn chọn
- Hệ thống tự động mở form tạo PO với thông tin đã điền sẵn

#### **Đề Xuất Nhà Cung Cấp:**

**Truy cập:**
1. Vào menu: `Quản Lý Kho` → `Đề Xuất Nhà Cung Cấp`

**Cách sử dụng:**
1. Chọn phụ tùng cần mua
2. Nhập số lượng
3. Click "Lấy Đề Xuất"
4. Xem nhà cung cấp được đề xuất:
   - Nhà cung cấp tốt nhất được highlight
   - Lý do đề xuất
   - So sánh với các nhà cung cấp khác

**5. Tạo PO:**
- Click "Tạo PO với Nhà Cung Cấp Này"
- Hệ thống tự động mở form tạo PO

---

### **4.2.3: Theo Dõi PO**

#### **Truy cập:**
1. Vào menu: `Quản Lý Kho` → `Theo Dõi PO`

#### **Dashboard:**
- **Summary Cards:**
  - 🔴 Delayed: Số PO đã quá hạn
  - 🟡 At Risk: Số PO sắp đến hạn (trong 3 ngày)
  - 🟢 On Time: Số PO đúng hạn
  - 📊 Total: Tổng số PO đang vận chuyển

#### **Bảng PO:**
- Hiển thị tất cả PO có trạng thái "Sent" hoặc "InTransit"
- Cột:
  - Số đơn hàng
  - Nhà cung cấp
  - Ngày đặt hàng
  - Ngày gửi
  - Ngày dự kiến giao
  - Mã vận đơn
  - Trạng thái giao hàng (màu sắc)
  - Số ngày còn lại
  - Thao tác

#### **Cập nhật Tracking:**
1. Click "Cập Nhật Tracking" trên PO cần cập nhật
2. Điền thông tin:
   - Mã vận đơn (Tracking Number)
   - Phương thức vận chuyển
   - Ngày dự kiến giao
   - Ngày bắt đầu vận chuyển
   - Ghi chú
3. Tích "Đánh dấu đang vận chuyển" nếu muốn chuyển trạng thái sang "InTransit"
4. Click "Lưu"

#### **Xem Timeline:**
1. Click "Xem Timeline" trên PO
2. Xem lịch sử thay đổi trạng thái:
   - Draft → Sent → InTransit → Received
   - Ngày thay đổi
   - Người thay đổi
   - Ghi chú

#### **Lọc:**
- Theo nhà cung cấp
- Theo trạng thái giao hàng (OnTime/AtRisk/Delayed)
- Theo số ngày còn lại

---

### **4.2.4: Báo Cáo Hiệu Suất**

#### **Truy cập:**
1. Vào menu: `Quản Lý Kho` → `Báo Cáo Hiệu Suất`

#### **Summary Cards:**
- 🟢 Xuất Sắc: Nhà cung cấp có điểm ≥ 80
- 🔵 Tốt: Nhà cung cấp có điểm 60-79
- 🟡 Trung Bình: Nhà cung cấp có điểm 40-59
- 🔴 Kém: Nhà cung cấp có điểm < 40

#### **Biểu đồ:**
- **Top 10 Nhà Cung Cấp Tốt Nhất:** Bar chart
- **Phân Bố Hiệu Suất:** Pie chart

#### **Bảng Xếp Hạng:**
- Xếp hạng nhà cung cấp theo:
  - Điểm tổng thể (mặc định)
  - Tỷ lệ giao hàng đúng hạn
  - Tỷ lệ lỗi
- Click các nút sắp xếp để thay đổi tiêu chí

#### **Bảng Chi Tiết:**
- Hiển thị chi tiết hiệu suất từng nhà cung cấp:
  - Tổng số đơn
  - Số đơn giao đúng hạn
  - Tỷ lệ đúng hạn (%)
  - Thời gian giao trung bình (ngày)
  - Tỷ lệ lỗi (%)
  - Giá trung bình
  - Ổn định giá (%)
  - Điểm tổng thể
  - Ngày tính toán

#### **Cảnh Báo Hiệu Suất:**
- Hiển thị các nhà cung cấp có vấn đề:
  - 🔴 Tỷ lệ giao hàng đúng hạn thấp (< 80%)
  - 🔴 Tỷ lệ lỗi cao (> 5%)
  - 🔴 Điểm tổng thể thấp (< 50)

#### **Tính Toán Lại:**
- Click "Tính Toán" để tính toán lại hiệu suất
- Hệ thống sẽ tính toán dựa trên dữ liệu lịch sử 6 tháng gần đây
- ⚠️ Quá trình này có thể mất vài phút

#### **Lọc:**
- Theo nhà cung cấp
- Theo khoảng thời gian (từ ngày - đến ngày)

---

### **🔗 Liên Kết Đến Các Tài Liệu Khác:**

- **[Quản Lý Báo Giá (Giai đoạn 1.3)](User_Manual.md#13-báo-giá)** - Tạo JO từ Báo giá
- **[Quản Lý Thanh Toán (Giai đoạn 3)](User_Manual.md#giai-đoạn-3)** - Thanh toán sau khi bàn giao
- **[Quản Lý Kho Hàng](User_Manual.md#quản-lý-kho-hàng)** - Thông tin về tồn kho và xuất nhập kho
- **[Quản Lý Nhân Viên](User_Manual.md#quản-lý-nhân-viên)** - Thông tin về KTV và phân quyền
- **[Phiếu Nhập Hàng](User_Manual.md#phiếu-nhập-hàng)** - Tạo phiếu nhập hàng từ PO

---

## 📋 HƯỚNG DẪN CHỨC NĂNG DUYỆT/TỪ CHỐI BÁO GIÁ

### **Vị trí chức năng**
- **Đường dẫn**: Menu Sidebar → Quy Trình Nghiệp Vụ → GIAI ĐOẠN 1 → Bước 3: Báo Giá
- **URL trực tiếp**: `/QuotationManagement`

### **A. Chức năng Duyệt Báo Giá**

1. **Truy cập trang Quản Lý Báo Giá**
   - Vào menu: "Báo Giá" (Bước 3 trong Giai đoạn 1)

2. **Tìm báo giá cần duyệt**
   - Trong bảng "Danh Sách Báo Giá", tìm hàng có trạng thái:
     - "Nháp" (Draft)
     - "Đã gửi" (Sent)
     - "Chờ Duyệt" (Pending)

3. **Bấm nút "Duyệt"**
   - Ở cột **"Thao Tác"** (cột cuối cùng bên phải)
   - Nút màu **xanh lá** (btn-success) với icon **✓** (check)
   - Tooltip: "Duyệt"

4. **Điền form trong modal:**
   - **Ghi chú khách hàng** (Tùy chọn): Nhập ghi chú từ khách hàng hoặc lý do duyệt
   - **Tự động tạo phiếu sửa chữa** (Checkbox - mặc định checked): 
     - ✅ Checked: Tự động tạo phiếu sửa chữa để bắt đầu Giai đoạn 2
     - ❌ Unchecked: Chỉ duyệt báo giá, không tạo phiếu sửa chữa
   - **Ngày hẹn sửa chữa** (Tùy chọn): Chọn ngày bắt đầu sửa chữa (chỉ hiện khi checkbox "Tạo phiếu" được check)

5. **Bấm "Xác nhận Duyệt"**
   - Form sẽ được submit và báo giá chuyển sang trạng thái "Đã Duyệt"
   - Nếu đã chọn tạo phiếu sửa chữa, hệ thống sẽ tự động tạo ServiceOrder

### **B. Chức năng Từ Chối Báo Giá**

1. **Truy cập trang Quản Lý Báo Giá**
   - Vào menu: "Báo Giá" (Bước 3 trong Giai đoạn 1)

2. **Tìm báo giá cần từ chối**
   - Trong bảng "Danh Sách Báo Giá", tìm hàng có trạng thái:
     - "Nháp" (Draft)
     - "Đã gửi" (Sent)
     - "Chờ Duyệt" (Pending)

3. **Bấm nút "Từ chối"**
   - Ở cột **"Thao Tác"** (cột cuối cùng bên phải)
   - Nút màu **đỏ** (btn-danger) với icon **✕** (times)
   - Tooltip: "Từ chối"

4. **Điền form trong modal:**
   - **Lý do từ chối** (Bắt buộc *): Nhập lý do cụ thể để từ chối báo giá
   - **Tính phí kiểm tra** (Checkbox - tùy chọn):
     - ✅ Checked: Hệ thống sẽ tính phí kiểm tra (500.000 VNĐ) và tạo Financial Transaction
     - ❌ Unchecked: Không tính phí

5. **Bấm "Xác nhận Từ chối"**
   - Form sẽ được submit và báo giá chuyển sang trạng thái "Đã Từ Chối"
   - Nếu đã chọn tính phí kiểm tra, hệ thống sẽ tự động tạo giao dịch tài chính

### **Trạng thái & Điều kiện hiển thị**

**Nút "Duyệt" và "Từ chối" chỉ hiển thị khi:**
- Trạng thái báo giá là một trong các giá trị:
  - `Draft` / `Nháp`
  - `Sent` / `Đã gửi`
  - `Pending` / `Chờ Duyệt`

**Nút sẽ ẨN khi:**
- Trạng thái đã là `Approved` / `Đã Duyệt`
- Trạng thái đã là `Rejected` / `Đã Từ Chối`
- Trạng thái đã là `Completed` / `Hoàn thành`
- Trạng thái đã là `Cancelled` / `Đã Hủy`

---

## 📋 HƯỚNG DẪN TẠO DỮ LIỆU QC

### **Workflow để có JO chờ QC:**

1. **Tạo Service Order từ Quotation đã Approved**
   - Vào "Báo Giá" → Duyệt một báo giá
   - Vào "Phiếu Sửa Chữa" → Tạo mới từ báo giá đã duyệt

2. **Phân công KTV và giờ công**
   - Xem chi tiết Service Order → Click "Phân công KTV"
   - Chọn KTV và giờ công cho từng item

3. **KTV bắt đầu làm việc**
   - Xem chi tiết Service Order → Tab "Chi Tiết Dịch Vụ"
   - Click "Bắt đầu" cho từng item

4. **KTV hoàn thành từng item**
   - Click "Hoàn thành" cho từng item sau khi làm xong

5. **Hoàn thành kỹ thuật**
   - Khi TẤT CẢ items đã Completed hoặc Cancelled
   - Button "Hoàn Thành Kỹ Thuật" sẽ xuất hiện trong View Order Modal
   - Click button này → Service Order chuyển sang "WaitingForQC"

6. **Kiểm tra QC Management**
   - Vào "Kiểm Tra QC" → Sẽ thấy JO chờ QC trong danh sách

### **Script kiểm tra và tạo dữ liệu demo:**

```sql
-- Bước 1: Kiểm tra Service Orders hiện tại
SELECT 
    so.Id,
    so.OrderNumber,
    so.Status,
    COUNT(soi.Id) as TotalItems,
    SUM(CASE WHEN soi.Status = 'Completed' THEN 1 ELSE 0 END) as CompletedItems,
    SUM(CASE WHEN soi.Status = 'Cancelled' THEN 1 ELSE 0 END) as CancelledItems,
    SUM(CASE WHEN soi.Status NOT IN ('Completed', 'Cancelled') THEN 1 ELSE 0 END) as IncompleteItems
FROM ServiceOrders so
LEFT JOIN ServiceOrderItems soi ON soi.ServiceOrderId = so.Id AND soi.IsDeleted = 0
WHERE so.IsDeleted = 0
GROUP BY so.Id, so.OrderNumber, so.Status
ORDER BY so.Id DESC;

-- Bước 2: Cập nhật status sang WaitingForQC (thay {ServiceOrderId} bằng ID thực tế)
-- UPDATE ServiceOrders 
-- SET Status = 'WaitingForQC',
--     CompletedDate = NOW(),
--     TotalActualHours = (
--         SELECT IFNULL(SUM(ActualHours), 0) 
--         FROM ServiceOrderItems 
--         WHERE ServiceOrderId = {ServiceOrderId} 
--           AND IsDeleted = 0
--           AND ActualHours IS NOT NULL
--     )
-- WHERE Id = {ServiceOrderId} 
--   AND IsDeleted = 0
--   AND Status IN ('Completed', 'InProgress');

-- Bước 3: Hoặc cập nhật tất cả items của một Service Order sang Completed
-- UPDATE ServiceOrderItems 
-- SET Status = 'Completed',
--     CompletedTime = NOW(),
--     ActualHours = IFNULL(EstimatedHours, 0),
--     EndTime = NOW()
-- WHERE ServiceOrderId = {ServiceOrderId} 
--   AND IsDeleted = 0
--   AND Status != 'Cancelled';

-- Bước 4: Kiểm tra lại danh sách JO chờ QC
SELECT 
    so.Id,
    so.OrderNumber,
    c.Name as CustomerName,
    v.LicensePlate as VehiclePlate,
    so.CompletedDate,
    so.TotalActualHours,
    so.QCFailedCount,
    so.Status
FROM ServiceOrders so
LEFT JOIN Customers c ON c.Id = so.CustomerId
LEFT JOIN Vehicles v ON v.Id = so.VehicleId
WHERE so.IsDeleted = 0 
  AND so.Status = 'WaitingForQC'
ORDER BY so.CompletedDate DESC, so.OrderDate DESC;
```

---

## 💰 HƯỚNG DẪN XỬ LÝ THUẾ VAT

### **Tổng quan vấn đề**

**Vấn đề hiện tại:**
- Mỗi phụ tùng chỉ có **1 VATRate duy nhất**
- Không phân biệt được nguồn gốc từ nhà cung cấp nào
- Xuất hàng không đúng với thuế thực tế đã nhập

**Giải pháp đã implement:**
- **VAT Override** trong QuotationItem
- **Thông tin VAT** chi tiết trong Part entity
- **Logic tính VAT** linh hoạt theo từng trường hợp

### **Quy trình xử lý VAT**

#### **Bước 1: Nhập hàng từ nhà cung cấp**
1. Tạo Purchase Order với VATRate tương ứng
2. Lưu thông tin VAT vào Part entity
3. Cập nhật tồn kho với thông tin VAT

#### **Bước 2: Xuất hàng cho khách hàng**
1. Tạo Quotation với phụ tùng
2. Hệ thống tự động lấy VATRate từ Part (READ-ONLY)
3. ❌ KHÔNG ĐƯỢC PHÉP Override VAT (tuân thủ quy định thuế)
4. Tính toán VATAmount chính xác theo VAT đã nhập

#### **Bước 3: Tính toán VAT**
```
Công thức:
- SubTotal = Quantity × UnitPrice
- VATAmount = SubTotal × EffectiveVATRate (nếu IsVATApplicable = true)
- TotalAmount = SubTotal + VATAmount - DiscountAmount
```

### **Các trường hợp sử dụng**

#### **Trường hợp 1: Khách hàng cá nhân**
- Sử dụng VATRate từ Part (READ-ONLY)
- ❌ KHÔNG ĐƯỢC PHÉP Override VAT
- Áp dụng thuế theo VAT đã nhập từ nhà cung cấp

#### **Trường hợp 2: Khách hàng bảo hiểm**
- Sử dụng VATRate từ Part (READ-ONLY)
- ❌ KHÔNG ĐƯỢC PHÉP Override VAT
- Cần có hóa đơn VAT hợp lệ theo VAT đã nhập

#### **Trường hợp 3: Khách hàng công ty**
- Sử dụng VATRate từ Part (READ-ONLY)
- ❌ KHÔNG ĐƯỢC PHÉP Override VAT
- Cần có hóa đơn VAT đầy đủ theo VAT đã nhập

#### **Trường hợp 4: Phụ tùng không có hóa đơn**
- Set IsVATApplicable = false
- VATAmount = 0
- Không áp dụng thuế VAT

### **Quy định VAT ở Việt Nam**

**Thuế suất VAT cho các hạng mục:**

```
✅ HÀNG HÓA (Chịu thuế VAT 10%):
   • Phụ tùng ô tô                     → VAT 10%
   • Vật liệu sơn                      → VAT 10%
   • Vật liệu sửa chữa (matit, keo...) → VAT 10%
   • Dầu nhớt, mỡ bôi trơn             → VAT 10%

✅ DỊCH VỤ SỬA CHỮA (Chịu thuế VAT 10%):
   • Dịch vụ thay phụ tùng             → VAT 10%
   • Dịch vụ sửa chữa                  → VAT 10%
   • Dịch vụ bảo dưỡng                 → VAT 10%
   • Dịch vụ sơn                       → VAT 10%
   • Dịch vụ kiểm tra, chẩn đoán       → VAT 10%

⚠️ CÔNG LAO ĐỘNG (Tùy cách hạch toán):

CÁCH 1 - GỘP VÀO GIÁ DỊCH VỤ (Phổ biến):
   • Dịch vụ đã bao gồm công           → VAT 10%
   • Giá dịch vụ = Vật liệu + Công
   • Ví dụ: "Thay đèn pha" = PT + Công → VAT 10%

CÁCH 2 - TÁCH RIÊNG CÔNG (Ít dùng):
   • Công lao động tách riêng          → KHÔNG VAT
   • Chỉ ghi giá công, không tính VAT
   • Lưu ý: Phải ghi rõ "Công lao động"
```

### **Lưu ý quan trọng**

**Tuân thủ quy định thuế (NGUYÊN TẮC BẮT BUỘC):**
- ❌ KHÔNG ĐƯỢC PHÉP chỉnh sửa VAT khi xuất hàng
- ✅ VAT phải khớp với hóa đơn nhập hàng từ nhà cung cấp
- ✅ Đảm bảo tính minh bạch và tuân thủ quy định thuế
- ✅ Lưu trữ đầy đủ chứng từ thuế để kiểm tra
- ✅ Luôn kiểm tra quy định thuế hiện hành

---

## 🎯 HƯỚNG DẪN DATA DEMO

### **Giới thiệu Data Demo**

**Mục đích:**
Data Demo được thiết kế để:
- ✅ **Làm quen với hệ thống**: Hiểu cách sử dụng các tính năng
- ✅ **Test đầy đủ quy trình**: Từ khách hàng đến thanh toán
- ✅ **Demo cho khách hàng**: Thuyết trình tính năng
- ✅ **Training nhân viên**: Hướng dẫn sử dụng

**Dữ liệu Demo bao gồm:**
- 👥 **10 khách hàng** với đầy đủ thông tin
- 🚗 **15 xe** các hãng khác nhau
- 🔧 **200+ phụ tùng** phân loại theo nhóm
- ⚙️ **50+ dịch vụ** sửa chữa
- 👷 **20+ công lao động** chi tiết
- 💼 **25 đơn hàng** hoàn chỉnh
- 💰 **Giao dịch tài chính** đầy đủ
- 📦 **Giao dịch kho** nhập xuất

### **Cài đặt Data Demo**

#### **Bước 1: Backup dữ liệu hiện tại**
```sql
-- Backup database hiện tại
mysqldump -u usergara -p GaraManagement > backup_before_demo.sql
```

#### **Bước 2: Sử dụng Setup Controller**
1. Đăng nhập hệ thống
2. Vào menu **"Setup"** hoặc **"Cài đặt"**
3. Chọn **"Khởi tạo Demo Data theo Giai đoạn"**
4. Click nút **"Tạo Demo Data"** cho từng giai đoạn:
   - **Giai đoạn 1**: Tiếp nhận & Báo giá
   - **Giai đoạn 2**: Sửa chữa & Quản lý xuất kho
   - **Giai đoạn 3**: Quyết toán & Chăm sóc hậu mãi
   - **Giai đoạn 4**: Chuẩn hóa quản lý phụ tùng & Procurement

#### **Bước 3: Xóa Demo Data (nếu cần)**
1. Vào menu **"Setup"**
2. Click nút **"Xóa Tất cả"** (màu đỏ)
3. Xác nhận xóa tất cả dữ liệu demo

### **Quy trình Demo hoàn chỉnh**

#### **Scenario 1: Khách hàng mới - Xe Mercedes C-Class**

**Bước 1: Đăng ký khách hàng**
- Họ tên: Nguyễn Minh Tuấn
- SĐT: 0901234567
- Email: tuan.nguyen@email.com
- Địa chỉ: 123 Nguyễn Huệ, Quận 1, TP.HCM
- Loại: Cá nhân
- Ghi chú: Khách VIP, thường xuyên sửa chữa

**Bước 2: Đăng ký xe**
- Biển số: 30A-12345
- Hãng xe: Mercedes-Benz
- Model: C-Class (W205)
- Năm sản xuất: 2020
- Màu sắc: Đen
- Số khung: WDD2050461A123456
- Bảo hiểm: Bảo Việt - BV123456789

**Bước 3: Tạo đơn hàng sửa chữa**
- Số đơn: SO-2024-001
- Khách hàng: Nguyễn Minh Tuấn
- Xe: 30A-12345 - Mercedes C-Class 2020
- Ngày: 15/01/2024
- Tình trạng: Đèn pha bị mờ, cần thay mới

**Dịch vụ:**
- Thay đèn pha Mercedes C-Class W205

**Phụ tùng:**
- Đèn pha Mercedes C-Class W205 (OEM)
- Bóng đèn H7 55W

**Công lao động:**
- Công tháo đèn pha (1.5 giờ)
- Công lắp đèn pha (1.0 giờ)
- Công điều chỉnh góc chiếu sáng (0.5 giờ)

**Tổng cộng: 2,850,000 VNĐ**

### **Các tình huống Demo**

#### **Tình huống 1: Quản lý tồn kho**
- Phụ tùng tồn kho thấp:
  - Dầu phanh DOT4: 2 lít (Cảnh báo: < 5 lít)
  - Bugi đánh lửa: 5 bộ (Cảnh báo: < 10 bộ)
  - Lọc nhiên liệu: 3 cái (Cảnh báo: < 5 cái)

**Hành động:**
- Tạo đơn đặt hàng tự động
- Gửi email nhắc nhở nhà cung cấp
- Cập nhật lịch nhập hàng

#### **Tình huống 2: Báo cáo doanh thu**
- Báo cáo tháng 01/2024:
  - Doanh thu dịch vụ sửa chữa: 45,500,000 VNĐ
  - Bán phụ tùng: 23,200,000 VNĐ
  - Công lao động: 12,800,000 VNĐ
  - Tổng doanh thu: 81,500,000 VNĐ

**Chi phí:**
- Chi phí phụ tùng: 52,300,000 VNĐ
- Chi phí nhân công: 15,600,000 VNĐ
- Chi phí vận chuyển: 2,400,000 VNĐ
- Tổng chi phí: 70,300,000 VNĐ

**Lợi nhuận: 11,200,000 VNĐ (13.7%)**

### **Kết quả mong đợi**

**Sau khi hoàn thành Demo, người dùng sẽ:**

**✅ Hiểu được quy trình hoàn chỉnh:**
1. **Đăng ký khách hàng** → **Đăng ký xe** → **Tạo đơn hàng**
2. **Quản lý phụ tùng** → **Nhập kho** → **Xuất kho**
3. **Thực hiện dịch vụ** → **Tính công lao động** → **Thanh toán**
4. **Tạo báo cáo** → **Quản lý tài chính** → **Theo dõi công nợ**

**✅ Thành thạo các tính năng:**
- Tìm kiếm và lọc dữ liệu
- Tạo và chỉnh sửa thông tin
- Quản lý tồn kho và cảnh báo
- Tạo báo cáo và xuất dữ liệu
- Quản lý quyền truy cập

### **Lưu ý quan trọng**

**⚠️ Lưu ý khi sử dụng Data Demo:**
1. **Backup dữ liệu** trước khi import demo
2. **Test trên môi trường** development trước
3. **Không sử dụng** trên production
4. **Xóa dữ liệu demo** sau khi hoàn thành test

---

## 📚 TÀI LIỆU BỔ SUNG

### **Video hướng dẫn**
- [Hướng dẫn cơ bản](https://youtube.com/watch?v=xxx)
- [Quản lý đơn hàng](https://youtube.com/watch?v=yyy)
- [Tạo báo cáo](https://youtube.com/watch?v=zzz)

### **FAQ (Câu hỏi thường gặp)**
- [Làm sao để backup dữ liệu?](#backup)
- [Có thể sử dụng trên mobile không?](#mobile)
- [Làm sao để thêm nhân viên mới?](#add-employee)

---

*Tài liệu này được cập nhật thường xuyên. Phiên bản: v2.0.0 - Cập nhật lần cuối: 15/01/2024*
